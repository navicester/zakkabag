<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Tms Rmn";
	panose-1:2 2 6 3 4 5 5 2 3 4;}
@font-face
	{font-family:Helv;
	panose-1:2 11 6 4 2 2 2 3 2 4;}
@font-face
	{font-family:"New York";
	panose-1:2 4 5 3 6 5 6 2 3 4;}
@font-face
	{font-family:System;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"MS Gothic";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:Dotum;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:黑体;
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:MingLiU;
	panose-1:2 2 5 9 0 0 0 0 0 0;}
@font-face
	{font-family:Mincho;
	panose-1:2 2 6 9 4 3 5 8 3 5;}
@font-face
	{font-family:Gulim;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:Century;
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:"Angsana New";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Cordia New";
	panose-1:2 11 3 4 2 2 2 2 2 4;}
@font-face
	{font-family:Mangal;
	panose-1:2 4 5 3 5 2 3 3 2 2;}
@font-face
	{font-family:Latha;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Sylfaen;
	panose-1:1 10 5 2 5 3 6 3 3 3;}
@font-face
	{font-family:Vrinda;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Raavi;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Shruti;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Sendnya;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Gautami;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Tunga;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Estrangelo Edessa";
	panose-1:3 8 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Fira Mono";}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
	{font-family:Roboto;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:微软雅黑;
	panose-1:2 11 5 3 2 2 4 2 2 4;}
@font-face
	{font-family:"Helvetica Neue";}
@font-face
	{font-family:Times;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:ZapfDingbats;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Marlett;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:DaunPenh;
	panose-1:1 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:DokChampa;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Euphemia;
	panose-1:2 11 5 3 4 1 2 2 1 4;}
@font-face
	{font-family:Vani;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Impact;
	panose-1:2 11 8 6 3 9 2 5 2 4;}
@font-face
	{font-family:"Iskoola Pota";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Kalinga;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Kartika;
	panose-1:2 2 5 3 3 4 4 6 2 3;}
@font-face
	{font-family:"Khmer UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Lao UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Lucida Console";
	panose-1:2 11 6 9 4 5 4 2 2 4;}
@font-face
	{font-family:Meiryo;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"\@Meiryo";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Meiryo UI";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"\@Meiryo UI";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Microsoft Himalaya";
	panose-1:1 1 1 0 1 1 1 1 1 1;}
@font-face
	{font-family:"Microsoft JhengHei";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"\@Microsoft JhengHei";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"\@微软雅黑";
	panose-1:2 11 5 3 2 2 4 2 2 4;}
@font-face
	{font-family:"\@MingLiU";
	panose-1:2 2 5 9 0 0 0 0 0 0;}
@font-face
	{font-family:"\@PMingLiU";
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:MingLiU_HKSCS;
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@MingLiU_HKSCS";
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:MingLiU-ExtB;
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@MingLiU-ExtB";
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:PMingLiU-ExtB;
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@PMingLiU-ExtB";
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:MingLiU_HKSCS-ExtB;
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@MingLiU_HKSCS-ExtB";
	panose-1:2 2 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Mongolian Baiti";
	panose-1:3 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@MS Gothic";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:"MS PGothic";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"\@MS PGothic";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"MS UI Gothic";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"\@MS UI Gothic";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"\@MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:"MS PMincho";
	panose-1:2 2 6 0 4 2 5 8 3 4;}
@font-face
	{font-family:"\@MS PMincho";
	panose-1:2 2 6 0 4 2 5 8 3 4;}
@font-face
	{font-family:"MV Boli";
	panose-1:2 0 5 0 3 2 0 9 0 0;}
@font-face
	{font-family:"Microsoft New Tai Lue";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Nyala;
	panose-1:2 0 5 4 7 3 0 2 0 3;}
@font-face
	{font-family:"Microsoft PhagsPa";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Plantagenet Cherokee";
	panose-1:2 2 6 2 7 1 0 0 0 0;}
@font-face
	{font-family:"Segoe Script";
	panose-1:2 11 5 4 2 0 0 0 0 3;}
@font-face
	{font-family:"Segoe UI Semibold";
	panose-1:2 11 7 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Segoe UI Light";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Segoe UI Symbol";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:新宋体;
	panose-1:2 1 6 9 3 1 1 1 1 1;}
@font-face
	{font-family:"\@新宋体";
	panose-1:2 1 6 9 3 1 1 1 1 1;}
@font-face
	{font-family:SimSun-ExtB;
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:"\@SimSun-ExtB";
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:"Microsoft Tai Le";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Shonar Bangla";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Microsoft Yi Baiti";
	panose-1:3 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Microsoft Sans Serif";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Aparajita;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Ebrima;
	panose-1:2 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Gisha;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Kokila;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Leelawadee;
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Microsoft Uighur";
	panose-1:2 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:MoolBoran;
	panose-1:2 11 1 0 1 1 1 1 1 1;}
@font-face
	{font-family:Utsaah;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Vijaya;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Andalus;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Arabic Typesetting";
	panose-1:3 2 4 2 4 4 6 3 2 3;}
@font-face
	{font-family:"Simplified Arabic";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Simplified Arabic Fixed";
	panose-1:2 7 3 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Sakkal Majalla";
	panose-1:2 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Traditional Arabic";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:Aharoni;
	panose-1:2 1 8 3 2 1 4 3 2 3;}
@font-face
	{font-family:David;
	panose-1:2 14 5 2 6 4 1 1 1 1;}
@font-face
	{font-family:FrankRuehl;
	panose-1:2 14 5 3 6 1 1 1 1 1;}
@font-face
	{font-family:"Levenim MT";
	panose-1:2 1 5 2 6 1 1 1 1 1;}
@font-face
	{font-family:Miriam;
	panose-1:2 11 5 2 5 1 1 1 1 1;}
@font-face
	{font-family:"Miriam Fixed";
	panose-1:2 11 5 9 5 1 1 1 1 1;}
@font-face
	{font-family:Narkisim;
	panose-1:2 14 5 2 5 1 1 1 1 1;}
@font-face
	{font-family:Rod;
	panose-1:2 3 5 9 5 1 1 1 1 1;}
@font-face
	{font-family:仿宋;
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:"\@仿宋";
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:"\@黑体";
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:楷体;
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:"\@楷体";
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:AngsanaUPC;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Browallia New";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:BrowalliaUPC;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:CordiaUPC;
	panose-1:2 11 3 4 2 2 2 2 2 4;}
@font-face
	{font-family:DilleniaUPC;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:EucrosiaUPC;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:FreesiaUPC;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:IrisUPC;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:JasmineUPC;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:KodchiangUPC;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:LilyUPC;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:DFKai-SB;
	panose-1:3 0 5 9 0 0 0 0 0 0;}
@font-face
	{font-family:"\@DFKai-SB";
	panose-1:3 0 5 9 0 0 0 0 0 0;}
@font-face
	{font-family:"Lucida Sans Unicode";
	panose-1:2 11 6 2 3 5 4 2 2 4;}
@font-face
	{font-family:"Arial Black";
	panose-1:2 11 10 4 2 1 2 2 2 4;}
@font-face
	{font-family:"Comic Sans MS";
	panose-1:3 15 7 2 3 3 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Medium";
	panose-1:2 11 6 3 2 1 2 2 2 4;}
@font-face
	{font-family:Gabriola;
	panose-1:4 4 6 5 5 16 2 2 13 2;}
@font-face
	{font-family:Georgia;
	panose-1:2 4 5 2 5 4 5 2 3 3;}
@font-face
	{font-family:"Palatino Linotype";
	panose-1:2 4 5 2 5 5 5 3 3 4;}
@font-face
	{font-family:"Segoe Print";
	panose-1:2 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Trebuchet MS";
	panose-1:2 11 6 3 2 2 2 2 2 4;}
@font-face
	{font-family:Webdings;
	panose-1:5 3 1 2 1 5 9 6 7 3;}
@font-face
	{font-family:"Roboto Th";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"Lucida Sans";
	panose-1:2 11 6 2 4 5 2 2 2 4;}
@font-face
	{font-family:04b_21;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Book Antiqua";
	panose-1:2 4 6 2 5 3 5 3 3 4;}
@font-face
	{font-family:"Century Gothic";
	panose-1:2 11 5 2 2 2 2 2 2 4;}
@font-face
	{font-family:Haettenschweiler;
	panose-1:2 11 7 6 4 9 2 6 2 4;}
@font-face
	{font-family:"MS Outlook";
	panose-1:5 1 1 0 1 0 0 0 0 0;}
@font-face
	{font-family:"Tempus Sans ITC";
	panose-1:4 2 4 4 3 13 7 2 2 2;}
@font-face
	{font-family:Pristina;
	panose-1:3 6 4 2 4 4 6 8 2 4;}
@font-face
	{font-family:Papyrus;
	panose-1:3 7 5 2 6 5 2 3 2 5;}
@font-face
	{font-family:Mistral;
	panose-1:3 9 7 2 3 4 7 2 4 3;}
@font-face
	{font-family:"Lucida Handwriting";
	panose-1:3 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:"Kristen ITC";
	panose-1:3 5 5 2 4 2 2 3 2 2;}
@font-face
	{font-family:"Juice ITC";
	panose-1:4 4 4 3 4 10 2 2 2 2;}
@font-face
	{font-family:"French Script MT";
	panose-1:3 2 4 2 4 6 7 4 6 5;}
@font-face
	{font-family:"Freestyle Script";
	panose-1:3 8 4 2 3 2 5 11 4 4;}
@font-face
	{font-family:"Bradley Hand ITC";
	panose-1:3 7 4 2 5 3 2 3 2 3;}
@font-face
	{font-family:"Monotype Corsiva";
	panose-1:3 1 1 1 1 2 1 1 1 1;}
@font-face
	{font-family:Algerian;
	panose-1:4 2 7 5 4 10 2 6 7 2;}
@font-face
	{font-family:"Baskerville Old Face";
	panose-1:2 2 6 2 8 5 5 2 3 3;}
@font-face
	{font-family:"Bauhaus 93";
	panose-1:4 3 9 5 2 11 2 2 12 2;}
@font-face
	{font-family:"Bell MT";
	panose-1:2 2 5 3 6 3 5 2 3 3;}
@font-face
	{font-family:"Berlin Sans FB";
	panose-1:2 14 6 2 2 5 2 2 3 6;}
@font-face
	{font-family:"Bernard MT Condensed";
	panose-1:2 5 8 6 6 9 5 2 4 4;}
@font-face
	{font-family:"Bodoni MT Poster Compressed";
	panose-1:2 7 7 6 8 6 1 5 2 4;}
@font-face
	{font-family:"Britannic Bold";
	panose-1:2 11 9 3 6 7 3 2 2 4;}
@font-face
	{font-family:Broadway;
	panose-1:4 4 9 5 8 11 2 2 5 2;}
@font-face
	{font-family:"Brush Script MT";
	panose-1:3 6 8 2 4 4 6 7 3 4;}
@font-face
	{font-family:"Californian FB";
	panose-1:2 7 4 3 6 8 11 3 2 4;}
@font-face
	{font-family:Centaur;
	panose-1:2 3 5 4 5 2 5 2 3 4;}
@font-face
	{font-family:Chiller;
	panose-1:4 2 4 4 3 16 7 2 6 2;}
@font-face
	{font-family:"Colonna MT";
	panose-1:4 2 8 5 6 2 2 3 2 3;}
@font-face
	{font-family:"Cooper Black";
	panose-1:2 8 9 4 4 3 11 2 4 4;}
@font-face
	{font-family:"Footlight MT Light";
	panose-1:2 4 6 2 6 3 10 2 3 4;}
@font-face
	{font-family:"Harlow Solid Italic";
	panose-1:4 3 6 4 2 15 2 2 13 2;}
@font-face
	{font-family:Harrington;
	panose-1:4 4 5 5 5 10 2 2 7 2;}
@font-face
	{font-family:"High Tower Text";
	panose-1:2 4 5 2 5 5 6 3 3 3;}
@font-face
	{font-family:Jokerman;
	panose-1:4 9 6 5 6 13 6 2 7 2;}
@font-face
	{font-family:"Kunstler Script";
	panose-1:3 3 4 2 2 6 7 13 13 6;}
@font-face
	{font-family:"Lucida Bright";
	panose-1:2 4 6 2 5 5 5 2 3 4;}
@font-face
	{font-family:"Lucida Calligraphy";
	panose-1:3 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:"Lucida Fax";
	panose-1:2 6 6 2 5 5 5 2 2 4;}
@font-face
	{font-family:Magneto;
	panose-1:4 3 8 5 5 8 2 2 13 2;}
@font-face
	{font-family:"Matura MT Script Capitals";
	panose-1:3 2 8 2 6 6 2 7 2 2;}
@font-face
	{font-family:"Modern No\. 20";
	panose-1:2 7 7 4 7 5 5 2 3 3;}
@font-face
	{font-family:"Niagara Engraved";
	panose-1:4 2 5 2 7 7 3 3 2 2;}
@font-face
	{font-family:"Niagara Solid";
	panose-1:4 2 5 2 7 7 2 2 2 2;}
@font-face
	{font-family:"Old English Text MT";
	panose-1:3 4 9 2 4 5 8 3 8 6;}
@font-face
	{font-family:Onyx;
	panose-1:4 5 6 2 8 7 2 2 2 3;}
@font-face
	{font-family:Parchment;
	panose-1:3 4 6 2 4 7 8 4 8 4;}
@font-face
	{font-family:Playbill;
	panose-1:4 5 6 3 10 6 2 2 2 2;}
@font-face
	{font-family:"Poor Richard";
	panose-1:2 8 5 2 5 5 5 2 7 2;}
@font-face
	{font-family:Ravie;
	panose-1:4 4 8 5 5 8 9 2 6 2;}
@font-face
	{font-family:"Informal Roman";
	panose-1:3 6 4 2 3 4 6 11 2 4;}
@font-face
	{font-family:"Showcard Gothic";
	panose-1:4 2 9 4 2 1 2 2 6 4;}
@font-face
	{font-family:"Snap ITC";
	panose-1:4 4 10 7 6 10 2 2 2 2;}
@font-face
	{font-family:Stencil;
	panose-1:4 4 9 5 13 8 2 2 4 4;}
@font-face
	{font-family:"Viner Hand ITC";
	panose-1:3 7 5 2 3 5 2 2 2 3;}
@font-face
	{font-family:Vivaldi;
	panose-1:3 2 6 2 5 5 6 9 8 4;}
@font-face
	{font-family:"Vladimir Script";
	panose-1:3 5 4 2 4 4 7 7 3 5;}
@font-face
	{font-family:"Wide Latin";
	panose-1:2 10 10 7 5 5 5 2 4 4;}
@font-face
	{font-family:"Tw Cen MT";
	panose-1:2 11 6 2 2 1 4 2 6 3;}
@font-face
	{font-family:"Tw Cen MT Condensed";
	panose-1:2 11 6 6 2 1 4 2 2 3;}
@font-face
	{font-family:"Script MT Bold";
	panose-1:3 4 6 2 4 6 7 8 9 4;}
@font-face
	{font-family:"Rockwell Extra Bold";
	panose-1:2 6 9 3 4 5 5 2 4 3;}
@font-face
	{font-family:"Rockwell Condensed";
	panose-1:2 6 6 3 5 4 5 2 1 4;}
@font-face
	{font-family:Rockwell;
	panose-1:2 6 6 3 2 2 5 2 4 3;}
@font-face
	{font-family:"Rage Italic";
	panose-1:3 7 5 2 4 5 7 7 3 4;}
@font-face
	{font-family:"Perpetua Titling MT";
	panose-1:2 2 5 2 6 5 5 2 8 4;}
@font-face
	{font-family:Perpetua;
	panose-1:2 2 5 2 6 4 1 2 3 3;}
@font-face
	{font-family:"Palace Script MT";
	panose-1:3 3 3 2 2 6 7 12 11 5;}
@font-face
	{font-family:"OCR A Extended";
	panose-1:2 1 5 9 2 1 2 1 3 3;}
@font-face
	{font-family:"Maiandra GD";
	panose-1:2 14 5 2 3 3 8 2 2 4;}
@font-face
	{font-family:"Lucida Sans Typewriter";
	panose-1:2 11 5 9 3 5 4 3 2 4;}
@font-face
	{font-family:"Imprint MT Shadow";
	panose-1:4 2 6 5 6 3 3 3 2 2;}
@font-face
	{font-family:"Goudy Stout";
	panose-1:2 2 9 4 7 3 11 2 4 1;}
@font-face
	{font-family:"Goudy Old Style";
	panose-1:2 2 5 2 5 3 5 2 3 3;}
@font-face
	{font-family:"Gloucester MT Extra Condensed";
	panose-1:2 3 8 8 2 6 1 1 1 1;}
@font-face
	{font-family:"Gill Sans Ultra Bold Condensed";
	panose-1:2 11 10 6 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans Ultra Bold";
	panose-1:2 11 10 2 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans MT Condensed";
	panose-1:2 11 5 6 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans MT";
	panose-1:2 11 5 2 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans MT Ext Condensed Bold";
	panose-1:2 11 9 2 2 1 4 2 2 3;}
@font-face
	{font-family:Gigi;
	panose-1:4 4 5 4 6 16 7 2 13 2;}
@font-face
	{font-family:"Franklin Gothic Medium Cond";
	panose-1:2 11 6 6 3 4 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Heavy";
	panose-1:2 11 9 3 2 1 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Demi Cond";
	panose-1:2 11 7 6 3 4 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Demi";
	panose-1:2 11 7 3 2 1 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Book";
	panose-1:2 11 5 3 2 1 2 2 2 4;}
@font-face
	{font-family:Forte;
	panose-1:3 6 9 2 4 5 2 7 2 3;}
@font-face
	{font-family:"Felix Titling";
	panose-1:4 6 5 5 6 2 2 2 10 4;}
@font-face
	{font-family:"Eras Medium ITC";
	panose-1:2 11 6 2 3 5 4 2 8 4;}
@font-face
	{font-family:"Eras Light ITC";
	panose-1:2 11 4 2 3 5 4 2 8 4;}
@font-face
	{font-family:"Eras Demi ITC";
	panose-1:2 11 8 5 3 5 4 2 8 4;}
@font-face
	{font-family:"Eras Bold ITC";
	panose-1:2 11 9 7 3 5 4 2 2 4;}
@font-face
	{font-family:"Engravers MT";
	panose-1:2 9 7 7 8 5 5 2 3 4;}
@font-face
	{font-family:Elephant;
	panose-1:2 2 9 4 9 5 5 2 3 3;}
@font-face
	{font-family:"Edwardian Script ITC";
	panose-1:3 3 3 2 4 7 7 13 8 4;}
@font-face
	{font-family:"Curlz MT";
	panose-1:4 4 4 4 5 7 2 2 2 2;}
@font-face
	{font-family:"Copperplate Gothic Light";
	panose-1:2 14 5 7 2 2 6 2 4 4;}
@font-face
	{font-family:"Copperplate Gothic Bold";
	panose-1:2 14 7 5 2 2 6 2 4 4;}
@font-face
	{font-family:"Century Schoolbook";
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:Castellar;
	panose-1:2 10 4 2 6 4 6 1 3 1;}
@font-face
	{font-family:"Calisto MT";
	panose-1:2 4 6 3 5 5 5 3 3 4;}
@font-face
	{font-family:"Bodoni MT Condensed";
	panose-1:2 7 6 6 8 6 6 2 2 3;}
@font-face
	{font-family:"Bodoni MT Black";
	panose-1:2 7 10 3 8 6 6 2 2 3;}
@font-face
	{font-family:"Bodoni MT";
	panose-1:2 7 6 3 8 6 6 2 2 3;}
@font-face
	{font-family:"Blackadder ITC";
	panose-1:4 2 5 5 5 16 7 2 13 2;}
@font-face
	{font-family:"Arial Rounded MT Bold";
	panose-1:2 15 7 4 3 5 4 3 2 4;}
@font-face
	{font-family:"Agency FB";
	panose-1:2 11 5 3 2 2 2 2 2 4;}
@font-face
	{font-family:"Berlin Sans FB Demi";
	panose-1:2 14 8 2 2 5 2 2 3 6;}
@font-face
	{font-family:"Tw Cen MT Condensed Extra Bold";
	panose-1:2 11 8 3 2 2 2 2 2 4;}
@font-face
	{font-family:方正舒体;
	panose-1:2 1 6 1 3 1 1 1 1 1;}
@font-face
	{font-family:"\@方正舒体";
	panose-1:2 1 6 1 3 1 1 1 1 1;}
@font-face
	{font-family:方正姚体;
	panose-1:2 1 6 1 3 1 1 1 1 1;}
@font-face
	{font-family:"\@方正姚体";
	panose-1:2 1 6 1 3 1 1 1 1 1;}
@font-face
	{font-family:隶书;
	panose-1:2 1 5 9 6 1 1 1 1 1;}
@font-face
	{font-family:"\@隶书";
	panose-1:2 1 5 9 6 1 1 1 1 1;}
@font-face
	{font-family:华文彩云;
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文彩云";
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文仿宋;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文仿宋";
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文琥珀;
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文琥珀";
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文楷体;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文楷体";
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文隶书;
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文隶书";
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文宋体;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文宋体";
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文细黑;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文细黑";
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文行楷;
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文行楷";
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文新魏;
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文新魏";
	panose-1:2 1 8 0 4 1 1 1 1 1;}
@font-face
	{font-family:华文中宋;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:"\@华文中宋";
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:幼圆;
	panose-1:2 1 5 9 6 1 1 1 1 1;}
@font-face
	{font-family:"\@幼圆";
	panose-1:2 1 5 9 6 1 1 1 1 1;}
@font-face
	{font-family:"MT Extra";
	panose-1:5 5 1 2 1 2 5 2 2 2;}
@font-face
	{font-family:Candara;
	panose-1:2 14 5 2 3 3 3 2 2 4;}
@font-face
	{font-family:Constantia;
	panose-1:2 3 6 2 5 3 6 3 3 3;}
@font-face
	{font-family:Corbel;
	panose-1:2 11 5 3 2 2 4 2 2 4;}
@font-face
	{font-family:"Wingdings 2";
	panose-1:5 2 1 2 1 5 7 7 7 7;}
@font-face
	{font-family:"Wingdings 3";
	panose-1:5 4 1 2 1 8 7 7 7 7;}
@font-face
	{font-family:"Arial Narrow";
	panose-1:2 11 6 6 2 2 2 3 2 4;}
@font-face
	{font-family:Garamond;
	panose-1:2 2 4 4 3 3 1 1 8 3;}
@font-face
	{font-family:"Bookman Old Style";
	panose-1:2 5 6 4 5 5 5 2 2 4;}
@font-face
	{font-family:"Bookshelf Symbol 7";
	panose-1:5 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:"MS Reference Sans Serif";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"MS Reference Specialty";
	panose-1:5 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Kingsoft Phonetic Plain";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:方正兰亭超细黑简体;
	panose-1:2 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"\@方正兰亭超细黑简体";
	panose-1:2 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:TeamViewer12;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Courier Std";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
h1
	{mso-style-link:"标题 1 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	font-size:15.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:bold;}
h2
	{margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	text-indent:10.0pt;
	font-size:13.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:bold;}
h3
	{margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	text-indent:20.0pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:bold;}
h4
	{margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:normal;}
h5
	{margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:normal;
	font-style:italic;}
h6
	{margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:bold;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"页眉 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	layout-grid-mode:char;
	border:none;
	padding:0cm;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"页脚 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	layout-grid-mode:char;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
code
	{font-family:宋体;}
pre
	{mso-style-link:"HTML 预设格式 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
tt
	{font-family:宋体;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"批注框文本 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Calibri","sans-serif";}
span.MsoPlaceholderText
	{color:gray;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoQuote, li.MsoQuote, div.MsoQuote
	{margin-top:0cm;
	margin-right:36.0pt;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	color:black;}
p.Publishwithline, li.Publishwithline, div.Publishwithline
	{mso-style-name:"Publish with line";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:16.0pt;
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:bold;}
p.PublishStatus, li.PublishStatus, div.PublishStatus
	{mso-style-name:"Publish Status";
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:2.0pt;
	margin-left:0cm;
	background:#FDEB9F;
	border:none;
	padding:0cm;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";}
p.PublishStatusAccessible, li.PublishStatusAccessible, div.PublishStatusAccessible
	{mso-style-name:PublishStatus_Accessible;
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:2.0pt;
	margin-left:0cm;
	border:none;
	padding:0cm;
	font-size:9.0pt;
	font-family:"Calibri","sans-serif";}
p.Account, li.Account, div.Account
	{mso-style-name:Account;
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:9.0pt;
	font-family:"Segoe UI","sans-serif";
	color:#4F81BD;}
p.Categories, li.Categories, div.Categories
	{mso-style-name:Categories;
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:9.0pt;
	font-family:"Segoe UI","sans-serif";
	color:#4F81BD;}
p.PadderBetweenTitleandProperties, li.PadderBetweenTitleandProperties, div.PadderBetweenTitleandProperties
	{mso-style-name:"Padder Between Title and Properties";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:1.0pt;
	margin-left:0cm;
	font-size:1.0pt;
	font-family:"Calibri","sans-serif";}
p.PadderBetweenControlandBody, li.PadderBetweenControlandBody, div.PadderBetweenControlandBody
	{mso-style-name:"Padder Between Control and Body";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	font-size:1.0pt;
	font-family:"Calibri","sans-serif";}
p.underline, li.underline, div.underline
	{mso-style-name:underline;
	margin-top:2.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	border:none;
	padding:0cm;
	font-size:1.0pt;
	font-family:"Calibri","sans-serif";}
span.Char
	{mso-style-name:"批注框文本 Char";
	mso-style-link:批注框文本;}
span.linktitle
	{mso-style-name:link_title;}
span.std
	{mso-style-name:std;}
span.pre
	{mso-style-name:pre;
	font-family:"Fira Mono";}
span.p
	{mso-style-name:p;}
span.s12
	{mso-style-name:s12;
	color:#BA2121;}
span.apple-converted-space
	{mso-style-name:apple-converted-space;}
span.HTMLChar
	{mso-style-name:"HTML 预设格式 Char";
	mso-style-link:"HTML 预设格式";
	font-family:宋体;}
span.caps
	{mso-style-name:caps;}
span.Caption1
	{mso-style-name:Caption1;}
span.colorh1
	{mso-style-name:color_h1;}
span.Title1
	{mso-style-name:Title1;}
p.code, li.code, div.code
	{mso-style-name:code;
	mso-style-link:"code Char";
	margin:0cm;
	margin-bottom:.0001pt;
	background:#D9D9D9;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Courier New";
	color:black;}
span.codeChar
	{mso-style-name:"code Char";
	mso-style-link:code;
	font-family:"Courier New";
	color:black;
	background:#D9D9D9;}
p.codewithbg, li.codewithbg, div.codewithbg
	{mso-style-name:codewithbg;
	mso-style-link:"codewithbg Char";
	margin:0cm;
	margin-bottom:.0001pt;
	layout-grid-mode:char;
	background:#DAEEF3;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Courier New";}
span.codewithbgChar
	{mso-style-name:"codewithbg Char";
	mso-style-link:codewithbg;
	font-family:"Courier New";
	background:#DAEEF3;}
span.1Char
	{mso-style-name:"标题 1 Char";
	mso-style-link:"标题 1";
	font-family:"Calibri","sans-serif";
	color:#17365D;
	font-weight:bold;}
span.kn
	{mso-style-name:kn;}
span.nn
	{mso-style-name:nn;}
span.k
	{mso-style-name:k;}
span.n
	{mso-style-name:n;}
span.nf
	{mso-style-name:nf;}
span.o
	{mso-style-name:o;}
span.s1
	{mso-style-name:s1;}
span.c1
	{mso-style-name:c1;}
span.Char0
	{mso-style-name:"页眉 Char";
	mso-style-link:页眉;}
span.Char1
	{mso-style-name:"页脚 Char";
	mso-style-link:页脚;}
span.desc
	{mso-style-name:desc;}
span.nt
	{mso-style-name:nt;}
span.na
	{mso-style-name:na;}
span.s
	{mso-style-name:s;}
span.kd
	{mso-style-name:kd;}
span.nx
	{mso-style-name:nx;}
span.s2
	{mso-style-name:s2;}
span.kc
	{mso-style-name:kc;}
p.help, li.help, div.help
	{mso-style-name:help;
	margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:宋体;}
span.nc
	{mso-style-name:nc;}
span.sd
	{mso-style-name:sd;}
span.bp
	{mso-style-name:bp;}
span.nb
	{mso-style-name:nb;}
span.cp
	{mso-style-name:cp;}
span.nv
	{mso-style-name:nv;}
span.c
	{mso-style-name:c;}
span.err
	{mso-style-name:err;}
span.msoIns
	{mso-style-name:"";
	text-decoration:underline;
	color:teal;}
span.msoDel
	{mso-style-name:"";
	text-decoration:line-through;
	color:red;}
.MsoChpDefault
	{font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
.MsoPapDefault
	{margin-bottom:10.0pt;}
 /* Page Definitions */
 @page WordSection1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link=blue vlink=purple>

<div class=WordSection1>

<div style='border:solid #FDBD5E 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#FDEB9F'>

<p class=PublishStatus><span lang=EN-US>This post was republished to </span><span
style='font-family:宋体'>汪汪家园</span><span lang=EN-US> at 0:14:21 2017/2/23</span></p>

</div>

<p class=Publishwithline><span lang=EN-US>Zakkabag</span></p>

<div style='border:none;border-bottom:solid #4F81BD 1.0pt;padding:0cm 0cm 2.0pt 0cm'>

<p class=underline><span lang=EN-US>&nbsp;</span></p>

</div>

<p class=PadderBetweenControlandBody><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a href="#_注册登录"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>微信登陆</span></span></a> | <a
href="#_用户扩展"><span lang=EN-US style='font-family:宋体'><span lang=EN-US>用户扩展</span></span></a>
| <a href="#_图片上传"><span lang=EN-US style='font-family:宋体'><span lang=EN-US>图片上传</span></span></a>
| <a href="#_评论"><span lang=EN-US style='font-family:宋体'><span lang=EN-US>评论系统</span></span></a>
| </span><span style='font-family:宋体'>微信支付</span><span lang=EN-US> | </span><span
style='font-family:宋体'>积分支付</span><span lang=EN-US> | <a href="#_Social_Share"><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>社会分享</span></span></a> </span></p>

<h1><span style='font-family:宋体'>微信公众号及微网站</span></h1>

<h2 style='text-indent:26.1pt'><a name="_注册登录"></a><span style='font-family:
宋体'>注册登录</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>普通登录</span></h3>

<p class=MsoNormal style='margin-left:44.0pt'><span style='font-family:宋体;
color:#1F497D'>用户通过手机中微信登录网站</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>这个指的是当前正在浏览该网站，登陆入口的包含微信选项，可以通过微信选项登陆</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>MyUser</span></b></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>Field</span></b></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-left:none;background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  lang=EN-US>Type</span></b></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-left:none;background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>&nbsp;</span></b></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border:solid windowtext 1.0pt;
  border-left:none;background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>Description</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>username</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>unique</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>用户名</span><span lang=EN-US> [</span><span
  style='font-family:宋体'>如果电话注册</span><span lang=EN-US>= phone]</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>phone</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>电话</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>first_name</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>名</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>last_name</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>姓</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>email</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>EmailField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>邮箱</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>sex</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>性别</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>birthday</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>DateField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>生日</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>nickname</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>昵称</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>image</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>ImageField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>头像</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>is_staff</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>BooleanField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:宋体;color:#666666;
  background:white'>职员状态</span></p>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span
  style='font-size:9.0pt;color:black;background:#F5FAFE'>指明用户是否可以登录到这个管理站点。</span></p>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Verdana","sans-serif";color:black;
  background:#F5FAFE'>Boolean. Designates whether this user can access the
  admin site.</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Is_super</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>BooleanField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span
  style='font-size:9.0pt;color:#666666;background:white'>超级用户状态</span></p>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span
  style='font-size:9.0pt;color:black;background:#F5FAFE'>指明该用户缺省拥有所有权限。</span></p>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Verdana","sans-serif";color:black;
  background:#F5FAFE'>Boolean. Designates whether this user account should be
  considered active.&nbsp;</span><span lang=EN-US style='font-size:9.0pt;
  font-family:"Verdana","sans-serif";color:black'><br>
  <span style='background:#F5FAFE'>Set this flag to False instead of deleting
  accounts.</span></span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>is_active</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>BooleanField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span
  style='font-size:9.0pt;color:#666666;background:white'>有效</span></p>
  <p class=help style='margin-top:1.5pt;margin-right:0cm;margin-bottom:1.5pt;
  margin-left:0cm;line-height:12.6pt;vertical-align:middle'><span
  style='font-size:9.0pt;color:black;background:#F5FAFE'>指明用户是否被认为活跃的。以反选代替删除帐号。</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Verdana","sans-serif";
  color:black;background:#F5FAFE'>Boolean. Designates that this user has all
  permissions without explicitly assigning them.</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>date_joined</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>DateTimeField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>加入时间</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>account_type</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>[mail, phone]</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>注册类型</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=228 valign=top style='width:170.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>WechatUserProfile</span></b></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>openid</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>unique</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>unionid</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>privilege</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>权限</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>headimgurl</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>头像</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>nickname</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>昵称</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>sex</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>性别</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>city</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>城市</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>country</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>国家</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>language</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>CharField</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>语言</span></p>
  </td>
 </tr>
 <tr>
  <td width=148 valign=top style='width:110.7pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>user</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>MyUser</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=148 valign=top style='width:110.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=1170 height=54
id="Picture 1" src="Zakkabag.files/image001.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:宋体'>配置</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>首先登录微信测试号，修改授权</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0>
 <tr>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span style='font-family:宋体'>网页帐号</span> </p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="http://mp.weixin.qq.com/wiki/17/c0f37d5704f0b64713d5d2c37b468d75.html"
  target="_blank" title=网页授权获取用户基本信息><span lang=EN-US style='font-family:宋体'><span
  lang=EN-US>网页授权获取用户基本信息</span></span></a></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>127.0.0.1:8000 </span><span
style='font-family:宋体'>本地</span></p>

<p class=MsoNormal><span lang=EN-US>zakkabag.applinzi.com </span><span
style='font-family:宋体'>新浪云服务器</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>确保</span><span lang=EN-US>” </span><u><span
style='font-family:宋体'>微信</span><span lang=EN-US>web</span></u><u><span
style='font-family:宋体'>开发者工具</span></u><span lang=EN-US>”</span><span
style='font-family:宋体'>已安装，这个对微信调试非常有帮助</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>登录入口</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>首先提供微信登录入口，需要</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>在导航条上添加微信登录图标，具体图标可以从</span><span
lang=EN-US>bootstrap</span><span style='font-family:宋体'>上得到</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>在</span><span lang=EN-US>URL</span><span
style='font-family:宋体'>添加入口</span></p>

<p class=MsoNormal><span lang=EN-US>navbar.html</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;li&gt;&lt;a</span><span
lang=EN-US style='color:black'> </span><span lang=EN-US style='color:red'>href</span><span
lang=EN-US style='color:black'>=</span><b><span lang=EN-US>'{% url
&quot;wechatlogin&quot; %}'</span></b><span lang=EN-US style='color:blue'>&gt;&lt;i</span><span
lang=EN-US style='color:black'> </span><span lang=EN-US style='color:red'>class</span><span
lang=EN-US style='color:black'>=</span><b><span lang=EN-US>&quot;fa
fa-weixin&quot;</span></b><span lang=EN-US style='color:black'> aria-hidden=</span><b><span
lang=EN-US>&quot;true&quot;</span></b><span lang=EN-US style='color:blue'>&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>zakkabag.urls.py</span></p>

<p class=codewithbg><span lang=EN-US>urlpatterns <b><span style='color:navy'>=</span></b>
patterns<b><span style='color:navy'>(</span></b><span style='color:gray'>''</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg style='text-indent:24.0pt'><span lang=EN-US>url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^wechatlogin/$'</span><b><span
style='color:navy'>,</span></b> <span style='color:gray'>'wechat.views.wechatlogin'</span><b><span
style='color:navy'>,</span></b> name<b><span style='color:navy'>=</span></b><span
style='color:gray'>'wechatlogin'</span><b><span style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; url</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>r'^logout/$'<b><span
style='color:navy'>,</span></b><span style='color:black'> </span>'newsletter.views.logout'<b><span
style='color:navy'>,</span></b><span style='color:black'> name</span><b><span
style='color:navy'>=</span></b>'logout'<b><span style='color:navy'>),</span></b><span
style='color:black'> </span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; url</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>r'^login/$'</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:gray'>'<a name="OLE_LINK213"></a><a
name="OLE_LINK212">newsletter.views.login</a>'</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US style='color:black'> name</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US style='color:gray'>'login'</span><b><span
lang=EN-US style='color:navy'>),</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>微信授权</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>接下来将在</span><span lang=EN-US>wechatlogin</span><span
style='font-family:宋体'>里面实现授权功能</span></p>

<p class=MsoNormal><span style='font-family:宋体'>关于微信登录的信息可参考：</span><span
lang=EN-US><a href="https://mp.weixin.qq.com/wiki"><b><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>微信公众平台开发者文档</span></span></b></a></span></p>

<p class=MsoNormal><span style='font-family:宋体'>具体的实现我们可参考一个</span><span
lang=EN-US>python library : <a href="https://pypi.python.org/pypi/python-weixin">python-weixin</a></span></p>

<p class=MsoNormal><span style='font-family:宋体'>登录成功后，它会重定向到</span><span
lang=EN-US>login URL</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> weixin<b><span style='color:navy'>.</span></b>client <b><span
style='color:blue'>import</span></b> WeixinMpAPI</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> <span style='color:fuchsia'>wechatlogin</span><b><span
style='color:navy'>(</span></b>request<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REDIRECT_URI
<b><span style='color:navy'>=</span></b> request<b><span style='color:navy'>.</span></b>build_absolute_uri<b><span
style='color:navy'>(</span></b><span style='color:gray'>'/'</span><b><span
style='color:navy'>).</span></b>strip<b><span style='color:navy'>(</span></b><span
style='color:gray'>&quot;/&quot;</span><b><span style='color:navy'>)</span></b>
<b><span style='color:navy'>+</span></b> reverse<b><span style='color:navy'>(</span></b><span
style='color:gray'>&quot;login&quot;</span><b><span style='color:navy'>,</span></b>
kwargs<b><span style='color:navy'>={})</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; api <b><span
style='color:navy'>=</span></b> WeixinMpAPI<b><span style='color:navy'>(</span></b>appid<b><span
style='color:navy'>=</span></b>APP_ID<b><span style='color:navy'>,</span></b>
app_secret<b><span style='color:navy'>=</span></b>APP_SECRET<b><span
style='color:navy'>,</span></b>redirect_uri<b><span style='color:navy'>=</span></b>REDIRECT_URI<b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; redirect_uri
<b><span style='color:navy'>=</span></b> api<b><span style='color:navy'>.</span></b>get_authorize_login_url<b><span
style='color:navy'>(</span></b>scope<b><span style='color:navy'>=(</span></b><span
style='color:gray'>&quot;snsapi_userinfo&quot;</span><b><span style='color:
navy'>,))</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> redirect<b><span style='color:navy'>(</span></b>redirect_uri<b><span
style='color:navy'>)</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>继续登录</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>获得</span><span lang=EN-US>weixin</span><span
style='font-family:宋体'>授权之后，接下来再里</span><a name="OLE_LINK217"></a><a
name="OLE_LINK216"><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:gray'>newsletter.views.login</span></a><span style='font-family:宋体'>实现登录</span><span
style='font-family:宋体'>，中间会用到两个</span><span lang=EN-US>django</span><span
style='font-family:宋体'>函数</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:gray'>authenticate</span><span
style='font-family:宋体'>和</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:gray'>auth.login</span><span style='font-family:
宋体'>。</span></p>

<p class=MsoNormal><span style='font-family:宋体'>如果用户授权失败，则重定向到登录界面</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> <span style='color:fuchsia'>login</span><b><span style='color:navy'>(</span></b>request<b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; REDIRECT_URI <b><span
style='color:navy'>=</span></b> request<b><span style='color:navy'>.</span></b>POST<b><span
style='color:navy'>.</span></b>get<b><span style='color:navy'>(</span></b><span
style='color:gray'>'next'</span><b><span style='color:navy'>,</span></b>
request<b><span style='color:navy'>.</span></b>GET<b><span style='color:navy'>.</span></b>get<b><span
style='color:navy'>(</span></b><span style='color:gray'>'next'</span><b><span
style='color:navy'>,</span></b> reverse<b><span style='color:navy'>(</span></b><span
style='color:gray'>&quot;home&quot;</span><b><span style='color:navy'>,</span></b>
kwargs<b><span style='color:navy'>={}))) </span></b><span style='color:#00B050'>#template</span></span><span
style='font-family:宋体;color:#00B050'>指定的重定向地址</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>if</span></b> request<b><span style='color:navy'>.</span></b>method
<b><span style='color:navy'>==</span></b> <span style='color:gray'>'GET'</span><b><span
style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
code <b><span style='color:navy'>=</span></b> request<b><span style='color:
navy'>.</span></b>GET<b><span style='color:navy'>.</span></b>get<b><span
style='color:navy'>(</span></b><span style='color:gray'>'code'</span><b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>if</span></b> code<b><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:black'>redirect_to </span><b><span style='color:navy'>=</span></b><span
style='color:black'> </span><span style='color:gray'>&quot;<u>http://%s%s</u>&quot;</span><span
style='color:black'> </span><b><span style='color:navy'>%</span></b><span
style='color:black'> </span><b><span style='color:navy'>(</span></b><span
style='color:black'>request</span><b><span style='color:navy'>.</span></b><span
style='color:black'>META</span><b><span style='color:navy'>[</span></b><span
style='color:gray'>'HTTP_HOST'</span><b><span style='color:navy'>],</span></b><span
style='color:black'> reverse</span><b><span style='color:navy'>(</span></b><span
style='color:gray'>&quot;home&quot;</span><b><span style='color:navy'>,</span></b><span
style='color:black'> kwargs</span><b><span style='color:navy'>={}))</span></b><span
style='color:#00B050'>#</span></span><span style='font-family:宋体;color:#00B050'>登录成功后的登录地址</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
api <b><span style='color:navy'>=</span></b> WeixinMpAPI<b><span
style='color:navy'>(</span></b>appid<b><span style='color:navy'>=</span></b>APP_ID<b><span
style='color:navy'>,</span></b> </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
app_secret<b><span style='color:navy'>=</span></b>APP_SECRET<b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
redirect_uri<b><span style='color:navy'>=</span></b>redirect_to<b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_info <b><span style='color:navy'>=</span></b> api<b><span
style='color:navy'>.</span></b>exchange_code_for_access_token<b><span
style='color:navy'>(</span></b>code<b><span style='color:navy'>=</span></b>code<b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
api <b><span style='color:navy'>=</span></b> WeixinMpAPI<b><span
style='color:navy'>(</span></b>access_token<b><span style='color:navy'>=</span></b>auth_info<b><span
style='color:navy'>[</span></b><span style='color:gray'>'access_token'</span><b><span
style='color:navy'>])</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
api_user <b><span style='color:navy'>=</span></b> api<b><span style='color:
navy'>.</span></b>user<b><span style='color:navy'>(</span></b>openid<b><span
style='color:navy'>=</span></b>auth_info<b><span style='color:navy'>[</span></b><span
style='color:gray'>'openid'</span><b><span style='color:navy'>])</span></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>user <b><span style='color:navy'>=</span></b> <a
name="OLE_LINK219"></a><a name="OLE_LINK218">authenticate</a><b><span
style='color:navy'>(</span></b>request<b><span style='color:navy'>=</span></b>request<b><span
style='color:navy'>,</span></b> user<b><span style='color:navy'>=</span></b>api_user<b><span
style='color:navy'>)</span></b></span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>if</span></b> user<b><span style='color:navy'>: </span></b><span
style='color:navy'>#</span></span><span style='font-family:宋体;color:navy'>如果用户授权失败，则重定向到登录界面</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth<b><span style='color:navy'>.</span></b>login<b><span style='color:navy'>(</span></b>request<b><span
style='color:navy'>,</span></b> user<b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>return</span></b> redirect<b><span
style='color:navy'>(</span></b>redirect_to<b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>return</span></b> redirect<b><span
style='color:navy'>(</span></b>reverse<b><span style='color:navy'>(</span></b><span
style='color:gray'>&quot;auth_login&quot;</span><b><span style='color:navy'>,</span></b>
kwargs<b><span style='color:navy'>={}))</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> auth_views<b><span style='color:navy'>.</span></b>login<b><span
style='color:navy'>(</span></b>request<b><span style='color:navy'>,</span></b>
redirect_field_name<b><span style='color:navy'>=</span></b>REDIRECT_URI<b><span
style='color:navy'>,</span></b> extra_context<b><span style='color:navy'>=</span><span
style='color:blue'>None</span><span style='color:navy'>)</span></b>&nbsp; </span></p>

<p class=MsoNormal><span style='font-family:宋体;color:red'>特别注意的是</span><span
style='font-family:宋体'>，这边登录用了</span><span lang=EN-US>authenticate</span><span
style='font-family:宋体'>函数，参数第二个变成了</span><span lang=EN-US>user</span><span
style='font-family:宋体'>，这个其实已经对登录的后台进行了扩展，具体可参考章节“<b>用户扩展</b>”</span></p>

<p class=MsoNormal><span style='font-family:宋体'>登录成功后需要在</span><span
lang=EN-US>templates.navbar.html</span><span style='font-family:宋体'>修改图标为已登录状态</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% if request.user.is_authenticated
%}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>{% if request.user.<a name="OLE_LINK215"></a><a
name="OLE_LINK214">account_type</a> == 'wechat' %}</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>'{{request.user.get_absolute_url}}'</span>}<span
style='color:blue'>&gt;</span>{{request.user.get_wechatprofile}}<span
style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span> </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>&quot;{% url 'logout' %}&quot;</span><span
style='color:blue'>&gt;</span>Logout<span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% else %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>&quot;{{request.user.get_absolute_url}}&quot;</span><span
style='color:blue'>&gt;</span>{{request.user}}<span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span>
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>&quot;{% url 'logout' %}&quot;</span><span
style='color:blue'>&gt;</span>Logout<span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% endif %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>{% elif request.wechat %}</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>&quot;{{request.wechat.get_absolute_url}}&quot;</span><span
style='color:blue'>&gt;</span>{{request.wechat}}<span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span>
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>&quot;{% url 'logout' %}&quot;</span><span
style='color:blue'>&gt;</span>Logout<span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span>&nbsp;
<s>&nbsp;&nbsp;</s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% else %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>&quot;{% url 'registration_register' %}&quot;</span><span
style='color:blue'>&gt;</span>Register<span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;li&gt;&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>'{% url &quot;wechatlogin&quot; %}'</span><span
style='color:blue'>&gt;&lt;i</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>&quot;fa fa-weixin&quot;</span> aria-hidden=<span
style='color:#8000FF'>&quot;true&quot;</span><span style='color:blue'>&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% endif %}</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>退出登录</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:gray'>newsletter.views.logout</span><span
style='font-family:宋体'>实现注销，会调用系统函数</span><span lang=EN-US style='font-size:
10.0pt;font-family:"Courier New";color:gray'>auth.logout</span><span
style='font-family:宋体'>。</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> <span style='color:fuchsia'>logout</span><b><span style='color:
navy'>(</span></b>request<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>try</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>del</span></b> request<b><span style='color:navy'>.</span></b>session<b><span
style='color:navy'>[</span></b><span style='color:gray'>'wechat_id'</span><b><span
style='color:navy'>]</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>except</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>pass</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; auth<b><span
style='color:navy'>.</span></b>logout<b><span style='color:navy'>(</span></b>request<b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> redirect<b><span style='color:navy'>(</span></b>reverse<b><span
style='color:navy'>(</span></b><span style='color:gray'>&quot;home&quot;</span><b><span
style='color:navy'>,</span></b> kwargs<b><span style='color:navy'>={}))</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US><a
href="http://www.cnblogs.com/cacique/p/4293348.html"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>网站微信登录－</span></span>python <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>实现</span></span></a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US><a
href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;lang=zh_CN&amp;tab=dev">https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;lang=zh_CN&amp;tab=dev</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US><a href="https://github.com/gusibi/python-weixin">https://github.com/gusibi/python-weixin</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US><a
href="http://gusibi.github.io/post/weixin-python-login/">http://gusibi.github.io/post/weixin-python-login/</a></span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>第三方登录</span></h3>

<p class=MsoNormal style='margin-left:44.0pt'><span style='font-family:宋体;
color:#1F497D'>可以通过微信直接登录微网站，减少登录流程</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>访问网站时，因为是从微信客户端进入的，所以自动登陆</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>用户注册</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>用户通过手机注册成为会员，推荐使用手机号注册保证用户的真实性和唯一性，收集准确的会员资料，为后期营销增加有效的用户量</span></p>

<p class=MsoNormal><span lang=EN-US><a href="https://leancloud.cn/">https://leancloud.cn/</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>手机注册</span><span lang=EN-US>/</span><span
style='font-family:宋体'>登陆参考</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://pypi.python.org/pypi/django-phone-login"><span style='font-family:
"Segoe UI","sans-serif";color:#0366D6;background:white'>django-phone-login</span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://pypi.python.org/pypi/django_mobile_auth"><span style='font-family:
"Segoe UI","sans-serif";color:#0366D6;background:#F6F8FA'>django_mobile_auth</span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>参考</span><span lang=EN-US><a
href="https://github.com/macropin/django-registration"><span style='font-family:
"Segoe UI","sans-serif";color:#0366D6;background:#F6F8FA'>django-registration-redux</span></a></span><span
style='font-family:宋体'>实现</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>login, logout </span><span
style='font-family:宋体'>直接调用</span><span lang=EN-US>django</span><span
style='font-family:宋体'>默认的函数，指定</span><span lang=EN-US>template</span><span
style='font-family:宋体'>文件</span></p>

<p class=MsoNormal><span lang=EN-US>password</span><span style='font-family:
宋体'>的<u>修改</u>和完成提示，同样调用</span><span lang=EN-US>django</span><span
style='font-family:宋体'>默认的函数，</span><span lang=EN-US>template</span><span
style='font-family:宋体'>沿用默认文件名（未特别指定）</span></p>

<p class=MsoNormal><span lang=EN-US>password</span><span style='font-family:
宋体'>的<u>复位</u>，也是通过</span><span lang=EN-US>django</span><span style='font-family:
宋体'>默认的函数，所有这些</span><span lang=EN-US>template</span><span style='font-family:
宋体'>都在</span><span lang=EN-US style='color:gray'>root/template/registration</span><span
style='font-family:宋体'>目录下面</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:宋体;color:black;background:white'>文件</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black;background:white'>registration</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>/</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:white'>auth_urls</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>.</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:white'>py</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black;background:white'>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> django<b><span style='color:navy'>.</span></b>contrib<b><span
style='color:navy'>.</span></b>auth <b><span style='color:blue'>import</span></b>
views <b><span style='color:blue'>as</span></b> auth_views</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>urlpatterns <b><span style='color:navy'>=</span></b>
<b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^login/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>login</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>{</span></b><span style='color:gray'>'<span
style='background:yellow'>template_name</span>'</span><b><span
style='color:navy'>:</span></b> <span style='color:gray'>'registration/login.html'</span><b><span
style='color:navy'>},</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_login'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^logout/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>logout</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>{</span></b><span style='color:gray'>'<span
style='background:yellow'>template_name</span>'</span><b><span
style='color:navy'>:</span></b> <span style='color:gray'>'registration/logout.html'</span><b><span
style='color:navy'>},</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_logout'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^password/change/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>password_change</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>{</span></b><span style='color:gray'>'post_change_redirect'</span><b><span
style='color:navy'>:</span></b> reverse_lazy<b><span style='color:navy'>(</span></b><span
style='color:gray'>'auth_password_change_done'</span><b><span style='color:
navy'>)},</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_change'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^password/change/done/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>password_change_done</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_change_done'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^password/reset/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>password_reset</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>{</span></b><span style='color:gray'>'post_reset_redirect'</span><b><span
style='color:navy'>:</span></b> reverse_lazy<b><span style='color:navy'>(</span></b><span
style='color:gray'>'auth_password_reset_done'</span><b><span style='color:navy'>)},</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_reset'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^password/reset/complete/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>password_reset_complete</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_reset_complete'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^password/reset/done/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>password_reset_done</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_reset_done'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>]</span></b></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>if</span></b><span
lang=EN-US> <b><span style='color:navy'>(</span></b>LooseVersion<b><span
style='color:navy'>(</span></b>get_version<b><span style='color:navy'>())</span></b>
<b><span style='color:navy'>&gt;=</span></b> LooseVersion<b><span
style='color:navy'>(</span></b><span style='color:gray'>'1.6'</span><b><span
style='color:navy'>)):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; urlpatterns <b><span
style='color:navy'>+=</span></b> <b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url<b><span style='color:navy'>(</span></b><span style='color:gray'>r'^password/reset/confirm/(?P&lt;uidb64&gt;[0-9A-Za-z_\-]+)/(?P&lt;token&gt;.+)/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b><span style='background:yellow'>password_reset_confirm</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>{</span></b><span style='color:gray'>'post_reset_redirect'</span><b><span
style='color:navy'>:</span></b> reverse_lazy<b><span style='color:navy'>(</span></b><span
style='color:gray'>'auth_password_reset_complete'</span><b><span
style='color:navy'>)},</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_reset_confirm'</span><b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:navy'>]</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>else</span><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; urlpatterns <b><span
style='color:navy'>+=</span></b> <b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url<b><span style='color:navy'>(</span></b><span style='color:gray'>r'^password/reset/confirm/(?P&lt;uidb36&gt;[0-9A-Za-z]{1,13})-(?P&lt;token&gt;[0-9A-Za-z]{1,13}-[0-9A-Za-z]{1,20})/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_views<b><span style='color:navy'>.</span></b>password_reset_confirm<b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>{</span></b><span style='color:gray'>'post_reset_redirect'</span><b><span
style='color:navy'>:</span></b> reverse_lazy<b><span style='color:navy'>(</span></b><span
style='color:gray'>'auth_password_reset_complete'</span><b><span
style='color:navy'>)},</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'auth_password_reset_confirm'</span><b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:navy'>]</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>用户的注册和激活是通过自定义的函数实现的</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>urlpatterns <b><span style='color:navy'>=</span></b>
<b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^activate/complete/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TemplateView<b><span style='color:navy'>.</span></b>as_view<b><span
style='color:navy'>(</span></b>template_name<b><span style='color:navy'>=</span></b><span
style='color:gray'>'registration/activation_complete.html'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'registration_activation_complete'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'># Activation keys get matched by \w+ instead of the more specific</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'># [a-fA-F0-9]{40} because a bad activation key should still get to the
view;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'># that way it can return a sensible &quot;invalid key&quot; message
instead of a</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'># confusing 404.</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^<span
style='background:yellow'>activate</span>/(?P&lt;activation_key&gt;\w+)/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ActivationView<b><span style='color:navy'>.</span></b>as_view<b><span
style='color:navy'>(),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'registration_activate'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^<span
style='background:yellow'>register/complete</span>/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TemplateView<b><span style='color:navy'>.</span></b>as_view<b><span
style='color:navy'>(</span></b>template_name<b><span style='color:navy'>=</span></b><span
style='color:gray'>'registration/registration_complete.html'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'registration_complete'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^<span
style='background:yellow'>register/closed</span>/$'</span><b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TemplateView<b><span style='color:navy'>.</span></b>as_view<b><span
style='color:navy'>(</span></b>template_name<b><span style='color:navy'>=</span></b><span
style='color:gray'>'registration/registration_closed.html'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'registration_disallowed'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>]</span></b></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>if</span></b><span
lang=EN-US> getattr<b><span style='color:navy'>(</span></b>settings<b><span
style='color:navy'>,</span></b> <span style='color:gray'>'INCLUDE_REGISTER_URL'</span><b><span
style='color:navy'>,</span></b> <b><span style='color:blue'>True</span><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; urlpatterns <b><span
style='color:navy'>+=</span></b> <b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url<b><span style='color:navy'>(</span></b><span style='color:gray'>r'^<span
style='background:yellow'>register</span>/$'</span><b><span style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
RegistrationView<b><span style='color:navy'>.</span></b>as_view<b><span
style='color:navy'>(),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'registration_register'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:navy'>]</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>if</span></b><span
lang=EN-US> getattr<b><span style='color:navy'>(</span></b>settings<b><span
style='color:navy'>,</span></b> <span style='color:gray'>'INCLUDE_AUTH_URLS'</span><b><span
style='color:navy'>,</span></b> <b><span style='color:blue'>True</span><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; urlpatterns <b><span
style='color:navy'>+=</span></b> <b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url<b><span style='color:navy'>(</span></b><span style='color:gray'>r''</span><b><span
style='color:navy'>,</span></b> include<b><span style='color:navy'>(</span></b><span
style='color:gray'>'registration.auth_urls'</span><b><span style='color:navy'>)),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:navy'>]</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Registration-redux</span><span
style='font-family:宋体'>仅仅实现了邮箱注册功能，要实现手机注册功能，需要做如下修改</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:宋体'>扩展用户，添加</span><span lang=EN-US>phone</span><span
style='font-family:宋体'>相关字段</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>33</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>忘记密码</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可通过忘记密码模块可找回帐号，保证用户信息和积分不会丢失，增加用户体验</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>个人中心</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>个人信息展示</span></h3>

<p class=MsoNormal style='margin-left:44.0pt'><span style='font-family:宋体'>展示头像用户名等级及其它用户信息</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>创建</span><span lang=EN-US>APP :
personalcenter</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>上传头像</span></h3>

<p class=MsoNormal style='margin-left:44.0pt'><span style='font-family:宋体'>通过网站可以修改头像</span></p>

<h4><span style='font-family:宋体'>后台上传</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>细节可参考</span><span lang=EN-US>ecommerce
<a name="_Toc476467681">017 Image Uploads</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/ref/forms/fields/#django.forms.ImageField">https://docs.djangoproject.com/en/1.8/ref/forms/fields/#django.forms.ImageField</a></span></p>

<p class=MsoNormal><span class=MsoHyperlink><span lang=EN-US><span
 style='text-decoration:none'>&nbsp;</span></span></span></p>

<p class=MsoNormal><span style='font-family:宋体'>在用户里面添加</span><span lang=EN-US>image</span><span
style='font-family:宋体'>域，并通过</span><span lang=EN-US>upload_to</span><span
style='font-family:宋体'>函数指定保存方法</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> <span style='color:fuchsia'>image_upload_to</span><b><span
style='color:navy'>(</span></b>instance<b><span style='color:navy'>,</span></b>
filename<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; name <b><span
style='color:navy'>=</span></b> instance<b><span style='color:navy'>.</span></b>username</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; title<b><span
style='color:navy'>,</span></b> file_extension <b><span style='color:navy'>=</span></b>
filename<b><span style='color:navy'>.</span></b>split<b><span style='color:
navy'>(</span></b><span style='color:gray'>&quot;.&quot;</span><b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; new_filename <b><span
style='color:navy'>=</span></b> <span style='color:gray'>&quot;%s-%s.%s&quot;</span>
<b><span style='color:navy'>%(</span></b>instance<b><span style='color:navy'>.</span></b>id<b><span
style='color:navy'>,</span></b> slugify<b><span style='color:navy'>(</span></b>title<b><span
style='color:navy'>),</span></b> file_extension<b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> <span style='color:gray'>&quot;<span
style='background:aqua'>profile/%s/%s&quot;</span></span><span
style='background:aqua'> <b><span style='color:navy'>%(</span></b>name<b><span
style='color:navy'>,</span></b> new_filename</span><b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:green'>#Copy from
AbstractUser</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>MyUser<span style='color:navy'>(</span></b>AbstractBaseUser<b><span
style='color:navy'>,</span></b> PermissionsMixin<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; image <b><span
style='color:navy'>=</span></b> models<b><span style='color:navy'>.</span></b>ImageField<b><span
style='color:navy'>(</span></b>upload_to<b><span style='color:navy'>=</span></b>image_upload_to<b><span
style='color:navy'>)</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='background:yellow'>MEDIA_URL</span><span
lang=EN-US> <b><span style='color:navy'>=</span></b> <span style='color:gray'>'/media/'</span></span></p>

<p class=codewithbg><span lang=EN-US style='background:lime'>MEDIA_ROOT</span><span
lang=EN-US> <b><span style='color:navy'>=</span></b> os<b><span
style='color:navy'>.</span></b>path<b><span style='color:navy'>.</span></b>join<b><span
style='color:navy'>(</span></b>BASE_DIR<b><span style='color:navy'>,</span></b>
<span style='color:gray'>&quot;static_in_env&quot;</span><b><span
style='color:navy'>,</span></b> <span style='color:gray'>&quot;media_root&quot;</span><b><span
style='color:navy'>)</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Admin</span><span style='font-family:宋体'>后台显示：<b><span
style='color:#666666;background:white'>目前</span></b></span><b><span lang=EN-US
style='color:#666666;background:white'>:<span class=apple-converted-space>&nbsp;</span></span></b><span
lang=EN-US><a href="http://127.0.0.1:8000/media/profile/bhe001/1-6-lock.jpg"><span
style='color:#003366;background:white'>profile/bhe001/1-6-lock.jpg</span></a></span><span
class=apple-converted-space><b><span lang=EN-US style='color:#666666;
background:white'>&nbsp;&nbsp;</span></b></span></p>

<p class=MsoNormal><span style='font-family:宋体'>访问网站：</span><span lang=EN-US><a
href="http://127.0.0.1:8000/media/profile/bhe001/1-6-lock.jpg"><span
style='background:lightgrey'>http://127.0.0.1:8000</span>/<span
style='background:yellow'>media/</span><span style='background:aqua'>profile/bhe001/1-6-lock.jpg</span></a></span></p>

<p class=MsoNormal><span style='font-family:宋体'>本地文件保存位置：</span><span
lang=EN-US style='background:lightgrey'>d:\virtualenv\zakkabag\zakkabag</span><span
lang=EN-US>\<span style='background:lime'>static_in_env\media_root</span>\<span
style='background:aqua'>profile\bhe001\1-6-lock.jpg</span></span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-family:宋体;
color:black;background:white'>同样的名字，如果继续覆盖，文件不会被覆盖，而是增加随机数重新拷贝一个</span></p>

<p class=MsoNormal><b><span style='font-family:宋体;color:#666666;background:
white'>目前</span></b><b><span lang=EN-US style='color:#666666;background:white'>:<span
class=apple-converted-space>&nbsp;</span></span></b><span lang=EN-US><a
href="http://127.0.0.1:8000/media/profile/bhe001/1-6-lock_Ni9llB7.jpg"><span
style='color:#003366;background:white'>profile/bhe001/1-6-lock_Ni9llB7.jpg</span></a></span><span
class=apple-converted-space><b><span lang=EN-US style='color:#666666;
background:white'>&nbsp;</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>前台上传</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>首先在</span><span lang=EN-US>personalcenter.templates.personcalcenter.profile_detail.html</span><span
style='font-family:宋体'>添加</span><span lang=EN-US>img</span><span
style='font-family:宋体'>相关元素</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span class=codewithbgChar><span lang=EN-US
style='font-size:10.0pt'>{{form}}</span></span><span style='font-family:宋体'>会显示</span><span
lang=EN-US>img</span><span style='font-family:宋体'>组件，但这个不一定是我想要的格式。<span
style='color:red'>可能需要修改</span>。</span></p>

<p class=MsoNormal><span class=codewithbgChar><span lang=EN-US
style='font-size:10.0pt'>&lt;img&nbsp; id='img' class= 'img-responsive'
src=&quot;{{object.get_image_url}}&quot;/&gt;</span></span><span
style='font-family:宋体'>会把图片显示出来</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体;color:black'>在表单中加入</span><span
lang=EN-US><a href="http://www.w3school.com.cn/tags/att_form_enctype.asp">enctype</a></span><span
lang=EN-US style='color:black'>=&quot;multipart/form-data</span><span
style='font-family:宋体;color:black'>；如果不加</span><span class=codewithbgChar><span
lang=EN-US style='font-size:10.0pt'>enctype=&quot;multipart/form-data</span></span><span
style='font-family:宋体;color:black'>：得不到图片信息，只有路径</span></p>

<p class=MsoNormal><span lang=EN-US>FILES</span><span style='font-family:宋体'>是个字典，它包含每个</span><span
lang=EN-US>FileField</span><span style='font-family:宋体'>的键</span> <span
lang=EN-US>(</span><span style='font-family:宋体'>或者</span><span lang=EN-US>ImageField</span><span
style='font-family:宋体'>，</span><span lang=EN-US>FileField</span><span
style='font-family:宋体'>的子类</span><span lang=EN-US>)</span><span
style='font-family:宋体'>。这样的话就可以用</span><span class=codewithbgChar><span
lang=EN-US style='font-size:10.0pt'>request.FILES['File']</span></span><span
style='font-family:宋体'>来存放表单中的这些数据了。</span> </p>

<p class=MsoNormal><span style='font-family:宋体'>注意</span><span lang=EN-US>request.FILES</span><span
style='font-family:宋体'>只有在请求方法为</span><span lang=EN-US>POST</span><span
style='font-family:宋体'>，并且发送请求的</span><span lang=EN-US>&lt;form&gt;</span><span
style='font-family:宋体'>拥有</span><span lang=EN-US>enctype=&quot;multipart/form-data</span><span
style='font-family:宋体'>属性时，才会包含数据。否则</span><span lang=EN-US>request.FILES</span><span
style='font-family:宋体'>为空</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>{% extends &quot;base.html&quot; %}</span></p>

<p class=codewithbg><span lang=EN-US>{% load crispy_forms_tags %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>{% block content %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;div</span><span
lang=EN-US> <span style='color:red'>class</span>=<span style='color:#8000FF'>'col-sm-6
col-sm-offset-3'</span><span style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;h3&gt;</span>{{ object }}<span style='color:blue'>&lt;/h3&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;form</span> <span style='color:red'>method</span>=<span
style='color:#8000FF'>&quot;POST&quot;</span> <span style='color:red;
background:lime'>enctype</span><span style='background:lime'>=<span
style='color:#8000FF'>&quot;multipart/form-data&quot;</span></span> <span
style='color:red'>action</span>=<span style='color:#8000FF'>&quot;&quot;</span><span
style='color:blue'>&gt;</span> {% csrf_token %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{form|crispy}}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;img</span>&nbsp; <span style='color:red'>id</span>=<span
style='color:#8000FF'>'img'</span> <span style='color:red'>class</span>= <span
style='color:#8000FF'>'img-responsive'</span> <span style='color:red'>src</span>=<span
style='color:#8000FF'>&quot;{{object.get_image_url}}&quot;</span><span
style='color:blue'>/&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;br&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;input</span> <span style='color:red'>type</span>=<span
style='color:#8000FF'>&quot;submit&quot;</span> <span style='color:red'>value</span>=<span
style='color:#8000FF'>'Update'</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>'btn'</span> <span style='color:blue'>/&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;/form&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>{% endblock %}</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US>personalcenter.views.py
</span><span style='font-family:宋体'>中添加对</span><span lang=EN-US>form</span><span
style='font-family:宋体'>的处理</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>class</span><span
lang=EN-US> ProfileDetailView<span style='color:navy'>(</span>FormMixin<span
style='color:navy'>,</span> DetailView<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; model <span
style='color:navy'>=</span> UserModel</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; template_name <span
style='color:navy'>=</span> <span style='color:gray'>&quot;personalcenter/profile_detail.html&quot;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; form_class <span
style='color:navy'>=</span> MyUserForm <span style='color:green'>#</span></span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#141;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#142;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>def</span> <span style='color:fuchsia'>get_context_data</span><span
style='color:navy'>(</span>self<span style='color:navy'>,</span> <span
style='color:navy'>*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context <span style='color:navy'>=</span> super<span style='color:navy'>(</span>ProfileDetailView<span
style='color:navy'>,</span> self<span style='color:navy'>).</span>get_context_data<span
style='color:navy'>(*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>context<span style='color:navy'>[</span><span
style='color:gray'>&quot;form&quot;</span><span style='color:navy'>]</span> <span
style='color:navy'>=</span> self<span style='color:navy'>.</span>form_class<span
style='color:navy'>(</span>instance <span style='color:navy'>=</span> self<span
style='color:navy'>.</span>get_object<span style='color:navy'>())</span></span>
&nbsp;<span style='color:green'>#</span></span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#141;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> context</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>def</span> <span style='color:fuchsia'>get_object</span><span
style='color:navy'>(</span>self<span style='color:navy'>,</span> <span
style='color:navy'>*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user_pk <span style='color:navy'>=</span> self<span style='color:navy'>.</span>kwargs<span
style='color:navy'>.</span>get<span style='color:navy'>(</span><span
style='color:gray'>&quot;id&quot;</span><span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usemodel <span style='color:navy'>=</span> <span style='color:blue'>None</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>if</span> user_pk<span style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usemodel <span style='color:navy'>=</span> get_object_or_404<span
style='color:navy'>(</span>UserModel<span style='color:navy'>,</span> pk<span
style='color:navy'>=</span>user_pk<span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> usemodel </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>def</span> <span style='color:fuchsia'>get_success_url</span><span
style='color:navy'>(</span>self<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> reverse<span style='color:navy'>(</span><span
style='color:gray'>&quot;personalcenter&quot;</span><span style='color:navy'>,</span>
kwargs<span style='color:navy'>=</span>self<span style='color:navy'>.</span>kwargs<span
style='color:navy'>)</span>&nbsp;&nbsp;&nbsp; </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>def</span> <span style='color:fuchsia'>post</span><span style='color:
navy'>(</span>self<span style='color:navy'>,</span> request<span
style='color:navy'>,</span> <span style='color:navy'>*</span>args<span
style='color:navy'>,</span> <span style='color:navy'>**</span>kwargs<span
style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
form <span style='color:navy'>=</span> <span style='background:lime'>self<span
style='color:navy'>.</span>get_form<span style='color:navy'>()</span></span><span
style='color:green'>#</span></span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#142;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>if</span> form<span style='color:navy'>.</span>is_valid<span
style='color:navy'>():</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel <span style='color:navy'>=</span> UserModel<span style='color:navy'>.</span>objects<span
style='color:navy'>.</span>get<span style='color:navy'>(</span>id<span
style='color:navy'>=</span>self<span style='color:navy'>.</span>kwargs<span
style='color:navy'>.</span>get<span style='color:navy'>(</span><span
style='color:gray'>&quot;id&quot;</span><span style='color:navy'>))</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>first_name <span style='color:navy'>=</span>
form<span style='color:navy'>.</span>cleaned_data<span style='color:navy'>[</span><span
style='color:gray'>'first_name'</span><span style='color:navy'>]</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>last_name <span style='color:navy'>=</span>
form<span style='color:navy'>.</span>cleaned_data<span style='color:navy'>[</span><span
style='color:gray'>'last_name'</span><span style='color:navy'>]</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>if</span> <span style='color:gray'>'image'</span> <span
style='color:blue'>in</span> form<span style='color:navy'>.</span>cleaned_data<span
style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>usermodel<span style='color:navy'>.</span>image <span
style='color:navy'>=</span> form<span style='color:navy'>.</span>cleaned_data<span
style='color:navy'>[</span><span style='color:gray'>'image'</span><span
style='color:navy'>]</span></span><span style='color:navy'> </span><span
style='color:green'>#</span></span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#143;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>save<span style='color:navy'>()</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> self<span style='color:navy'>.</span>form_valid<span
style='color:navy'>(</span>form<span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>else</span><span style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> self<span style='color:navy'>.</span>form_invalid<span
style='color:navy'>(</span>form<span style='color:navy'>)</span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span
lang=EN-US style='color:green'> </span><span lang=EN-US>Form class</span></p>

<p class=MsoNormal><i><span lang=EN-US style='background:yellow'>form_class <span
style='color:navy'>=</span> MyUserForm</span></i></p>

<p class=MsoNormal><span style='font-family:宋体'>定义</span><span lang=EN-US>form_class</span><span
style='font-family:宋体'>，后面通过通过</span><span lang=EN-US>get_form_class()</span><span
style='font-family:宋体'>或</span><span lang=EN-US>get_form()</span><span
style='font-family:宋体'>获取</span><span lang=EN-US>form</span><span
style='font-family:宋体'>相关的内容</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#141;</span><span
lang=EN-US style='color:green'> </span><i><span lang=EN-US style='background:
yellow'>context<span style='color:navy'>[</span><span style='color:gray'>&quot;form&quot;</span><span
style='color:navy'>]</span> <span style='color:navy'>=</span> self<span
style='color:navy'>.</span>form_class<span style='color:navy'>(</span>instance <span
style='color:navy'>=</span> self<span style='color:navy'>.</span>get_object<span
style='color:navy'>())</span></span></i></p>

<p class=MsoNormal><span lang=EN-US>Profile</span><span style='font-family:
宋体'>是</span><span lang=EN-US>DetailView</span><span style='font-family:宋体'>，本来是不带</span><span
lang=EN-US>form</span><span style='font-family:宋体'>的，<span style='background:
lime'>如果要支持</span></span><span lang=EN-US style='background:lime'>image</span><span
style='font-family:宋体;background:lime'>功能，必须支持</span><span lang=EN-US
style='background:lime'>form</span><span style='font-family:宋体;background:lime'>，所以我们添加了基类</span><span
lang=EN-US style='background:lime'>FormMixin</span><span style='font-family:
宋体'>。在</span><span lang=EN-US>form_class</span><span style='font-family:宋体'>指定</span><span
lang=EN-US>form</span><span style='font-family:宋体'>类型，并且在</span><span
lang=EN-US>context</span><span style='font-family:宋体'>里面将</span><span
lang=EN-US>form</span><span style='font-family:宋体'>数据传递给</span><span
lang=EN-US>templates</span><span style='font-family:宋体'>。这儿根据</span><span
lang=EN-US>object</span><span style='font-family:宋体'>内容对</span><span
lang=EN-US>form</span><span style='font-family:宋体'>进行了初始化。</span></p>

<p class=MsoNormal><span style='font-family:宋体'>如果是</span><span lang=EN-US>CreateView
(</span><span style='font-family:宋体'>例如</span><span lang=EN-US>ProductCreateView)</span><span
style='font-family:宋体'>，它的基类有</span><span lang=EN-US>FormMixin</span><span
style='font-family:宋体'>，所以</span><span lang=EN-US>form_class</span><span
style='font-family:宋体'>是默认已定义的，不需要额外添加</span><span lang=EN-US>FormMixin</span><span
style='font-family:宋体'>。不过，如果要添加额外的</span><span lang=EN-US>form</span><span
style='font-family:宋体'>，同样需要在</span><span lang=EN-US>context</span><span
style='font-family:宋体'>里面传递</span></p>

<p class=MsoNormal><span style='font-family:宋体'>更新</span><span lang=EN-US>form</span><span
style='font-family:宋体'>内容除了通过</span><span lang=EN-US>instance</span><span
style='font-family:宋体'>，也可以直接更新</span><span lang=EN-US>queryset</span><span
style='font-family:宋体'>，例如</span><span lang=EN-US>form.fields['categories'].queryset
= Category.objects.all()</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span
lang=EN-US style='color:green'> </span><i><span lang=EN-US style='background:
yellow'>form <span style='color:navy'>=</span> self<span style='color:navy'>.</span>get_form<span
style='color:navy'>()</span></span></i></p>

<p class=MsoNormal><span lang=EN-US>get_form()</span><span style='font-family:
宋体'>会根据定义的</span><span lang=EN-US>form_class</span><span style='font-family:
宋体'>获取</span><span lang=EN-US>form</span><span style='font-family:宋体'>类，并根据传递的参数初始化或实例化</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在该例子中，我们可以用下面句子代替图片信息获取内容</span><span
lang=EN-US>form = self.form_class(request.POST, <span style='background:yellow'>request.FILES</span>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>具体可参考</span><span lang=EN-US>class
FormMixin(six.with_metaclass(FormMixinBase, ContextMixin)):</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>FormMixin<span style='color:navy'>(</span></b>six<b><span
style='color:navy'>.</span></b>with_metaclass<b><span style='color:navy'>(</span></b>FormMixinBase<b><span
style='color:navy'>,</span></b> ContextMixin<b><span style='color:navy'>)):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>def</span></b> <span style='color:fuchsia'>get_form_class</span><b><span
style='color:navy'>(</span></b>self<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:#FF8000'>&quot;&quot;&quot;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Returns the form class to use in this view</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>return</span></b> self<b><span style='color:navy'>.</span></b>form_class</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>def</span></b> <span style='color:fuchsia'>get_form</span><b><span
style='color:navy'>(</span></b>self<b><span style='color:navy'>,</span></b>
form_class<b><span style='color:navy'>=</span><span style='color:blue'>None</span><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:#FF8000'>&quot;&quot;&quot;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Returns an instance of the form to be used in this view.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>if</span></b> form_class <b><span style='color:
blue'>is</span></b> <b><span style='color:blue'>None</span><span
style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
form_class <b><span style='color:navy'>=</span></b> self<b><span
style='color:navy'>.</span></b>get_form_class<b><span style='color:navy'>()</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>return</span></b> form_class<b><span
style='color:navy'>(**</span></b>self<b><span style='color:navy'>.</span></b>get_form_kwargs<b><span
style='color:navy'>())</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>def</span></b> <span style='color:fuchsia'>get_form_kwargs</span><b><span
style='color:navy'>(</span></b>self<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:#FF8000'>&quot;&quot;&quot;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;Returns the keyword arguments for instantiating the form.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
kwargs <b><span style='color:navy'>=</span></b> <b><span style='color:navy'>{</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>'initial'</span><b><span style='color:navy'>:</span></b>
self<b><span style='color:navy'>.</span></b>get_initial<b><span
style='color:navy'>(),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>'prefix'</span><b><span style='color:navy'>:</span></b>
self<b><span style='color:navy'>.</span></b>get_prefix<b><span
style='color:navy'>(),</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>}</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>if</span></b> self<b><span style='color:navy'>.</span></b>request<b><span
style='color:navy'>.</span></b>method <b><span style='color:blue'>in</span></b>
<b><span style='color:navy'>(</span></b><span style='color:gray'>'POST'</span><b><span
style='color:navy'>,</span></b> <span style='color:gray'>'PUT'</span><b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
kwargs<b><span style='color:navy'>.</span></b>update<b><span style='color:navy'>({</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>'data'</span><b><span style='color:navy'>:</span></b>
self<b><span style='color:navy'>.</span></b>request<b><span style='color:navy'>.</span></b>POST<b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>'files'</span><b><span style='color:navy'>:</span></b>
self<b><span style='color:navy'>.</span></b>request<b><span style='color:navy'>.</span></b>FILES<b><span
style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>})</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>return</span></b> kwargs</span></p>

<p class=MsoNormal><span lang=EN-US style='color:green'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#143;</span><span
lang=EN-US style='color:green'> </span><i><span lang=EN-US style='background:
yellow'>usermodel<span style='color:navy'>.</span>image <span style='color:
navy'>=</span> form<span style='color:navy'>.</span>cleaned_data<span
style='color:navy'>[</span><span style='color:gray'>'image'</span><span
style='color:navy'>]</span></span></i></p>

<p class=MsoNormal><span style='font-family:宋体'>该语句获取</span><span lang=EN-US>image</span><span
style='font-family:宋体'>对象。也可以通过下面文件处理的方式</span></p>

<p class=codewithbg><span lang=EN-US>filename<span style='color:navy'>=</span>request<span
style='color:navy'>.</span>FILES<span style='color:navy'>[</span><span
style='color:gray'>'image'</span><span style='color:navy'>]</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>from</span><span
lang=EN-US> PIL <span style='color:blue'>import</span> Image </span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>if</span><span
lang=EN-US> filename<span style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <a name="OLE_LINK122"></a><a
name="OLE_LINK121">img<span style='color:navy'>=</span>Image<span
style='color:navy'>.</span>open<span style='color:navy'>(</span>filename<span
style='color:navy'>)</span></a></span></p>

<p class=codewithbg><span lang=EN-US>img<span style='color:navy'>.</span>save<span
style='color:navy'>(</span>os<span style='color:navy'>.</span>path<span
style='color:navy'>.</span>join<span style='color:navy'>(</span>settings<span
style='color:navy'>.</span>MEDIA_ROOT<span style='color:navy'>,</span> <span
style='color:#00B050'>photoname</span><span style='color:navy'>))</span></span></p>

<p class=codewithbg><a name="OLE_LINK120"></a><a name="OLE_LINK119"><span
lang=EN-US>usermodel<span style='color:navy'>.</span>image <span
style='color:navy'>= </span><span style='color:#00B050'>photoname</span></span></a></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>效果图如下：</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=458 height=668
id="Picture 5" src="Zakkabag.files/image002.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>上传进度条</span></h4>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Tag: cache </span></p>

<p class=MsoNormal><span style='font-family:宋体'>具体参考：</span><span lang=EN-US><a
href="https://github.com/Tonetete/Simple-Django-progressbar-upload-file-form-with-ajax">https://github.com/Tonetete/Simple-Django-progressbar-upload-file-form-with-ajax</a></span></p>

<p class=MsoNormal><span style='font-family:宋体'>该文章有相对详细的讲解，但是内容不全</span><span
lang=EN-US><a
href="http://www.laurentluce.com/posts/upload-to-django-with-progress-bar-using-ajax-and-jquery/"
title="Permanent Link to Upload to Django with progress bar using Ajax and jQuery">Upload
to Django with progress bar using Ajax and jQuery</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>其中用到了</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://jquery.malsup.com/form/#download"><span style='font-size:9.0pt;
font-family:"Verdana","sans-serif";color:#F26522;background:white'>jQuery Form
plugin</span></a></span></p>

<p class=MsoNormal><span lang=EN-US>ajaxsubmit</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://malsup.github.io/jquery.form.js">http://malsup.github.io/jquery.form.js</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://t.wits.sg/jquery-progress-bar/"><span style='font-size:9.0pt;
font-family:"Verdana","sans-serif";color:#F26522;background:white'>jQuery
progress bar plugin</span></a> </span><span style='font-family:宋体'>这个当前实现没有，<span
style='background:yellow'>后面可以用这个来代替进度条状态更新的函数</span></span></p>

<p class=MsoNormal><span lang=EN-US>progressbar</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://code.jquery.com/ui/1.12.1/jquery-ui.js">https://code.jquery.com/ui/1.12.1/jquery-ui.js</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css</a></span></p>

<p class=MsoNormal><span style='font-family:宋体'>文件上传参考函数</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/topics/http/file-uploads/">https://docs.djangoproject.com/en/1.8/topics/http/file-uploads/</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>首先在</span><span lang=EN-US>personalcenter/forms.py</span><span
style='font-family:宋体'>里面新增加一个图片上传的</span><span lang=EN-US>form</span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US style='color:blue'>class</span><span lang=EN-US> UploadFileForm<span
style='color:navy'>(</span>forms<span style='color:navy'>.</span>Form<span
style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp; image <span style='color:navy'>=</span> forms<span
style='color:navy'>.</span>ImageField<span style='color:navy'>(</span>widget<span
style='color:navy'>=</span>forms<span style='color:navy'>.</span>FileInput<span
style='color:navy'>(</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp; attrs<span style='color:navy'>={</span><span
style='color:gray'>'required'</span><span style='color:navy'>:</span> <span
style='color:gray'>'required'</span><span style='color:navy'>}))</span>&nbsp; <span
style='color:green'># required=True is the default, but not show it validation
in template</span></span></p>

<p class=MsoNormal><span style='font-family:宋体'>设置</span><span lang=EN-US>required</span><span
style='font-family:宋体'>，这样如果不选图片的话，上传会报错</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>动态上传会用到两个</span><span
lang=EN-US>ajax post</span><span style='font-family:宋体'>地址，在</span><span
lang=EN-US>personalcenter/urls.py</span><span style='font-family:宋体'>增加两个</span><span
lang=EN-US>URL</span><span style='font-family:宋体'>，分别处理文件上传和状态更新功能</span></p>

<p class=codewithbg><span lang=EN-US>urlpatterns <b><span style='color:navy'>=</span></b>
<b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span style='color:navy'>(</span></b><span
style='color:gray'>r'^<span style='background:yellow'>uploadfile'</span></span><b><span
style='color:navy'>,</span></b> upload_file<b><span style='color:navy'>,</span></b>
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'upload_file'</span><b><span
style='color:navy'>), </span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span style='color:navy'>(</span></b><span
style='color:gray'>r'^<span style='background:yellow'>upload_status</span>$'</span><b><span
style='color:navy'>,</span></b> upload_status<b><span style='color:navy'>,</span></b>
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'upload_status'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>对应的</span><span lang=EN-US>template</span><span
style='font-family:宋体'>如下</span><span lang=EN-US> profile_detail.html</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>{% block content %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;div</span><span
lang=EN-US> <span style='color:red'>class</span>=<span style='color:#8000FF'>'col-sm-6
col-sm-offset-3'</span><span style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>&lt;h3&gt;</span>{{ object }}<span style='color:blue'>&lt;/h3&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>&lt;<span style='background:yellow'>form</span></span> <span
style='color:red'>id</span>=<span style='color:#8000FF'>&quot;form_profile&quot;</span>
<span style='color:red'>method</span>=<span style='color:#8000FF'>&quot;POST&quot;</span>
<span style='color:red'>enctype</span>=<span style='color:#8000FF'>&quot;multipart/form-data&quot;</span>
<span style='color:red'>action</span>=<span style='color:#8000FF'>&quot;&quot;</span><span
style='color:blue'>&gt;</span> {% csrf_token %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{{<span style='background:yellow'>form</span>|crispy}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;img</span>&nbsp; <span style='color:red'>id</span>=<span
style='color:#8000FF'>'img'</span> <span style='color:red'>class</span>= <span
style='color:#8000FF'>'img-responsive'</span> <span style='color:red'>src</span>=<span
style='color:#8000FF'>&quot;{{object.get_image_url}}&quot;</span><span
style='color:blue'>/&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;input</span> <span style='color:red'>type</span>=<span
style='color:#8000FF'>&quot;submit&quot;</span> <span style='color:red'>value</span>=<span
style='color:#8000FF'>'Update'</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>'btn'</span> <span style='color:blue'>/&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>&lt;/form&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>&lt;br&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>&lt;<span style='background:yellow'>form</span></span> <span
style='color:red'>id</span>=<span style='color:#8000FF'>&quot;<span
style='background:aqua'>form_upload</span>&quot;</span>&nbsp; <span
style='color:red'>enctype</span>=<span style='color:#8000FF'>&quot;multipart/form-data&quot;</span>
<span style='color:red'>action</span>=<span style='color:#8000FF'>&quot;<span
style='background:yellow'>/personalcenter/uploadfile</span> &quot;</span> <span
style='color:red'>method</span>=<span style='color:#8000FF'>&quot;POST&quot;</span><span
style='color:blue'>&gt;</span> {% csrf_token %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{{<span style='background:yellow'>upload_form</span>|crispy}}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span
style='color:blue'>&lt;div</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>&quot;<span style='background:aqua'>progress</span>&quot;</span><span
style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
style='color:blue'>&lt;div</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>&quot;progress-bar progress-bar-success
progress-bar-striped active&quot;</span> role=<span style='color:#8000FF'>&quot;<span
style='background:yellow'>progressbar</span>&quot;</span> aria-valuenow=<span
style='color:#8000FF'>&quot;0&quot;</span> aria-valuemin=<span
style='color:#8000FF'>&quot;0&quot;</span> aria-valuemax=<span
style='color:#8000FF'>&quot;100&quot;</span> <span style='color:red'>style</span>=<span
style='color:#8000FF'>&quot;width: 0%&quot;</span><span style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
style='background:yellow'>0%</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
style='color:blue'>&lt;/div&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span
style='color:blue'>&lt;/div&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;div</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>&quot;<span style='background:aqua'>processing-file</span>&quot;</span><span
style='color:blue'>&gt;&lt;/div&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>&lt;input</span> <span style='color:red'>id</span>=<span
style='color:#8000FF'>&quot;buttonSubmit&quot;</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>&quot;btn btn-primary&quot;</span> <span
style='color:red'>type</span>=<span style='color:#8000FF'>&quot;submit&quot;</span>
<span style='color:red'>value</span>=<span style='color:#8000FF'>&quot;Upload&quot;</span>
<span style='color:blue'>/&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>&lt;/form&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>{% endblock %}</span></p>

<p class=MsoNormal><span style='font-family:宋体'>该</span><span lang=EN-US>template</span><span
style='font-family:宋体'>里面包含两个</span><span lang=EN-US>form</span><span
style='font-family:宋体'>，第二个</span><span lang=EN-US>form</span><span
style='font-family:宋体'>专门用于上传图片</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>var</span></b><span
lang=EN-US> options <b>=</b> <b>{</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; beforeSubmit<b>:</b>&nbsp;
showRequest<b>,</b>&nbsp; <span style='color:green'>// pre-submit callback</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; success<b>:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
showResponse<b>,</b>&nbsp; <span style='color:green'>// post-submit callback</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; error<b>:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
showError<b>,</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// other available options:</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b>:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>&quot;/personalcenter/uploadfile&quot;</span><b>,</b>&nbsp;
<span style='color:green'>// override for form's 'action' attribute</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; type<b>:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>&quot;post&quot;</span><b>,</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:green'>// 'get' or 'post', override for form's 'method'
attribute</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; dataType<b>:</b>&nbsp; <span
style='color:gray'>&quot;json&quot;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:green'>// 'xml', 'script', or 'json' (expected server
response type)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>//clearForm: true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // clear all
form fields after successful submit</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>//resetForm: true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // reset the
form after successful submit</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// $.ajax options can be used here too, for example:</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>//timeout:&nbsp;&nbsp; 3000</span></span></p>

<p class=codewithbg><b><span lang=EN-US>};</span></b></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:green'>// bind to the form's
submit event</span></p>

<p class=codewithbg><span lang=EN-US>$(<span style='color:gray'>'<span
style='background:aqua'>#form_upload</span>'</span>).submit(<span
style='color:navy'>function</span>() {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// inside event callbacks 'this' is the DOM element so we first</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// wrap it in a jQuery object and then invoke ajaxSubmit</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// disable submit button for prevent requests</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; $(<span
style='color:gray'>&quot;#buttonSubmit&quot;</span>).prop(<span
style='color:gray'>&quot;disabled&quot;</span>, <span style='color:navy'>true</span>);</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; $(<span
style='color:gray'>&quot;.processing-file&quot;</span>).html(<span
style='color:gray'>&quot;&quot;</span>);</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; $(<span
style='color:navy'>this</span>).<span style='background:yellow'>ajaxSubmit</span>(options);<span
style='color:green'> //</span></span><span style='font-family:宋体;color:green'>处理</span><span
lang=EN-US style='color:green'>uploadfile</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; $(<span
style='color:gray'>&quot;.progress&quot;</span>).show();</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url = <span
style='color:gray'>&quot;<span style='background:yellow'>/personalcenter/upload_status</span>?key=&quot;</span>
+ $(<span style='color:gray'>&quot;input[name=csrfmiddlewaretoken]&quot;</span>).val();<span
style='color:green'>//</span></span><span style='font-family:宋体;color:green'>处理</span><span
lang=EN-US style='color:green'>upload_status</span><span style='font-family:
宋体;color:green'>，</span><span lang=EN-US style='color:green'>get</span><span
style='font-family:宋体;color:green'>方式</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; progressWorker(url);</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// !!! Important !!!</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
green'>// always return false to prevent standard browser submit and page
navigation</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
navy'>return</span> <span style='color:navy'>false</span>;</span></p>

<p class=codewithbg><span lang=EN-US>});</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>function</span></b><span
lang=EN-US> <span style='background:yellow'>progressWorker</span><b>(</b>url<b>){</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; percent <b>=</b> <span
style='color:red'>0</span><b>;</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; $<b>.</b>ajax<b>({</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url<b>:</b> url<b>,</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
async<b>:</b> <b><span style='color:navy'>true</span>,</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
dataType<b>:</b> <span style='color:gray'>&quot;json&quot;</span><b>,</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
contentType<b>:</b> <span style='color:gray'>&quot;application/json&quot;</span><b>,</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
success<b>:</b> <b><span style='color:navy'>function</span></b> <b>(</b>progress<b>)</b>
<b>{</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>if</span>(</b>progress<b>.</b>uploaded <b>&amp;&amp;</b>
progress<b>.</b>totalsize<b>){</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;console<b>.</b>log<b>(</b><span style='color:gray'>&quot;Percent:
&quot;</span><b>+</b>percent<b>+</b><span style='color:gray'>&quot;%&quot;</span><b>);</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;percent <b>=</b> <b>(</b>progress<b>.</b>uploaded<b>/</b>progress<b>.</b>totalsize<b>)</b>
<b>*</b> <span style='color:red'>100</span><b>;</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;percent <b>=</b> parseInt<b>(</b>percent<b>,</b> <span
style='color:red'>10</span><b>);</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b><span style='color:gray'>'.progress-bar'</span><b>).</b>css<b>(</b><span
style='color:gray'>'width'</span><b>,</b> percent<b>+</b><span
style='color:gray'>'%'</span><b>).</b>attr<b>(</b><span style='color:gray'>'aria-valuenow'</span><b>,</b>
percent<b>);</b><span style='color:green'> //</span></span><span
style='font-family:宋体;color:green'>更新进度条</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b><span style='color:gray'>'.progress-bar'</span><b>).</b>html<b>(</b>percent<b>+</b><span
style='color:gray'>&quot;%&quot;</span><b>); </b><span style='color:green'>//</span></span><span
style='font-family:宋体;color:green'>显示进度内容</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:green'>/* Call sleep function before make a new request in
order to prevent much</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request to server. Use it wisely... */</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:green'>//sleep(1000);</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<b>}</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>},</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
complete<b>:</b> <b><span style='color:navy'>function</span>(){</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>if</span>(</b>percent<b>&lt;</b><span
style='color:red'>100</span><b>){</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>progressWorker</span><b>(</b>url<b>);</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>}</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>else</span>{</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b><span style='color:gray'>&quot;.processing-file&quot;</span><b>).</b>show<b>();</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b><span style='color:gray'>&quot;.processing-file&quot;</span><b>).</b>append<b>(</b><span
style='color:gray'>'&lt;span class=&quot;glyphicon glyphicon-refresh
glyphicon-refresh-animate&quot;&gt;&lt;/span&gt; Processing file, please
wait...'</span><b>);</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>}</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>},</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
error<b>:</b> <b><span style='color:navy'>function</span></b> <b>(</b>jqXHR<b>,</b>
textStatus<b>,</b> errorThrown<b>)</b> <b>{</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:navy'>if</span></b> <b>(</b>jqXHR<b>.</b>status <b>==</b>
<span style='color:red'>500</span><b>)</b> <b>{</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
alert<b>(</b><span style='color:gray'>'Internal error: '</span> <b>+</b> jqXHR<b>.</b>responseText<b>);</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>}</b> <b><span style='color:navy'>else</span></b> <b>{</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
alert<b>(</b><span style='color:gray'>'Unexpected error.'</span><b>);</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>}</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>}</b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b>});</b></span></p>

<p class=codewithbg><b><span lang=EN-US>}</span></b></p>

<p class=codewithbg><b><span lang=EN-US>&nbsp;</span></b></p>

<p class=codewithbg><span lang=EN-US>// post-submit callback</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>function</span></b><span
lang=EN-US style='color:black'> showResponse<b>(</b>responseText<b>,</b>
statusText<b>,</b> xhr<b>,</b> $form<b>)</b>&nbsp; <b>{</b></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// for normal html responses, the first argument to the success
callback</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// is the XMLHttpRequest object's responseText property</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// if the ajaxSubmit method was passed an Options Object with the
dataType</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// property set to 'xml' then the first argument to the success
callback</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// is the XMLHttpRequest object's responseXML property</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// if the ajaxSubmit method was passed an Options Object with the
dataType</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// property set to 'json' then the first argument to the success
callback</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>// is the json data object returned by the server</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:navy'>if</span><span lang=EN-US style='color:black'>(</span></b><span
lang=EN-US style='color:black'>statusText <b>===</b> </span><span lang=EN-US
style='color:gray'>&quot;success&quot;</span><b><span lang=EN-US
style='color:black'>){</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b></span><span lang=EN-US style='color:gray'>&quot;.processing-file&quot;</span><b><span
lang=EN-US style='color:black'>).</span></b><span lang=EN-US style='color:black'>html<b>(</b></span><span
lang=EN-US style='color:gray'>&quot;&quot;</span><b><span lang=EN-US
style='color:black'>);</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b></span><span lang=EN-US style='color:gray'>&quot;.processing-file&quot;</span><b><span
lang=EN-US style='color:black'>).</span></b><span lang=EN-US style='color:black'>append<b>(</b>responseText<b>.</b>message<b>);</b></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>// enable submit button again for make requests</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$<b>(</b></span><span lang=EN-US style='color:gray'>&quot;#buttonSubmit&quot;</span><b><span
lang=EN-US style='color:black'>).</span></b><span lang=EN-US style='color:black'>prop<b>(</b></span><span
lang=EN-US style='color:gray'>&quot;disabled&quot;</span><b><span lang=EN-US
style='color:black'>,</span></b><span lang=EN-US style='color:black'> </span><b><span
lang=EN-US style='color:navy'>false</span><span lang=EN-US style='color:black'>);</span></b><span
lang=EN-US style='color:green'> //</span><span style='font-family:宋体;
color:green'>重新</span><span lang=EN-US style='color:green'>enable</span><span
style='font-family:宋体;color:green'>提交按钮</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; <b>}</b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>}</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>上面用到了两个</span><span lang=EN-US>ajax</span><span
style='font-family:宋体'>事件，处理上用了不同的实现方法</span></p>

<p class=MsoNormal><span lang=EN-US>/personalcenter/upload_status</span><span
style='font-family:宋体'>使用了常用的</span><span lang=EN-US>$.ajax</span></p>

<p class=MsoNormal><span lang=EN-US>/personalcenter/uploadfile</span><span
style='font-family:宋体'>使用</span><span lang=EN-US>ajaxSubmit</span><span
style='font-family:宋体'>，</span><span lang=EN-US>form</span><span
style='font-family:宋体'>里指定的</span><span lang=EN-US>action</span><span
style='font-family:宋体'>会被</span><span lang=EN-US>options</span><span
style='font-family:宋体'>覆盖</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>jquery</span><span style='font-family:宋体'>中各个事件执行顺序如下：</span></p>

<p class=MsoNormal><span lang=EN-US>1.ajaxStart(</span><span style='font-family:
宋体'>全局事件</span><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>2.beforeSend</span></p>

<p class=MsoNormal><span lang=EN-US>3.ajaxSend(</span><span style='font-family:
宋体'>全局事件</span><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>4.success</span><span style='font-family:
宋体'>当请求成功时调用函数，即</span><span lang=EN-US>status==200;</span></p>

<p class=MsoNormal><span lang=EN-US>5.ajaxSuccess(</span><span
style='font-family:宋体'>全局事件</span><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>6.error</span></p>

<p class=MsoNormal><span lang=EN-US>7.ajaxError (</span><span style='font-family:
宋体'>全局事件</span><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>8.complete</span><span style='font-family:
宋体'>当请求完成时调用函数，即</span><span lang=EN-US>status==404</span><span
style='font-family:宋体'>、</span><span lang=EN-US>403</span><span
style='font-family:宋体'>、</span><span lang=EN-US>302...</span><span
style='font-family:宋体'>只要不出错就行</span></p>

<p class=MsoNormal><span lang=EN-US>9.ajaxComplete(</span><span
style='font-family:宋体'>全局事件</span><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>10.ajaxStop(</span><span style='font-family:
宋体'>全局事件</span><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US>personalcenter/views.py</span><span
style='font-family:宋体'>增加对两个</span><span lang=EN-US>ajax </span><span
style='font-family:宋体'>的处理</span></p>

<p class=MsoNormal><span style='font-family:宋体'>文件上传成功后会调用</span><span
lang=EN-US>upload_file</span><span style='font-family:宋体'>，其中会把文件进行保存，文件名放到</span><span
lang=EN-US>cache</span><span style='font-family:宋体'>里保存。这样用户真正保存时再把图片关联到</span><span
lang=EN-US>model</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US style='color:blue'>from</span></b><span lang=EN-US> django<b><span
style='color:navy'>.</span></b>core<b><span style='color:navy'>.</span></b>cache
<b><span style='color:blue'>import</span></b> cache</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US style='color:blue'>from</span></b><span lang=EN-US> django<b><span
style='color:navy'>.</span></b>core<b><span style='color:navy'>.</span></b>cache<b><span
style='color:navy'>.</span></b>backends<b><span style='color:navy'>.</span></b>memcached
<b><span style='color:blue'>import</span></b> MemcachedCache</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US> <span
style='color:fuchsia'>upload_file</span><b><span style='color:navy'>(</span></b>request<b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span style='color:blue'>if</span></b> request<b><span
style='color:navy'>.</span></b>method <b><span style='color:navy'>==</span></b>
<span style='color:gray'>'POST'</span><b><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; upload_form <b><span
style='color:navy'>=</span></b> <span style='background:yellow'>UploadFileForm</span><b><span
style='color:navy'>(</span></b>request<b><span style='color:navy'>.</span></b>POST<b><span
style='color:navy'>,</span></b> request<b><span style='color:navy'>.</span></b>FILES<b><span
style='color:navy'>)</span></b><span style='color:green'> #</span></span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>if</span></b> upload_form<b><span style='color:navy'>.</span></b>is_valid<b><span
style='color:navy'>():</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
filename<b><span style='color:navy'>=</span></b>request<b><span
style='color:navy'>.</span></b>FILES<b><span style='color:navy'>[</span></b><span
style='color:gray'>'image'</span><b><span style='color:navy'>]</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>from</span></b> PIL <b><span style='color:blue'>import</span></b>
Image</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>if</span></b> filename<b><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
img <b><span style='color:navy'>=</span></b> Image<b><span style='color:navy'>.</span></b>open<b><span
style='color:navy'>(</span></b>filename<b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>import</span></b> os</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
photopath <b><span style='color:navy'>=</span></b> os<b><span style='color:
navy'>.</span></b>path<b><span style='color:navy'>.</span></b>join<b><span
style='color:navy'>(</span></b>settings<b><span style='color:navy'>.</span></b>MEDIA_ROOT<b><span
style='color:navy'>,</span></b> <span style='color:gray'>'upload'</span><b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>if</span></b> <b><span style='color:blue'>not</span></b>
os<b><span style='color:navy'>.</span></b>path<b><span style='color:navy'>.</span></b>exists<b><span
style='color:navy'>(</span></b>photopath<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
os<b><span style='color:navy'>.</span></b>makedirs<b><span style='color:navy'>(</span></b>photopath<b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
img<b><span style='color:navy'>.</span></b>save<b><span style='color:navy'>(</span></b>os<b><span
style='color:navy'>.</span></b>path<b><span style='color:navy'>.</span></b>join<b><span
style='color:navy'>(</span></b>photopath<b><span style='color:navy'>,</span></b>
filename<b><span style='color:navy'>.</span></b>name<b><span style='color:navy'>))</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cache<b><span style='color:navy'>.</span></b>set<b><span style='color:navy'>(</span></b><span
style='color:gray'>'<span style='background:yellow'>cache_key_upload</span>'</span><b><span
style='color:navy'>,</span></b>os<b><span style='color:navy'>.</span></b>path<b><span
style='color:navy'>.</span></b>join<b><span style='color:navy'>(</span></b><span
style='color:gray'>'upload'</span><b><span style='color:navy'>,</span></b>
filename<b><span style='color:navy'>.</span></b>name<b><span style='color:navy'>)</span></b>
<b><span style='color:navy'>,</span></b><span style='color:red'>60</span><b><span
style='color:navy'>*</span></b><span style='color:red'>15</span><b><span
style='color:navy'>)</span></b><span style='color:green'> #</span></span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#141;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> HttpResponse<b><span style='color:navy'>(</span></b>json<b><span
style='color:navy'>.</span></b>dumps<b><span style='color:navy'>({</span></b><span
style='color:gray'>'message'</span><b><span style='color:navy'>:</span></b> <span
style='color:gray'>'Upload complete!'</span><b><span style='color:navy'>}))</span></b><span
style='color:green'>#</span></span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#142;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>else</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> HttpResponse<b><span style='color:navy'>(</span></b>json<b><span
style='color:navy'>.</span></b>dumps<b><span style='color:navy'>({</span></b><span
style='color:gray'>'message'</span><b><span style='color:navy'>:</span></b> <span
style='color:gray'>'invalid form!'</span><b><span style='color:navy'>}))</span></b><span
style='color:green'>#</span></span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#143;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span style='color:blue'>else</span><span
style='color:navy'>:</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form <b><span
style='color:navy'>=</span></b> UploadFileForm<b><span style='color:navy'>()</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style='color:green'>#return
render_to_response('index.html', {'form': form},
context_instance=RequestContext(request))</span></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>return</span></b> HttpResponse<b><span style='color:navy'>(</span></b>json<b><span
style='color:navy'>.</span></b>dumps<b><span style='color:navy'>({</span></b><span
style='color:gray'>'message'</span><b><span style='color:navy'>:</span></b> <span
style='color:gray'>'invalid form!'</span><b><span style='color:navy'>}))</span></b></span></p>

<p class=MsoNormal><span style='font-family:宋体'>从</span><span
class=codewithbgChar><span lang=EN-US style='font-size:10.0pt'>$('#form_upload').submit(function()</span></span><span
style='font-family:宋体'>，可以看到，</span><span lang=EN-US>form_upload submit</span><span
style='font-family:宋体'>提交时会首先处理</span><span lang=EN-US>upload_status</span><span
style='font-family:宋体'>，结束之后才会执行执行</span><span lang=EN-US>upload_file</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'>upload_status</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:red'>[03/Jun/2017 15:00:29]
&quot;GET /personalcenter/upload_status?key=6pxOb4jkfnKLUEU28cmIYL6NDVdkYNhm
HTTP/1.1&quot; 200 34</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'>upload_status</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:red'>[03/Jun/2017 15:00:29]
&quot;GET /personalcenter/upload_status?key=6pxOb4jkfnKLUEU28cmIYL6NDVdkYNhm
HTTP/1.1&quot; 200 37</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'>upload_file</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:red'>[03/Jun/2017 15:00:31]
&quot;POST /personalcenter/uploadfile HTTP/1.1&quot; 200 66</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span
lang=EN-US style='color:green'> </span><span lang=EN-US>UploadFileForm</span><span
style='font-family:宋体'>仅包含图片，且传递时带上</span><span lang=EN-US>request.FILES</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#141;</span><span
lang=EN-US style='color:green'> </span><span style='font-family:宋体'>将文件名存到</span><span
lang=EN-US>cache</span><span style='font-family:宋体'>里，此时文件已上传完成</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#143;</span><span
style='font-family:宋体'>返回成功或失败结果，格式是</span><span lang=EN-US>json</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US>upload_status<b><span style='color:navy'>(</span></b><span
style='color:black'>request</span><b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US style='color:black'> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>method
</span><b><span lang=EN-US style='color:navy'>==</span></b><span lang=EN-US
style='color:black'> </span><span lang=EN-US style='color:gray'>'GET'</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US style='color:black'>
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>GET</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'key'</span><b><span lang=EN-US style='color:
navy'>]: </span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US
style='color:black'> cache</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>get</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>request</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>GET</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US style='color:gray'>'key'</span><b><span
lang=EN-US style='color:navy'>]):</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>value </span></span><b><span lang=EN-US
style='color:navy;background:lime'>=</span></b><span lang=EN-US
style='color:black;background:lime'> cache</span><b><span lang=EN-US
style='color:navy;background:lime'>.</span></b><span lang=EN-US
style='color:black;background:lime'>get</span><b><span lang=EN-US
style='color:navy;background:lime'>(</span></b><span lang=EN-US
style='color:black;background:lime'>request</span><b><span lang=EN-US
style='color:navy;background:lime'>.</span></b><span lang=EN-US
style='color:black;background:lime'>GET</span><b><span lang=EN-US
style='color:navy;background:lime'>[</span></b><span lang=EN-US
style='color:gray;background:lime'>'key'</span><b><span lang=EN-US
style='color:navy;background:lime'>])</span></b><span lang=EN-US
style='color:green'> #</span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#140;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US style='color:black'> HttpResponse</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:black'>json</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>dumps</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>value</span><b><span
lang=EN-US style='color:navy'>),</span></b><span lang=EN-US style='color:black'>
content_type</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:gray'>&quot;application/json&quot;</span><b><span
lang=EN-US style='color:navy'>)</span></b><span lang=EN-US style='color:green'>#</span><span
lang=EN-US style='color:black'> </span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>else</span><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US style='color:black'> HttpResponse</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:black'>json</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>dumps</span><b><span
lang=EN-US style='color:navy'>({</span></b><span lang=EN-US style='color:gray'>'error'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US style='color:gray'>&quot;No
csrf value in cache&quot;</span><b><span lang=EN-US style='color:navy'>}),</span></b><span
lang=EN-US style='color:black'> content_type</span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US style='color:gray'>&quot;application/json&quot;</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>else</span><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US style='color:black'> HttpResponse</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:black'>json</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>dumps</span><b><span
lang=EN-US style='color:navy'>({</span></b><span lang=EN-US style='color:gray'>'error'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US style='color:gray'>'No
parameter key in GET request'</span><b><span lang=EN-US style='color:navy'>}),</span></b><span
lang=EN-US style='color:black'> content_type</span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US style='color:gray'>&quot;application/json&quot;</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>else</span><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US
style='color:black'> HttpResponse</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>json</span><b><span lang=EN-US style='color:
navy'>.</span></b><span lang=EN-US style='color:black'>dumps</span><b><span
lang=EN-US style='color:navy'>({</span></b><span lang=EN-US style='color:gray'>'error'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US style='color:gray'>'No
GET request'</span><b><span lang=EN-US style='color:navy'>}),</span></b><span
lang=EN-US style='color:black'> content_type</span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US style='color:gray'>&quot;application/json&quot;</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span
style='font-family:宋体'>这儿对返回值得获取包含两步</span></p>

<p class=MsoNormal style='margin-left:11.0pt;text-indent:-11.0pt'><span
lang=EN-US>(1)<span style='color:black'> request</span><b><span
style='color:navy'>.</span></b><span style='color:black'>GET</span><b><span
style='color:navy'>[</span></b><span style='color:gray'>'key'</span><b><span
style='color:navy'>]</span></b> , </span><span style='font-family:宋体'>根据</span><span
lang=EN-US>url = <span style='color:gray'>&quot;<span style='background:yellow'>/personalcenter/upload_status</span>?key=&quot;</span>
+ $(<span style='color:gray'>&quot;input[name=csrfmiddlewaretoken]&quot;</span>)</span><span
style='font-family:宋体'>在</span><span lang=EN-US>GET</span><span
style='font-family:宋体'>里面包含字典</span><span lang=EN-US>{‘key’:<span
style='color:gray'> csrfmiddlewaretoken</span> }</span></p>

<p class=MsoNormal style='margin-left:11.0pt;text-indent:-11.0pt'><span
lang=EN-US>(2)<span style='color:black'> cache</span><b><span style='color:
navy'>.</span></b><span style='color:black'>get[</span>cache_key<span
style='color:black'>], </span></span><span style='font-family:宋体;color:black'>这个</span><span
lang=EN-US style='color:black'>cache</span><span style='font-family:宋体;
color:black'>的</span><span lang=EN-US style='color:black'>key</span><span
style='font-family:宋体;color:black'>是</span><span lang=EN-US style='color:gray'>csrfmiddlewaretoken</span><span
style='font-family:宋体;color:black'>值。</span><span style='color:black'> </span><span
style='font-family:宋体;color:black'>根据</span> <span lang=EN-US style='color:
green'>UploadProgressCachedHandler.handle_raw_input</span><span
style='font-family:宋体'>，它会里面会从</span><span lang=EN-US>self.request.META['CSRF_COOKIE']</span><span
style='font-family:宋体'>获取到当前的</span><span lang=EN-US style='color:gray'>csrfmiddlewaretoken</span><span
style='font-family:宋体'>，并将</span><span lang=EN-US>cache_key</span><span
style='font-family:宋体'>键值设置为这个</span><span lang=EN-US>token</span><span
style='font-family:宋体'>，内容为</span><span lang=EN-US>totalsize</span><span
style='font-family:宋体'>和</span><span lang=EN-US>uploaded</span><span
style='font-family:宋体'>，该函数能根据这个</span><span lang=EN-US>token</span><span
style='font-family:宋体'>从</span><span lang=EN-US style='color:green'>UploadProgressCachedHandler</span><span
style='font-family:宋体'>的</span><span lang=EN-US>cache</span><span
style='font-family:宋体'>里面拿到返回值</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>具体进度的数据更新在</span><span
lang=EN-US>uploadfilehander</span><span style='font-family:宋体'>里面完成</span></p>

<p class=MsoNormal><span lang=EN-US>uploadfilehandler</span></p>

<p class=MsoNormal><span style='font-family:宋体'>添加配置</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> django<b><span style='color:navy'>.</span></b>conf <b><span
style='color:blue'>import</span></b> global_settings</span></p>

<p class=codewithbg><span lang=EN-US>FILE_UPLOAD_HANDLERS <b><span
style='color:navy'>=</span></b> <b><span style='color:navy'>(</span></b><span
style='color:gray'>'personalcenter.uploadfilehandler.UploadProgressCachedHandler'</span><b><span
style='color:navy'>,</span></b> <b><span style='color:navy'>)</span></b> \</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US> global_settings<b><span style='color:navy'>.</span></b>FILE_UPLOAD_HANDLERS</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><a name="OLE_LINK126"></a><a name="OLE_LINK125"><span
lang=EN-US>uploadfilehandler</span></a><span lang=EN-US>.py</span><span
style='font-family:宋体'>中定义</span><span lang=EN-US>UploadProgressCachedHandler</span><span
style='font-family:宋体'>类，具体参考源码</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US style='color:black'> <b>UploadProgressCachedHandler</b></span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>FileUploadHandler</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
Tracks progress for file uploads.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
The http post request must contain a header or query parameter, we gonna use</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
CSRF token generated by GET request for form in the view but you can modified</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
according your considerations or parameters.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; For
more info, redirect to documentation: <u>https://docs.djangoproject.com/en/1.7/ref/files/uploads/#optional-methods</u></span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:fuchsia'>__init__</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
request</span><b><span lang=EN-US style='color:navy'>=</span><span lang=EN-US
style='color:blue'>None</span><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
super</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>UploadProgressCachedHandler</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
self</span><b><span lang=EN-US style='color:navy'>).</span></b><span
lang=EN-US style='color:black'>__init__</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:black'>request</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US
style='color:black'>progress_id </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US
style='color:black'>cache_key </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:fuchsia'>handle_raw_input</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
input_data</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US style='color:black'> META</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
content_length</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US style='color:black'> boundary</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US style='color:black'> encoding</span><b><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US style='color:blue'>None</span><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US
style='color:black'>content_length </span><b><span lang=EN-US style='color:
navy'>=</span></b><span lang=EN-US style='color:black'> content_length</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US
style='color:black'> </span><span lang=EN-US style='color:gray'>'CSRF_COOKIE'</span><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:blue'>in</span></b><span
lang=EN-US style='color:black'> self</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>GET</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US
style='color:black'>cache_key </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> self</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>GET</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US style='color:gray'>'CSRF_COOKIE'</span><b><span
lang=EN-US style='color:navy'>]</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>elif</span></b><span lang=EN-US
style='color:black'> </span><span lang=EN-US style='color:gray;background:yellow'>'CSRF_COOKIE'</span><span
lang=EN-US style='color:black;background:yellow'> </span><b><span lang=EN-US
style='color:blue;background:yellow'>in</span></b><span lang=EN-US
style='color:black;background:yellow'> self</span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>request</span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>META</span><b><span lang=EN-US
style='color:navy;background:yellow'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>self</span></span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>cache_key </span><b><span lang=EN-US
style='color:navy;background:yellow'>=</span></b><span lang=EN-US
style='color:black;background:yellow'> self</span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>request</span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>META</span><b><span lang=EN-US
style='color:navy;background:yellow'>[</span></b><span lang=EN-US
style='color:gray;background:yellow'>'CSRF_COOKIE'</span><b><span lang=EN-US
style='color:navy;background:yellow'>]</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US
style='color:black'> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>cache_key</span><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>cache</span></span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>set</span><b><span lang=EN-US
style='color:navy;background:yellow'>(</span></b><span lang=EN-US
style='color:black;background:yellow'>self</span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>cache_key</span><b><span lang=EN-US
style='color:navy;background:yellow'>,</span></b><span lang=EN-US
style='color:black;background:yellow'> </span><b><span lang=EN-US
style='color:navy;background:yellow'>{</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray;background:yellow'>'totalsize'</span><b><span
lang=EN-US style='color:navy;background:yellow'>:</span></b><span lang=EN-US
style='color:black;background:yellow'> self</span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='color:black;background:yellow'>content_length</span><b><span lang=EN-US
style='color:navy;background:yellow'>,</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray;background:yellow'>'uploaded'</span><b><span
lang=EN-US style='color:navy;background:yellow'>:</span></b><span lang=EN-US
style='color:black;background:yellow'> </span><span lang=EN-US
style='color:red;background:yellow'>0</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy;background:yellow'>})</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:fuchsia'>new_file</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
field_name</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US style='color:black'> file_name</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
content_type</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US style='color:black'> content_length</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US style='color:black'> charset</span><b><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US style='color:blue'>None</span><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
content_type_extra</span><b><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US style='color:blue'>None</span><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>pass</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:fuchsia'>receive_data_chunk</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
raw_data</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US style='color:black'> start</span><b><span lang=EN-US
style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US
style='color:black'> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>cache_key</span><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> cache</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>cache_key</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data</span><b><span lang=EN-US style='color:navy'>[</span></b><span lang=EN-US
style='color:gray'>'uploaded'</span><b><span lang=EN-US style='color:navy'>]</span></b><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:navy'>+=</span></b><span
lang=EN-US style='color:black'> self</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>chunk_size </span><span
lang=EN-US style='color:green'># data size increase</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cache</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>set</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>self</span><b><span lang=EN-US style='color:
navy'>.</span></b><span lang=EN-US style='color:black'>cache_key</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
data</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US style='color:black'> raw_data</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:fuchsia'>file_complete</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
file_size</span><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Called when a file has finished uploading.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
The handler should return an UploadedFile object that will be stored in
request.FILES. </span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Handlers may also return None to indicate that the UploadedFile object should
come from subsequent upload handlers.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US
style='color:black'> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>cache_key</span><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> cache</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>cache_key</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data</span><b><span lang=EN-US style='color:navy'>[</span></b><span lang=EN-US
style='color:gray'>'uploaded'</span><b><span lang=EN-US style='color:navy'>]</span></b><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> self</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>content_length</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cache</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>set</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>self</span><b><span lang=EN-US style='color:
navy'>.</span></b><span lang=EN-US style='color:black'>cache_key</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
data</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
time</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US
style='color:black'>sleep</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:red'>2</span><b><span lang=EN-US style='color:navy'>)</span></b><span
lang=EN-US style='color:black'> </span><span lang=EN-US style='color:green'>#
sleep for give time to receive final response in request progress bar</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>def</span></b><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:fuchsia'>upload_complete</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Callback signaling that the entire upload (all files) has completed.</span></p>

<p class=codewithbg><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US
style='color:black'> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>cache_key</span><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cache</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>delete</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:black'>self</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>cache_key</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>图片上传完成之后，需要将它附着到</span><span
lang=EN-US>User</span><span style='font-family:宋体'>对象。这儿通过</span><span
lang=EN-US>upload_file</span><span style='font-family:宋体'>里设置的</span><span
lang=EN-US>cache:<span style='color:gray'> cache_key_upload</span></span></p>

<p class=MsoNormal><span lang=EN-US>DetailView</span><span style='font-family:
宋体'>里面将</span><span lang=EN-US>upload_form</span><span style='font-family:宋体'>传给</span><span
lang=EN-US>template</span><span style='font-family:宋体'>，保存时从</span><span
lang=EN-US>cache</span><span style='font-family:宋体'>中读取当前的</span><span
lang=EN-US>image</span><span style='font-family:宋体'>信息</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>class</span><span
lang=EN-US> ProfileDetailView<span style='color:navy'>(</span>FormMixin<span
style='color:navy'>,</span> DetailView<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>def</span> <span style='color:fuchsia'>get_context_data</span><span
style='color:navy'>(</span>self<span style='color:navy'>,</span> <span
style='color:navy'>*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context <span style='color:navy'>=</span> super<span style='color:navy'>(</span>ProfileDetailView<span
style='color:navy'>,</span> self<span style='color:navy'>).</span>get_context_data<span
style='color:navy'>(*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context<span style='color:navy'>[</span><span style='color:gray'>&quot;form&quot;</span><span
style='color:navy'>]</span> <span style='color:navy'>=</span> self<span
style='color:navy'>.</span>form_class<span style='color:navy'>(</span>instance <span
style='color:navy'>=</span> self<span style='color:navy'>.</span>get_object<span
style='color:navy'>())</span> </span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context<span
style='color:navy'>[</span><span style='color:gray'>&quot;upload_form&quot;</span><span
style='color:navy'>]</span> <span style='color:navy'>=</span> UploadFileForm<span
style='color:navy'>()</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> context</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>def</span> <span style='color:fuchsia'>post</span><span
style='color:navy'>(</span>self<span style='color:navy'>,</span> request<span
style='color:navy'>,</span> <span style='color:navy'>*</span>args<span
style='color:navy'>,</span> <span style='color:navy'>**</span>kwargs<span
style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
form <span style='color:navy'>=</span> self<span style='color:navy'>.</span>get_form<span
style='color:navy'>()</span> </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>if</span> form<span style='color:navy'>.</span>is_valid<span
style='color:navy'>():</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel <span style='color:navy'>=</span> UserModel<span style='color:navy'>.</span>objects<span
style='color:navy'>.</span>get<span style='color:navy'>(</span>id<span
style='color:navy'>=</span>self<span style='color:navy'>.</span>kwargs<span
style='color:navy'>.</span>get<span style='color:navy'>(</span><span
style='color:gray'>&quot;id&quot;</span><span style='color:navy'>))</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>first_name <span style='color:navy'>=</span>
form<span style='color:navy'>.</span>cleaned_data<span style='color:navy'>[</span><span
style='color:gray'>'first_name'</span><span style='color:navy'>]</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>last_name <span style='color:navy'>=</span>
form<span style='color:navy'>.</span>cleaned_data<span style='color:navy'>[</span><span
style='color:gray'>'last_name'</span><span style='color:navy'>]</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>-</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>if</span> <span style='color:gray'>'image'</span> <span
style='color:blue'>in</span> form<span style='color:navy'>.</span>cleaned_data<span
style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>-</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>image <span style='color:navy'>=</span>
form<span style='color:navy'>.</span>cleaned_data<span style='color:navy'>[</span><span
style='color:gray'>'image'</span><span style='color:navy'>]</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>if</span> <span style='color:blue'>not</span> cache<span
style='color:navy'>.</span>get<span style='color:navy'>(</span><span
style='color:gray'>'cache_key_upload'</span><span style='color:navy'>,</span><span
style='color:blue'>None</span><span style='color:navy'>)</span> <span
style='color:blue'>is</span> <span style='color:blue'>None</span><span
style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>usermodel<span style='color:navy'>.</span>image <span
style='color:navy'>=</span> cache<span style='color:navy'>.</span>get<span
style='color:navy'>(</span><span style='color:gray'>'cache_key_upload'</span><span
style='color:navy'>,</span><span style='color:blue'>None</span><span
style='color:navy'>)</span></span><span style='color:green'> #</span></span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>if</span> cache<span style='color:navy'>.</span>has_key<span
style='color:navy'>(</span><span style='color:gray'>'cache_key_upload'</span><span
style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cache<span style='color:navy'>.</span>delete<span style='color:navy'>(</span><span
style='color:gray'>'cache_key_upload'</span><span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel<span style='color:navy'>.</span>save<span style='color:navy'>()</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> self<span style='color:navy'>.</span>form_valid<span
style='color:navy'>(</span>form<span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>else</span><span style='color:navy'>:</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>+</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self<span style='color:navy'>.</span>object <span style='color:navy'>=</span>
self<span style='color:navy'>.</span>get_object<span style='color:navy'>(*</span>args<span
style='color:navy'>,</span> <span style='color:navy'>**</span>kwargs<span
style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> self<span style='color:navy'>.</span>form_invalid<span
style='color:navy'>(</span>form<span style='color:navy'>)</span>&nbsp;&nbsp;&nbsp;&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span
lang=EN-US style='color:green'> </span><span style='font-family:宋体'>根据</span><span
lang=EN-US>key</span><span style='font-family:宋体'>找到</span><span lang=EN-US>image</span><span
style='font-family:宋体'>对象，并将它附着到</span><span lang=EN-US>user</span><span
style='font-family:宋体'>对象</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>添加新的</span><span lang=EN-US>js</span><span
style='font-family:宋体'>和</span><span lang=EN-US>css</span><span
style='font-family:宋体'>来支持</span><span lang=EN-US>ajaxsubmit</span><span
style='font-family:宋体'>和</span><span lang=EN-US>progressbar</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>+&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;script</span><span lang=EN-US
style='color:black'> </span><span lang=EN-US style='color:red'>src</span><span
lang=EN-US style='color:black'>=</span><span lang=EN-US>&quot;{% static
'js/jquery-ui.js' %}&quot;<span style='color:blue'>&gt;&lt;/script&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>+&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;script</span><span lang=EN-US
style='color:black'> </span><span lang=EN-US style='color:red'>src</span><span
lang=EN-US style='color:black'>=</span><span lang=EN-US>&quot;{% static
'js/jquery.form.js' %}&quot;<span style='color:blue'>&gt;&lt;/script&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>+&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;link</span><span lang=EN-US style='color:
black'> </span><span lang=EN-US style='color:red'>href</span><span lang=EN-US
style='color:black'>=</span><span lang=EN-US>&quot;{% static
'css/jquery-ui.css' %}&quot;<span style='color:black'> </span><span
style='color:red'>rel</span><span style='color:black'>=</span>&quot;stylesheet&quot;<span
style='color:blue'>&gt;</span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=458 height=668
id="Picture 6" src="Zakkabag.files/image003.png"></span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>我的积分</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以显示用户当前积分，如果需要冻结积分，也可显示冻结积分和可使用积分。还可以显示积分明细，纪录积分赚取花费情况</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>首先在</span><span lang=EN-US>personalcenterhome.html</span><span
style='font-family:宋体'>里面添加</span><span lang=EN-US>tab</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;ul</span><span lang=EN-US style='color:black'>
</span><span lang=EN-US style='color:red'>class</span><span lang=EN-US
style='color:black'>=</span><span lang=EN-US>&quot;nav nav-pills &quot;<span
style='color:blue'>&gt;</span><span style='color:black'>&nbsp; </span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
</span><span lang=EN-US style='color:blue'>&lt;li</span><span lang=EN-US
style='color:black'> role=</span><span lang=EN-US>&quot;presentation&quot;<span
style='color:black'> </span><span style='color:red'>class</span><span
style='color:black'>=</span>&quot;active&quot;<span style='color:blue'>&gt;&lt;a</span><span
style='color:black'> </span><span style='color:red'>href</span><span
style='color:black'>=</span>'{% url &quot;personalcenter&quot; id=myuser.id %}'<span
style='color:blue'>&gt;</span><span style='color:black'>Profile</span><span
style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
</span><span lang=EN-US style='color:blue'>&lt;li</span><span lang=EN-US
style='color:black'> role=</span><span lang=EN-US>&quot;presentation&quot;<span
style='color:blue'>&gt;&lt;a</span><span style='color:black'> </span><span
style='color:red'>href</span><span style='color:black'>=</span>&quot;#&quot;<span
style='color:blue'>&gt;</span><span style='color:black'>Messages</span><span
style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
</span><span lang=EN-US style='color:blue'>&lt;li</span><span lang=EN-US
style='color:black'> role=</span><span lang=EN-US>&quot;presentation&quot;<span
style='color:blue'>&gt;&lt;a</span><span style='color:black'> </span><span
style='color:red'>href</span><span style='color:black'>=</span>'{% url
&quot;myuser_profile_extend&quot; id=myuser.id %}'<span style='color:blue'>&gt;</span><span
style='color:black'>Score</span><span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
</span><span lang=EN-US style='color:blue'>&lt;li</span><span lang=EN-US
style='color:black'> role=</span><span lang=EN-US>&quot;presentation&quot;<span
style='color:blue'>&gt;&lt;a</span><span style='color:black'> </span><span
style='color:red'>href</span><span style='color:black'>=</span>'{% url
&quot;myorder&quot; id=myuser.id %}'<span style='color:blue'>&gt;</span><span
style='color:black'>Order</span><span style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
</span><span lang=EN-US style='color:blue'>&lt;li</span><span lang=EN-US
style='color:black'> role=</span><span lang=EN-US>&quot;presentation&quot;<span
style='color:blue'>&gt;&lt;a</span><span style='color:black'> </span><span
style='color:red'>href</span><span style='color:black'>=</span>&quot;#&quot;<span
style='color:blue'>&gt;</span><span style='color:black'>Donate</span><span
style='color:blue'>&lt;/a&gt;&lt;/li&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;/ul&gt;</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black;background:white'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>URL</span><span style='font-family:宋体'>添加各个</span><span
lang=EN-US>tab</span><span style='font-family:宋体'>的链接</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; url</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>r'^(?P&lt;id&gt;\d+)/$'<b><span
style='color:navy'>,</span></b><span style='color:black'> personalcenterhome</span><b><span
style='color:navy'>,</span></b><span style='color:black'> name</span><b><span
style='color:navy'>=</span></b>'personalcenter'<b><span style='color:navy'>),</span></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; url</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>r'^(?P&lt;id&gt;\d+)/myorder$'<b><span
style='color:navy'>,</span></b><span style='color:black'> myorder</span><b><span
style='color:navy'>,</span></b><span style='color:black'> name</span><b><span
style='color:navy'>=</span></b>'myorder'<b><span style='color:navy'>),</span></b><span
style='color:black'> </span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; url</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>r'^(?P&lt;id&gt;\d+)/myprofileextend$'<b><span
style='color:navy'>,</span></b><span style='color:black'> myuser_profile_extend</span><b><span
style='color:navy'>,</span></b><span style='color:black'> name</span><b><span
style='color:navy'>=</span></b>'myuser_profile_extend'<b><span
style='color:navy'>),</span></b><span style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; url</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>r'^(?P&lt;id&gt;\d+)/change$'<b><span
style='color:navy'>,</span></b><span style='color:black'> ProfileDetailView</span><b><span
style='color:navy'>.</span></b><span style='color:black'>as_view</span><b><span
style='color:navy'>(),</span></b><span style='color:black'> name</span><b><span
style='color:navy'>=</span></b>'profile_detail'<b><span style='color:navy'>),</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>以我订单为例</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> <span style='color:fuchsia'>myorder</span><b><span
style='color:navy'>(</span></b>request<b><span style='color:navy'>,</span></b>id<b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; myuser <b><span
style='color:navy'>=</span></b> get_object_or_404<b><span style='color:navy'>(</span></b>UserModel<b><span
style='color:navy'>,</span></b> id<b><span style='color:navy'>=</span></b>id<b><span
style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>try</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usercheckout <b><span style='color:navy'>=</span></b> UserCheckout<b><span
style='color:navy'>.</span></b>objects<b><span style='color:navy'>.</span></b>get<b><span
style='color:navy'>(</span></b>user <b><span style='color:navy'>=</span></b>
myuser<b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>except</span></b> UserCheckout<b><span style='color:navy'>.</span></b>DoesNotExist<b><span
style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usercheckout <b><span style='color:navy'>=</span></b> <b><span
style='color:blue'>None</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>except</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b><span style='color:blue'>raise</span></b> Http404</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; order_objects <b><span
style='color:navy'>=</span></b> Order<b><span style='color:navy'>.</span></b>objects<b><span
style='color:navy'>.</span></b>filter<b><span style='color:navy'>(</span></b>user
<b><span style='color:navy'>=</span></b> usercheckout<b><span style='color:
navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; template <b><span
style='color:navy'>=</span></b> <span style='color:gray'>&quot;personalcenter/myorder.html&quot;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; context <b><span
style='color:navy'>=</span></b> <b><span style='color:navy'>{</span></b>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>&quot;myuser&quot;</span><b><span style='color:navy'>:</span></b>
myuser<b><span style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:gray'>&quot;order_objects&quot;</span> <b><span
style='color:navy'>:</span></b> order_objects<b><span style='color:navy'>,</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:navy'>}</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:宋体;color:black;background:white'>为了支持积分，等级等，添加了新的</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black;
background:white'>model-UserProfile</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>class</span><span
lang=EN-US> UserProfile<span style='color:navy'>(</span>models<span
style='color:navy'>.</span>Model<span style='color:navy'>):</span> </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; user <span
style='color:navy'>=</span> models<span style='color:navy'>.</span>OneToOneField<span
style='color:navy'>(</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
settings<span style='color:navy'>.</span>AUTH_USER_MODEL<span style='color:
navy'>,</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
on_delete<span style='color:navy'>=</span>models<span style='color:navy'>.</span>CASCADE<span
style='color:navy'>,</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; score <span
style='color:navy'>=</span> models<span style='color:navy'>.</span>DecimalField<span
style='color:navy'>(</span>max_digits<span style='color:navy'>=</span><span
style='color:red'>10</span><span style='color:navy'>,</span> decimal_places<span
style='color:navy'>=</span><span style='color:red'>0</span><span
style='color:navy'>,</span> default<span style='color:navy'>=</span><span
style='color:red'>0</span><span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; level <span
style='color:navy'>=</span> models<span style='color:navy'>.</span>DecimalField<span
style='color:navy'>(</span>max_digits<span style='color:navy'>=</span><span
style='color:red'>10</span><span style='color:navy'>,</span> decimal_places<span
style='color:navy'>=</span><span style='color:red'>0</span><span
style='color:navy'>,</span> default<span style='color:navy'>=</span><span
style='color:red'>0</span><span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>def</span> <span style='color:fuchsia'>__unicode__</span><span
style='color:navy'>(</span>self<span style='color:navy'>):</span>&nbsp; </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> str<span style='color:navy'>(</span>self<span
style='color:navy'>.</span>user<span style='color:navy'>)</span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员等级</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以根据捐衣次数或者兑换次数，或者消费积分的累积，享受不同的折扣兑换，增加用户对网站的粘性</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>我的捐赠</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以展示我捐赠衣服的次数，时间，上传的照片等其它信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>我的订单</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>显示我使用积分商城的兑换情况</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>将用户的订单信息传递给</span><span
lang=EN-US>template</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>class</span><span
lang=EN-US> ProfileDetailView<span style='color:navy'>(</span>FormMixin<span
style='color:navy'>,</span> DetailView<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; model <span
style='color:navy'>=</span> UserModel</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; template_name <span
style='color:navy'>=</span> <span style='color:gray'>&quot;personalcenter/profile_detail.html&quot;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; form_class <span
style='color:navy'>=</span> MyUserForm</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:
blue'>def</span> <span style='color:fuchsia'>get_context_data</span><span
style='color:navy'>(</span>self<span style='color:navy'>,</span> <span
style='color:navy'>*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>):</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context <span style='color:navy'>=</span> super<span style='color:navy'>(</span>ProfileDetailView<span
style='color:navy'>,</span> self<span style='color:navy'>).</span>get_context_data<span
style='color:navy'>(*</span>args<span style='color:navy'>,</span> <span
style='color:navy'>**</span>kwargs<span style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context<span style='color:navy'>[</span><span style='color:gray'>&quot;form&quot;</span><span
style='color:navy'>]</span> <span style='color:navy'>=</span> self<span
style='color:navy'>.</span>form_class<span style='color:navy'>(</span>instance <span
style='color:navy'>=</span> self<span style='color:navy'>.</span>get_object<span
style='color:navy'>())</span> </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
upload_file_form <span style='color:navy'>=</span> UploadFileForm<span
style='color:navy'>()</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context<span style='color:navy'>[</span><span style='color:gray'>&quot;upload_form&quot;</span><span
style='color:navy'>]</span> <span style='color:navy'>=</span> upload_file_form</span></p>

<p class=codewithbg><span lang=EN-US>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usermodel <span style='color:navy'>=</span> UserModel<span style='color:navy'>.</span>objects<span
style='color:navy'>.</span>get<span style='color:navy'>(</span>id<span
style='color:navy'>=</span>self<span style='color:navy'>.</span>kwargs<span
style='color:navy'>.</span>get<span style='color:navy'>(</span><span
style='color:gray'>&quot;id&quot;</span><span style='color:navy'>))</span></span></p>

<p class=codewithbg><span lang=EN-US>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>from</span> orders<span style='color:navy'>.</span>models <span
style='color:blue'>import</span> UserCheckout</span></p>

<p class=codewithbg><span lang=EN-US>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
usercheckout <span style='color:navy'>=</span> UserCheckout<span
style='color:navy'>.</span>objects<span style='color:navy'>.</span>get<span
style='color:navy'>(</span>user <span style='color:navy'>=</span> usermodel<span
style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context<span style='color:navy'>[</span><span style='color:gray'>&quot;object_list&quot;</span><span
style='color:navy'>]</span> <span style='color:navy'>=</span> Order<span
style='color:navy'>.</span>objects<span style='color:navy'>.</span>filter<span
style='color:navy'>(</span>user <span style='color:navy'>=</span> usercheckout<span
style='color:navy'>)</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:blue'>return</span> context</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US>profile_detail.html</span><span
style='font-family:宋体'>里面加上</span><span lang=EN-US>order</span><span
style='font-family:宋体'>信息的显示，具体的积分兑换情况等后面实现了再加</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;h3&gt;</span>Your Orders<span style='color:blue'>&lt;/h3&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;table</span> <span style='color:red'>class</span>=<span
style='color:#8000FF'>'table'</span><span style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;tr&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;th&gt;</span>Order Number<span style='color:blue'>&lt;/th&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;th&gt;</span>Item Count<span style='color:blue'>&lt;/th&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;th&gt;</span>Exchange<span style='color:blue'>&lt;/th&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;/tr&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {%
for object in object_list %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;tr&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;td&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>'{{ object.get_absolute_url }}'</span><span
style='color:blue'>&gt;</span>#{% if object.order_id %}{{ object.order_id }}{%
else %}{{ object.id }}{% endif %}<span style='color:blue'>&lt;/a&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;/td&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;td&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{
object.cart.items.count }}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;/td&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;td&gt;</span>0<span style='color:blue'>&lt;/td&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;/tr&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {%
endfor %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:blue'>&lt;/table&gt;</span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=458 height=668
id="Picture 7" src="Zakkabag.files/image004.png"></span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>设置</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>个人资料修改</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>修改个人信息资料，包含会员性别，生日，昵称等</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=371 height=571
id="Picture 16" src="Zakkabag.files/image005.png"></span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>密码修改</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>修改登录密码</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=371 height=571
id="Picture 15" src="Zakkabag.files/image006.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>意见反馈</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>给网站提出意见</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=371 height=571
id="Picture 13" src="Zakkabag.files/image007.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>注销登录</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>注销当前用户登录信息</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=372 height=571
id="Picture 14" src="Zakkabag.files/image008.png"></span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>活动消息</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>动态消息展示</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以显示后台发送的动态消息等</span><span
lang=EN-US> scroll spy</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>轮播图</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>轮播切换广告图片，可以放自己活动也可以作为广告位营销</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=423 height=544
id="图片 19" src="Zakkabag.files/image009.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>全屏显示</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>活动专区</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>展示活动内容</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=576 height=559
id="图片 18" src="Zakkabag.files/image010.jpg"></span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>捐衣模块</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>拍照上传</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>捐赠衣服前可以调用手机摄像头功能拍照上传</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>捐衣信息填报</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>填写捐赠件数等其它信息，还可以选择具体哪个捐赠衣服箱，方便工作人员审核和统计</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>目录</span></p>

<p class=MsoNormal><span lang=EN-US style='background:yellow'>upload</span><span
lang=EN-US> &gt;&gt; user</span></p>

<p class=MsoNormal><span lang=EN-US>products &gt;&gt; category &gt;&gt; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&gt;&gt; featured_product</span></p>

<p class=MsoNormal><span lang=EN-US style='background:lime'>banner &gt;&gt;
filename*</span></p>

<p class=MsoNormal><span lang=EN-US>crowdfunding &gt;&gt; username</span></p>

<p class=MsoNormal><span lang=EN-US>profile &gt;&gt; username</span></p>

<p class=MsoNormal><span lang=EN-US style='background:lime'>footer &gt;&gt;
filename*</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>众筹模块</span><span
lang=EN-US> (</span><span style='font-family:宋体'>产品模块代替</span><span lang=EN-US>)</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹列表</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以列表展示众筹信息</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://127.0.0.1:8000/crowdfundings/">http://127.0.0.1:8000/crowdfundings/</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹分类</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以根据大病救助，助学，创业分类展示众筹信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹详情</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以展示众筹内容的展示，包含众筹的标题，内容以及图片和详情等具体信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>筹款动态</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以显示筹款的动态信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹评论</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对本条众筹可以添加评论信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹收藏</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以收藏众筹信息，方便之后可以快速找到</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹分享</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以把众筹信息，分享到主流的第三方平台上比如微信，朋友圈，微博，</span><span
lang=EN-US>qq</span><span style='font-family:宋体'>等</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>在线支付</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以通过在线支付支持爱心众筹，微网站支持微信一种支付方式</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>举报</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>如果发现不是真实的众筹信息，可以通过举报按钮提交举报，工作人员可以后台审核举报信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>发布众筹</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以通过平台发起大病救助，扶贫助学，支持创业等众筹项目，包含金额，用途，截止日期，标题，详情，照片，身份证信息等资料</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>积分商城</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>商品列表</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>展示积分商城的商品，包含<span
style='color:#00B050'>图片</span>，<span style='color:#00B050'>标题</span>，所需<span
style='color:#00B050'>兑换积分</span>等信息</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=426 height=642
id="图片 20" src="Zakkabag.files/image011.png"></span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>商品分类</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以根据<span style='color:#00B050'>分类</span>展示不同的兑换商品</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=389 height=668
id="Picture 9" src="Zakkabag.files/image012.png"></span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>商品详情</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>展示单个积分商城商品的详细信息</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=389 height=668
id="Picture 10" src="Zakkabag.files/image013.png"></span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>积分兑换</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>通过积分兑换模块兑换所选择的商品，自动扣取积分</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=415 height=547
id="Picture 11" src="Zakkabag.files/image014.png"></span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>积分兑换规则</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以通过后台配置积分规则，前台此模块显示兑换的规则</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h1><span style='font-family:宋体'>公益平台管理系统（</span><span lang=EN-US>PC Web</span><span
style='font-family:宋体'>）</span></h1>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>会员管理</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员认证管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>会员认证管理是对于会员的认证信息进行管理，可调整会员的认证方式包括手机认证、邮箱认证等其他第三方认证，关联微信</span><span
lang=EN-US>openid,</span><span style='font-family:宋体'>同时对会员的认证相关信息进行维护。</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员资料管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>会员资料管理是对会员的个人资料进行管理，可查看会员相关资料信息包括姓名、性别、手机、注册时间、邮箱、生日、剩余积分、等信息，可通过姓名、性别、手机号、等信息进行查询。提供新增会员，并根据需要进行查看详情、修改、删除功能。</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员积分管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>会员积分管理是对会员积分，兑换相关业务进行管理，可记录回溯兑换业务信息，包括手机号码、会员名称、兑换时间、兑换金额、本次积分、兑换商品、办理渠道、结算方式等，可通过电话以及选择相应开始时间到结束时间进行查询；可支撑会员的退积分业务处理。如果客户有</span><span
lang=EN-US>ERP</span><span style='font-family:宋体'>系统，各笔消费相关业务操作记录券可通过接口同步至</span><span
lang=EN-US>ERP</span><span style='font-family:宋体'>系统。</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员捐衣管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对于会员捐衣纪录进行管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员等级管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>会员等级是可以新增会员等级，设置会员等级名称，消费金额，演出折扣，配置会员权益说明的功能。</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>会员协议管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对线上平台出现的会员协议内容进行管理，可编辑修改会员协议内容。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>微网站内容管理</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>微网站轮播图管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对微网站轮播图进行新增，修改，删除，更换位置等管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>微网站活动管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对微网站活动列表以及内容进行新增，修改，删除等管理</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span lang=EN-US>app</span><span
style='font-family:宋体'>内容管理</span></h2>

<h3 style='text-indent:44.15pt'><span lang=EN-US>app</span><span
style='font-family:宋体'>轮播图管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对</span><span lang=EN-US>app</span><span
style='font-family:宋体'>轮播图进行新增，修改，删除，更换位置等管理</span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>app</span><span
style='font-family:宋体'>活动管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对</span><span lang=EN-US>app</span><span
style='font-family:宋体'>活动列表以及内容进行新增，修改，删除等管理</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>消息推送</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>全局消息推送</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以通过后台给全部会员发布消息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>分组会员消息推送</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>可以根据对组员分类推送不同消息，比如对参加同个众筹的会员推送众筹的进度情况</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>众筹管理</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>官方发起众筹</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>官方发起的众筹的可以通过管理后台发布</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>众筹管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对于平台上用户发起的众筹进度进行监控管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>审核管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对用户提交的的众筹信息进行审核和对外发布，可以进行删除和管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>评论管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>管理对众筹发布的评论信息</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>举报管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对于用户举报的众筹信息进行评估监控可以对其核实，删除等管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>支付管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>管理用户对众筹投入的资金，管控到期众筹的资金发放</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>商城管理</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>商品推荐管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对积分商城推荐的商品进行推荐管理，可以更换推荐的位置，删除推荐等</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>商品上下架管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对积分商城的商品进行上架和下架的维护和库存管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>商品详情管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>对金粉商城的商品进行商品内容，图片，详细信息的内容管理</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>订单管理</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>管理积分兑换的订单进行管理</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><a name="_图片上传"></a><span style='font-family:
宋体'>图片上传</span><span lang=EN-US> (</span><span style='font-family:宋体'>后台</span><span
lang=EN-US>)</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>需求：添加新产品，其中包括上传产品图片。需要动态的更新上传进度。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/topics/http/file-uploads/#handling-uploaded-files-with-a-model">https://docs.djangoproject.com/en/1.8/topics/http/file-uploads/#handling-uploaded-files-with-a-model</a></span></p>

<p class=MsoNormal><span class=pre><b><span lang=EN-US style='font-size:10.5pt;
color:#0C4B33;border:none windowtext 1.0pt;padding:0cm'>Handling uploaded files
with a model</span></b></span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/topics/http/file-uploads/#handling-uploaded-files-with-a-model"
title="Permalink to this headline"><span class=pre><b><span style='font-size:
10.5pt;color:#0C4B33;border:none windowtext 1.0pt;padding:0cm;text-decoration:
none'>&para;</span></b></span></a></span></p>

<p style='background:white'><span lang=EN-US style='font-size:10.5pt;
font-family:Roboto;color:#0C3C26'>If you’re saving a file on a<span
class=apple-converted-space>&nbsp;</span></span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/ref/models/instances/#django.db.models.Model"
title=django.db.models.Model><span class=pre><b><span style='font-size:10.5pt;
color:#0C4B33;border:none windowtext 1.0pt;padding:0cm;text-decoration:none'>Model</span></b></span></a></span><span
class=apple-converted-space><span lang=EN-US style='font-size:10.5pt;
font-family:Roboto;color:#0C3C26'>&nbsp;</span></span><span lang=EN-US
style='font-size:10.5pt;font-family:Roboto;color:#0C3C26'>with a<span
class=apple-converted-space>&nbsp;</span></span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.FileField"
title=django.db.models.FileField><span class=pre><b><span style='font-size:
10.5pt;color:#0C4B33;border:none windowtext 1.0pt;padding:0cm;text-decoration:
none'>FileField</span></b></span></a></span><span lang=EN-US style='font-size:
10.5pt;font-family:Roboto;color:#0C3C26'>, using a<span
class=apple-converted-space>&nbsp;</span></span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/topics/forms/modelforms/#django.forms.ModelForm"
title=django.forms.ModelForm><span class=pre><b><span style='font-size:10.5pt;
color:#0C4B33;border:none windowtext 1.0pt;padding:0cm;text-decoration:none'>ModelForm</span></b></span></a></span><span
class=apple-converted-space><span lang=EN-US style='font-size:10.5pt;
font-family:Roboto;color:#0C3C26'>&nbsp;</span></span><span lang=EN-US
style='font-size:10.5pt;font-family:Roboto;color:#0C3C26'>makes this process
much easier. The file object will be saved to the location specified by the<span
class=apple-converted-space>&nbsp;</span></span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.FileField.upload_to"
title="django.db.models.FileField.upload_to"><span class=pre><b><span
style='font-size:10.5pt;color:#0C4B33;border:none windowtext 1.0pt;padding:
0cm;text-decoration:none'>upload_to</span></b></span></a></span><span
class=apple-converted-space><span lang=EN-US style='font-size:10.5pt;
font-family:Roboto;color:#0C3C26'>&nbsp;</span></span><span lang=EN-US
style='font-size:10.5pt;font-family:Roboto;color:#0C3C26'>argument of the
corresponding<span class=apple-converted-space>&nbsp;</span></span><span
lang=EN-US><a
href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.FileField"
title=django.db.models.FileField><span class=pre><b><span style='font-size:
10.5pt;color:#0C4B33;border:none windowtext 1.0pt;padding:0cm;text-decoration:
none'>FileField</span></b></span></a></span><span class=apple-converted-space><span
lang=EN-US style='font-size:10.5pt;font-family:Roboto;color:#0C3C26'>&nbsp;</span></span><span
lang=EN-US style='font-size:10.5pt;font-family:Roboto;color:#0C3C26'>when
calling </span><span class=pre><b><span lang=EN-US style='font-size:10.5pt;
color:#0C4B33'>form.save()</span></b></span><span lang=EN-US style='font-size:
10.5pt;font-family:Roboto;color:#0C3C26'>:</span></p>

<pre style='margin-top:0cm;margin-right:15.0pt;margin-bottom:0cm;margin-left:
15.0pt;margin-bottom:.0001pt;background:#F8F8F8'><span class=kn><b><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:green'>from</span></b></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> </span><span
class=nn><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:blue'>django.http</span></b></span><span lang=EN-US style='font-size:
10.5pt;font-family:"Fira Mono";color:#0C4B33'> </span><span class=k><b><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:green'>import</span></b></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=n>HttpResponseRedirect</span></span></pre><pre style='margin-top:0cm;
margin-right:15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;
background:#F8F8F8'><span class=kn><b><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:green'>from</span></b></span><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> </span><span
class=nn><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:blue'>django.shortcuts</span></b></span><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> </span><span
class=k><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:green'>import</span></b></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> <span class=n>render</span></span></pre><pre
style='margin-top:0cm;margin-right:15.0pt;margin-bottom:0cm;margin-left:15.0pt;
margin-bottom:.0001pt;background:#F8F8F8'><span class=kn><b><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:green'>from</span></b></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> </span><span
class=nn><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:blue'>.forms</span></b></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> </span><span class=k><b><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:green'>import</span></b></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=n>ModelFormWithFileField</span></span></pre><pre style='margin-top:0cm;
margin-right:15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;
background:#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;</span></pre><pre style='margin-top:0cm;margin-right:15.0pt;
margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:#F8F8F8'><span
class=k><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:green'>def</span></b></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> </span><span class=nf><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:blue'>upload_file</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>(</span></span><span class=n><span lang=EN-US style='font-size:
10.5pt;font-family:"Fira Mono";color:#0C4B33'>request</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>):</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp; </span><span class=k><b><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:green'>if</span></b></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=n>request</span></span><span class=o><span lang=EN-US style='font-size:
10.5pt;font-family:"Fira Mono";color:#666666'>.</span></span><span class=n><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>method</span></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> </span><span
class=o><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#666666'>==</span></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> </span><span class=s1><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:#BA2121'>'POST'</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>:</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=n>form</span> </span><span
class=o><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#666666'>=</span></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> <span class=n>ModelFormWithFileField</span><span
class=p>(</span><span class=n>request</span></span><span class=o><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#666666'>.</span></span><span
class=n><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>POST</span></span><span class=p><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>,</span></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=n>request</span></span><span class=o><span lang=EN-US style='font-size:
10.5pt;font-family:"Fira Mono";color:#666666'>.</span></span><span class=n><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>FILES</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>)</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=k><b><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:green'>if</span></b></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=n>form</span></span><span class=o><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#666666'>.</span></span><span class=n><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>is_valid</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>():</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=c1><i><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#408080'># file is saved</span></i></span></pre><pre style='margin-top:
0cm;margin-right:15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:
.0001pt;background:#F8F8F8'><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
class=n>form</span></span><span class=o><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#666666'>.</span></span><span class=n><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>save</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>()</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=k><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:green'>return</span></b></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> <span class=n>HttpResponseRedirect</span><span
class=p>(</span></span><span class=s1><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#BA2121'>'/success/url/'</span></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>)</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp; </span><span class=k><b><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:green'>else</span></b></span><span
class=p><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>:</span></span></pre><pre style='margin-top:0cm;margin-right:
15.0pt;margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:
#F8F8F8'><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#0C4B33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=n>form</span> </span><span
class=o><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#666666'>=</span></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> <span class=n>ModelFormWithFileField</span><span
class=p>()</span></span></pre><pre style='margin-top:0cm;margin-right:15.0pt;
margin-bottom:0cm;margin-left:15.0pt;margin-bottom:.0001pt;background:#F8F8F8'><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>&nbsp;&nbsp;&nbsp; </span><span
class=k><b><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:green'>return</span></b></span><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#0C4B33'> <span class=n>render</span><span
class=p>(</span><span class=n>request</span><span class=p>,</span> </span><span
class=s1><span lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";
color:#BA2121'>'upload.html'</span></span><span class=p><span lang=EN-US
style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>,</span></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=p>{</span></span><span class=s1><span lang=EN-US style='font-size:10.5pt;
font-family:"Fira Mono";color:#BA2121'>'form'</span></span><span class=p><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'>:</span></span><span
lang=EN-US style='font-size:10.5pt;font-family:"Fira Mono";color:#0C4B33'> <span
class=n>form</span><span class=p>})</span></span></pre>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>1. </span><span style='font-family:宋体'>添加表单</span><span
lang=EN-US>Form</span></p>

<p class=MsoNormal><span style='font-family:宋体;color:black'>注意</span><span
lang=EN-US style='color:black'>: </span><span style='font-family:宋体;color:black'>在表单中加入</span><span
lang=EN-US><a href="http://www.w3school.com.cn/tags/att_form_enctype.asp">enctype</a></span><span
lang=EN-US style='color:black'>=&quot;multipart/form-data</span><span
style='font-family:宋体;color:black'>；如果不加</span><span lang=EN-US
style='color:black'>enctype=&quot;multipart/form-data</span><span
style='font-family:宋体;color:black'>，得不到图片信息，只有路径</span></p>

<p class=MsoNormal><span lang=EN-US>FILES</span><span style='font-family:宋体'>是个字典，它包含每个</span><span
lang=EN-US>FileField</span><span style='font-family:宋体'>的键</span> <span
style='font-family:宋体'>（或者</span><span lang=EN-US>ImageField</span><span
style='font-family:宋体'>，</span><span lang=EN-US>FileField</span><span
style='font-family:宋体'>的子类）。这样的话就可以用</span><span lang=EN-US>request.FILES['File']</span><span
style='font-family:宋体'>来存放表单中的这些数据了。</span> </p>

<p class=MsoNormal><span style='font-family:宋体'>注意</span><span lang=EN-US>request.FILES</span><span
style='font-family:宋体'>只有在请求方法为</span><span lang=EN-US>POST</span><span
style='font-family:宋体'>，并且发送请求的</span><span lang=EN-US>&lt;form&gt;</span><span
style='font-family:宋体'>拥有</span><span lang=EN-US>enctype=&quot;multipart/form-data</span><span
style='font-family:宋体'>属性时，才会包含数据。否则</span><span lang=EN-US>request.FILES</span><span
style='font-family:宋体'>为空</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>创建</span><span lang=EN-US>ProductImageForm</span><span
style='font-family:宋体'>用于图片的上传，里面唯一的</span><span lang=EN-US>field</span><span
style='font-family:宋体'>是</span><span lang=EN-US>image</span></p>

<p class=MsoNormal><span lang=EN-US>products/forms.py</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
ProductImageForm</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>forms</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>ModelForm</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>class</span><span lang=EN-US> Meta</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; model
</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
ProductImage</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fields
</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>[</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:gray;background:lime'>'image'</span><span lang=EN-US
style='color:navy'>,</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:navy'>]</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在模板里面添加两个</span><span
lang=EN-US>form</span><span style='font-family:宋体'>，</span><span lang=EN-US>ProductCreateForm</span><span
style='font-family:宋体'>和</span><span lang=EN-US>ProductImageForm</span><span
style='font-family:宋体'>，分别用于正常的产品信息的创建和图片的上传。</span></p>

<p class=MsoNormal><span lang=EN-US>products/templates/products/product_create.html</span></p>

<p class=code><span lang=EN-US>-</span><span lang=EN-US style='color:blue'>&lt;form</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>method</span><span
lang=EN-US>=</span><span lang=EN-US style='color:#8000FF'>'POST'</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>action</span><span
lang=EN-US>=</span><span lang=EN-US style='color:#8000FF'>''</span><span
lang=EN-US style='color:blue'>&gt;</span><span lang=EN-US>{% csrf_token %}</span></p>

<p class=code><span lang=EN-US>+</span><span lang=EN-US style='color:blue'>&lt;form</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>method</span><span
lang=EN-US>=</span><span lang=EN-US style='color:#8000FF'>'POST'</span><span
lang=EN-US> </span><a name="OLE_LINK124"></a><a name="OLE_LINK123"><span
lang=EN-US style='color:red;background:lime'>enctype</span><span lang=EN-US
style='background:lime'>=</span></a><span lang=EN-US style='color:#8000FF;
background:lime'>&quot;multipart/form-data&quot;</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>action</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>''</span><span lang=EN-US style='color:blue'>&gt;</span><span
lang=EN-US>{% csrf_token %}</span></p>

<p class=code><span lang=EN-US>&nbsp;{{ form|crispy }}</span></p>

<p class=code><span lang=EN-US>+{{image_form.as_p}}</span></p>

<p class=code><span lang=EN-US>&nbsp;</span><span lang=EN-US style='color:blue'>&lt;input</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>class</span><span
lang=EN-US> = </span><span lang=EN-US style='color:#8000FF'>'btn btn-primary'</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>type</span><span
lang=EN-US>=</span><span lang=EN-US style='color:#8000FF'>'submit'</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>value</span><span
lang=EN-US>=</span><span lang=EN-US style='color:#8000FF'>'Submit'</span><span
lang=EN-US> </span><span lang=EN-US style='color:blue'>/&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;</span><span lang=EN-US style='color:blue'>&lt;/form&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>products/views.py</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US>get_context_data</span><span
style='font-family:宋体'>里面把</span><span lang=EN-US>ProductImageForm</span><span
style='font-family:宋体'>传给</span><span lang=EN-US>server</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
ProductCreateView</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>CreateView</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; template_name </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>'products/product_create.html'</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; form_class </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> ProductCreateForm</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; success_url </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>&quot;/products&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>get_context_data</span><span lang=EN-US style='color:
navy'>(</span><span lang=EN-US>self</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> </span><span lang=EN-US style='color:navy'>*</span><span
lang=EN-US>args</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> </span><span lang=EN-US style='color:navy'>**</span><span
lang=EN-US>kwargs</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
super</span><span lang=EN-US style='color:navy'>(</span><span lang=EN-US>ProductCreateView</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> self</span><span
lang=EN-US style='color:navy'>).</span><span lang=EN-US>get_context_data</span><span
lang=EN-US style='color:navy'>(*</span><span lang=EN-US>args</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>**</span><span lang=EN-US>kwargs</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context</span><span lang=EN-US style='color:navy'>[</span><span lang=EN-US
style='color:gray'>&quot;image_form&quot;</span><span lang=EN-US
style='color:navy'>]</span><span lang=EN-US> </span><span lang=EN-US
style='color:navy'>=</span><span lang=EN-US> <span style='background:lime'>ProductImageForm</span></span><span
lang=EN-US style='color:navy'>()</span><span lang=EN-US style='color:green'>#</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#141;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#142;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>return</span><span lang=EN-US> context</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>post</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>self</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> request</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> </span><span lang=EN-US style='color:navy'>*</span><span
lang=EN-US>args</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> </span><span lang=EN-US style='color:navy'>**</span><span
lang=EN-US>kwargs</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
postresult </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
super</span><span lang=EN-US style='color:navy'>(</span><span lang=EN-US>ProductCreateView</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> self</span><span
lang=EN-US style='color:navy'>).</span><span lang=EN-US>post</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>request</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>*</span><span lang=EN-US>args</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>**</span><span lang=EN-US>kwargs</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>if</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>0</span><span lang=EN-US style='color:navy'>: #</span><span
style='font-family:宋体;color:navy'>方法</span><span lang=EN-US style='color:navy'>1
C </span><span style='font-family:宋体;color:navy'>手动处理文件保存</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
filename</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US
style='background:lime'>request</span><span lang=EN-US style='color:navy;
background:lime'>.</span><span lang=EN-US style='background:lime'>FILES</span><span
lang=EN-US style='color:navy'>[</span><span lang=EN-US style='color:gray;
background:lime'>'image'</span><span lang=EN-US style='color:navy'>]</span><span
lang=EN-US style='color:green'> #</span><span lang=EN-US style='font-family:
Wingdings;color:green'>&#140;</span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#141;</span><span lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>from</span><span lang=EN-US> PIL </span><span
lang=EN-US style='color:blue'>import</span><span lang=EN-US> Image </span><span
lang=EN-US style='color:green'>#</span><span lang=EN-US style='font-family:
Wingdings;color:green'>&#140;</span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#141;</span><span lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>if</span><span lang=EN-US> filename</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
img</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US
style='background:yellow'>Image</span><span lang=EN-US style='color:navy;
background:yellow'>.</span><span lang=EN-US style='background:yellow'>open</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>filename</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
title </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US> self</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>object</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>title</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
slug </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
slugify</span><span lang=EN-US style='color:navy'>(</span><span lang=EN-US>title</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
basename</span><span lang=EN-US style='color:navy'>,</span><span lang=EN-US>
file_extension </span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US> filename</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>name</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>split</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US style='color:gray'>&quot;.&quot;</span><span lang=EN-US
style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
new_filename </span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>&quot;%s-%s.%s&quot;</span><span
lang=EN-US> </span><span lang=EN-US style='color:navy'>%(</span><span
lang=EN-US>slug</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> self</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>object</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>id</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> file_extension</span><span lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>from</span><span lang=EN-US> django</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>conf </span><span
lang=EN-US style='color:blue'>import</span><span lang=EN-US> settings</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>import</span><span lang=EN-US> os</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
photoname </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
os</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>path</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>join</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US style='color:gray'>&quot;products&quot;</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> slug</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> new_filename</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
photopath </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
os</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>path</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>join</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>settings</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>MEDIA_ROOT</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>&quot;products&quot;</span><span lang=EN-US
style='color:navy'>,</span><span lang=EN-US> slug</span><span lang=EN-US
style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>if</span><span lang=EN-US> </span><span
lang=EN-US style='color:blue'>not</span><span lang=EN-US> os</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>path</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>exists</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>photopath</span><span
lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
os</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>makedirs</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>photopath</span><span
lang=EN-US style='color:navy'>)</span><span lang=EN-US style='color:green'> #</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#141;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#142;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>img</span></span><span lang=EN-US
style='color:navy;background:yellow'>.</span><span lang=EN-US style='background:
yellow'>save</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>os</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>path</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>join</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>settings</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>MEDIA_ROOT</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> photoname</span><span lang=EN-US style='color:navy'>))</span><span
lang=EN-US style='color:green'> #</span><span lang=EN-US style='font-family:
Wingdings;color:green'>&#140;</span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#141;</span><span lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ProductImage</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>objects</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>create</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>product </span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US> self</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>object</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
image </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
photoname</span><span lang=EN-US style='color:navy'>)</span><span lang=EN-US
style='color:green'> #</span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#140;</span><span lang=EN-US style='font-family:Wingdings;color:green'>&#141;</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># BELOW ALSO WORKS </span><span
style='font-family:宋体;color:green'>方法</span><span lang=EN-US style='color:green'>2
C </span><span style='font-family:宋体;color:green'>利用</span><span lang=EN-US
style='color:green'>form</span><span style='font-family:宋体;color:green'>处理文件保存</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>else</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
imageForm </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
ProductImageForm</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>request</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>POST</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> <span style='background:yellow'>request</span></span><span
lang=EN-US style='color:navy;background:yellow'>.</span><span lang=EN-US
style='background:yellow'>FILES</span><span lang=EN-US style='color:navy'>)</span><span
lang=EN-US style='color:green'> #</span><span lang=EN-US style='font-family:
Wingdings;color:green'>&#140;</span><span lang=EN-US style='font-family:Wingdings;
color:green'>&#141;</span><span lang=EN-US style='font-family:Wingdings;color:green'>&#142;</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>if</span><span lang=EN-US> imageForm</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>is_valid</span><span
lang=EN-US style='color:navy'>():</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
productImage </span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US> <span style='background:yellow'>imageForm</span></span><span
lang=EN-US style='color:navy;background:yellow'>.</span><span lang=EN-US
style='background:yellow'>save</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>commit</span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US style='color:blue'>False</span><span lang=EN-US style='color:navy'>)</span><span
lang=EN-US> </span><span lang=EN-US style='color:green'>#</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#141;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#142;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
productImage</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>product </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>object</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
productImage</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>save</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> postresult</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US>
postresult&nbsp;&nbsp;&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.2/topics/http/file-uploads/">https://docs.djangoproject.com/en/1.2/topics/http/file-uploads/</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/RoundGirl/p/5395658.html"><span style='background:
lime'>django</span><span lang=EN-US style='font-family:宋体;background:lime'><span
lang=EN-US>上传图片</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/DjangoBlog/p/3557744.html">python image<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>模块</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a href="http://www.qttc.net/201209207.html">Python<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>创建目录文件夹</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Helvetica","sans-serif"'><a
href="https://www.douban.com/group/topic/21131470/">[<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>豆瓣</span></span>]<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>浅论</span></span>Django<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>文件上传</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://onlypython.group.iteye.com/group/wiki/1517-django-ajax-file-uploads-and-progress-display">Django
Ajax <span lang=EN-US style='font-family:宋体'><span lang=EN-US>文件上传及进度显示</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://blog.csdn.net/dimply/article/details/42425373">Ajax <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>和</span></span> jQuery <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>实现进度条＋上传文件到</span></span>Django
</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.alonely.com.cn/Ajax/20161025/58632.html">ajax<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>异步上传图片</span></span> ajax <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>异步上传带进度条视频并提取缩略图</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://blog.mozilla.org/webdev/2010/09/17/django-and-ajax-image-uploads/"><span
style='background:lime'>Django and AJAX image uploads</span></a> | <a
href="https://github.com/pcraciunoiu/kitsune/">Source Code</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://cloudinary.com/documentation/django_image_upload">Django image
upload</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://blueimp.github.io/jQuery-File-Upload/"><span style='background:
lime'>jQuery File Upload Demo</span></a><span class=MsoHyperlink> </span>| <a
href="https://github.com/blueimp/jQuery-File-Upload/wiki">wiki </a>| <a
href="https://github.com/blueimp/jQuery-File-Upload">Source Code</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://github.com/sigurdga/django-jquery-file-upload">Django jQuery File
Upload</a> django</span><span style='font-family:宋体'>基于</span><span lang=EN-US>jQuery
File Upload</span><span style='font-family:宋体'>的实现</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/cart55free99/p/3823357.html">jQuery File Upload</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.infoq.com/cn/articles/nodejs-npm-install-config">Node.js&amp;NPM<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>的安装与配置</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://stackoverflow.com/questions/38808548/django-manage-py-bower-install-tells-me-bower-isnt-installed-when-it-is">Django
“./manage.py bower install” tells me bower isn't installed when it is</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://fossies.org/windows/www/node-v8.0.0-win-x64.zip/">https://fossies.org/windows/www/node-v8.0.0-win-x64.zip/</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://jingyan.baidu.com/article/2d5afd69e243cc85a2e28efa.html">Windows<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>环境下的</span></span>NodeJS+NPM+Bower<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>安装配置</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><a name="_用户扩展"></a><span style='font-family:
宋体'>用户扩展</span></h2>

<p class=MsoNormal><span style='font-family:宋体'>用户扩展包括以下几种方法</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US>(1) </span><span style='font-family:宋体'>直接修改</span><span
lang=EN-US>django </span><span style='font-family:宋体'>源码</span> </p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US>(2) </span><span style='font-family:宋体'>把</span><span
lang=EN-US>django </span><span style='font-family:宋体'>的</span><span lang=EN-US>user</span><span
style='font-family:宋体'>以及认证部分的源代码拷贝到自己的</span><span lang=EN-US>app</span><span
style='font-family:宋体'>下面</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings;background:lime'>&#159;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US style='background:lime'>(3) OneToOneField</span><span
style='font-family:宋体;background:lime'>扩展</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US>(4) Profile Model (1.5</span><span
style='font-family:宋体'>之后不再支持</span><span lang=EN-US>)</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings;background:lime'>&#159;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US style='background:lime'>(5) AbstractBaseUser, PermissionsMixin</span><span
style='font-family:宋体;background:lime'>开始派生出一个自定用户</span><span lang=EN-US
style='background:lime'>Model</span><span style='font-family:宋体;background:
lime'>，并且实现自定义的</span><span lang=EN-US style='background:lime'>BaseUserManager
(1.5</span><span style='font-family:宋体;background:lime'>之后</span><span
lang=EN-US style='background:lime'>)</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US>(6) ProfileBase(type)</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:21.0pt;text-indent:-21.0pt'><a
name=t1></a><span lang=EN-US style='font-family:Wingdings'>&#159;<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>(7) </span><span style='font-family:宋体'>继承</span><span lang=EN-US>User</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>(1)(2) </span><span style='font-family:
宋体'>每次升级都要修改，不合适</span></p>

<p class=MsoNormal><span lang=EN-US>(7) </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>MyUser<span style='color:navy'>(</span></b>AbstractBaseUser<b><span
style='color:navy'>,</span></b> PermissionsMixin<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>MyUser<span style='color:navy'>(</span></b>AbstractUser<b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>MyUserManager<span style='color:navy'>(</span></b>BaseUserManager<b><span
style='color:navy'>):</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>扩展用户授权登录</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>指定</span><span
lang=EN-US>authentication backend</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Django</span><span style='font-family:宋体'>维护了一个</span><span
lang=EN-US>“authentication backends”</span><span style='font-family:宋体'>列表，通过它在授权。</span><span
lang=EN-US>Django</span><span style='font-family:宋体'>会遍历所有的</span><span
lang=EN-US>backends</span><span style='font-family:宋体'>直到授权接收。</span></p>

<p class=MsoNormal><span lang=EN-US>authentication backends</span><span
style='font-family:宋体'>在</span><span lang=EN-US>settings</span><span
style='font-family:宋体'>里的</span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-AUTHENTICATION_BACKENDS">AUTHENTICATION_BACKENDS</a></span><span
style='font-family:宋体'>指定，可以是任意路径，默认的</span><span lang=EN-US>backends</span><span
style='font-family:宋体'>是</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:gray'>['django.contrib.auth.backends.ModelBackend']</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:gray'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-AUTHENTICATION_BACKENDS">AUTHENTICATION_BACKENDS</a></span><span
style='font-family:宋体'>的顺序是有影响的，如果多个</span><span lang=EN-US>backends</span><span
style='font-family:宋体'>的用户名和密码都能验证通过，</span><span lang=EN-US>django</span><span
style='font-family:宋体'>在第一次匹配后就会停止。</span></p>

<p class=MsoNormal><span style='font-family:宋体'>如果</span><span lang=EN-US>backend</span><span
style='font-family:宋体'>抛出</span><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/ref/exceptions/#django.core.exceptions.PermissionDenied"
title=django.core.exceptions.PermissionDenied>PermissionDenied</a></span><span
style='font-family:宋体'>异常，授权检查会立即停止，不会再检查后面的</span><span lang=EN-US>backend</span><span
style='font-family:宋体'>。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体;color:red'>注意</span><span
style='font-family:宋体'>：如果授权成功，</span><span lang=EN-US>django</span><span
style='font-family:宋体'>会把这个授权方式保存到</span><span lang=EN-US>session</span><span
style='font-family:宋体'>里，</span><span lang=EN-US>session</span><span
style='font-family:宋体'>周期里的下一次接入还是用这种方式。如果要强迫用不同方法授权，一个简单的方法是调用</span><span
lang=EN-US>Session.objects.all().delete().</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>Settings.py</span></i></p>

<p class=code><span lang=EN-US>AUTHENTICATION_BACKENDS </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:gray'>'personalcenter.backends.auth.<span style='background:lime'>WechatBackend'</span></span><b><span
lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:gray'>'django.contrib.auth.backends.ModelBackend'</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>AUTH_USER_MODEL </span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US> </span><span lang=EN-US
style='color:gray'>'personalcenter.MyUser'</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>实现</span><span
lang=EN-US>authentication backend</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>必须实现的方法</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:gray'>get_user(user_id)</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:gray'>authenticate(request, **credentials)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体;color:red'>不知道为什么？</span><span
lang=EN-US style='color:red'>username</span><span style='font-family:宋体;
color:red'>登录时的</span><span lang=EN-US style='color:red'>request.user</span><span
style='font-family:宋体;color:red'>是有值的，但是</span><span lang=EN-US
style='color:red'>wechat</span><span style='font-family:宋体;color:red'>登录永远是</span><span
lang=EN-US style='color:red'>anonymous</span><span style='font-family:宋体;
color:red'>，这个从一开始的</span><span lang=EN-US style='color:red'>render</span><span
style='font-family:宋体;color:red'>就开始了</span></p>

<p class=MsoNormal><span lang=EN-US style='color:red'>_cached_user</span><span
style='font-family:宋体;color:red'>为</span><span lang=EN-US style='color:red'>AnonymousUser:
AnonymousUser</span></p>

<p class=MsoNormal><span lang=EN-US>&gt;&gt;</span><span style='font-family:
宋体'>问题查清楚了，下面这个</span><span lang=EN-US>wechat auth backend</span><span
style='font-family:宋体'>函数没写好，之前返回</span><span lang=EN-US>None</span><span
style='font-family:宋体'>，这个函数在</span><span lang=EN-US>eclipse</span><span
style='font-family:宋体'>上打断点也进不去不知道为什么</span></p>

<p class=MsoNormal><span lang=EN-US>&gt;&gt;</span><span style='font-family:
宋体'>好像也不是这个问题，突然就好了</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>personalcenter.auth.py</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
<a name="OLE_LINK221"></a><a name="OLE_LINK220">WechatBackend</a></span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>object</span><span
lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>get_user</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>self</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> user_id</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>try</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>return</span><span lang=EN-US>
UserModel</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>objects</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>get</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>pk</span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US>user_id</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>except</span><span lang=EN-US> UserModel</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>DoesNotExist</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>return</span><span lang=EN-US> </span><span
lang=EN-US style='color:blue'>None</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>def</span></b><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>authenticate</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>self</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><a name="OLE_LINK227"></a><a name="OLE_LINK226"><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
obj </span></a><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US style='color:red'>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>try</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> WechatUserProfile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>objects</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>openid </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'openid'</span><b><span lang=EN-US
style='color:navy'>])</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
profile</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
obj </span><b><span lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>user</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US>
WechatUserProfile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>DoesNotExist</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> WechatUserProfile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>objects</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>create</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> openid </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US style='color:gray'>'openid'</span><b><span
lang=EN-US style='color:navy'>])</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>unionid </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'unionid'</span><b><span lang=EN-US
style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>city </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'city'</span><b><span lang=EN-US
style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>country </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'country'</span><b><span lang=EN-US
style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>language </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'language'</span><b><span lang=EN-US
style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:red'>1</span><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>==</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US style='color:gray'>'sex'</span><b><span
lang=EN-US style='color:navy'>]:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>sex </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>'male'</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>else</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>sex </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>'female'</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>nickname </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'nickname'</span><b><span lang=EN-US
style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>headimgurl </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'headimgurl'</span><b><span lang=EN-US
style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
profile</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>save</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US style='color:gray'>'<span style='background:lime'>wechat_id</span>'</span><b><span
lang=EN-US style='color:navy'>]</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> profile</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>id</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> obj</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US> obj</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>wechat_id</span><span
style='font-family:宋体'>的保存方法</span></h3>

<p class=MsoNormal><span lang=EN-US>Workaround</span><span style='font-family:
宋体'>方法</span> <span lang=EN-US>C </span><span style='font-family:宋体;color:red'>可能已解决</span><span
lang=EN-US style='color:red'>user</span><span style='font-family:宋体;color:red'>为空的情况</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
openidmiddleware</span><span lang=EN-US style='color:navy'>():</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>def</span><span lang=EN-US> </span><span
lang=EN-US style='color:fuchsia'>process_request</span><span lang=EN-US
style='color:navy'>(</span><span lang=EN-US>self</span><span lang=EN-US
style='color:navy'>,</span><span lang=EN-US> request</span><span lang=EN-US
style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wechat_id
</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US> request</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>session</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>get</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US style='color:gray'>&quot;wechat_id&quot;</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>if</span><span lang=EN-US> wechat_id</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UserModel
</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
get_user_model</span><span lang=EN-US style='color:navy'>()</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>try</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
request</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>user
</span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US> UserModel</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>objects</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>get</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>pk</span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US>wechat_id</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>except</span><span lang=EN-US>&nbsp; UserModel</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>DoesNotExist</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>pass</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
WechatBackend</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>object</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><a name="OLE_LINK229"></a><a
name="OLE_LINK228"><span lang=EN-US style='color:fuchsia'>authenticate</span></a><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>self</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> request</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> code</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> app_id</span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US style='color:blue'>None</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> app_secret</span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US style='color:blue'>None</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> redirect_uri</span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US style='color:blue'>None</span><span
lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>session</span><span
lang=EN-US style='color:navy'>[</span><span lang=EN-US style='color:gray'>'wechat_id'</span><span
lang=EN-US style='color:navy'>]</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> obj</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>id</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>return</span><span lang=EN-US> </span><span
lang=EN-US style='color:blue'>None</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>绑定</span><span
lang=EN-US>WechatUser</span><span style='font-family:宋体'>和</span><span
lang=EN-US>User</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>personalcenter.urls</span></p>

<p class=codewithbg><span lang=EN-US>urlpatterns <b><span style='color:navy'>=</span></b>
<b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^linktowechat$'</span><b><span
style='color:navy'>,</span></b> accountlinktowechat<b><span style='color:navy'>,</span></b>
name<b><span style='color:navy'>=</span></b><span style='color:gray'>'link_to_wechat'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US style='color:black'> </span><span lang=EN-US>accountlinktowechat<b><span
style='color:navy'>(</span></b><span style='color:black'>request</span><b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> auth</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get_user</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>request</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
wechat_id </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> request</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>session</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>&quot;wechat_id&quot;</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
wechat </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US style='color:black'>
wechat_id</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>try</span><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
wechat </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> <a name="OLE_LINK223"></a><a name="OLE_LINK222">WechatUserProfile</a></span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>objects</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>pk</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US style='color:black'>wechat_id</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<b>wechat</b></span><b><span lang=EN-US style='color:navy'>.</span></b><b><span
lang=EN-US style='color:black'>user </span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US style='color:black'> user</span></b><span lang=EN-US
style='color:black'> </span><span lang=EN-US style='color:#00B050'>#</span><span
style='font-family:宋体;color:#00B050'>这儿将</span><span lang=EN-US
style='color:#00B050'>WechatUser</span><span style='font-family:宋体;color:#00B050'>和</span><span
lang=EN-US style='color:#00B050'>User</span><span style='font-family:宋体;
color:#00B050'>绑定起来</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
wechat</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>save</span><b><span lang=EN-US style='color:
navy'>()</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US style='color:black'> redirect</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:black'>reverse</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>&quot;home&quot;</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
kwargs</span><b><span lang=EN-US style='color:navy'>={}))</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>except</span><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>pass</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US
style='color:black'> redirect</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>reverse</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>&quot;home&quot;</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
kwargs</span><b><span lang=EN-US style='color:navy'>={}))</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>激活成功后绑定当前微信用户</span></h4>

<p class=MsoNormal><span lang=EN-US>templates.registration.activation_complete.html</span></p>

<p class=codewithbg><span lang=EN-US>{% block content %}</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;p</span><span
lang=EN-US> <span style='color:red'>class</span> = <span style='color:#8000FF'>&quot;lead&quot;</span><span
style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% trans &quot;Your
account is now activated.&quot; %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% if not
user.is_authenticated %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp; {% trans
&quot;You can log in.&quot; %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% else %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &nbsp; <span
style='color:blue'>&lt;a</span> <span style='color:red'>href</span>=<span
style='color:#8000FF'>'{% url &quot;link_to_wechat&quot; %}'</span><span
style='color:blue'>&gt;</span>Link to wechat<span style='color:blue'>&lt;/a&gt;</span>
</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% endif %}</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;/p&gt;</span></p>

<p class=codewithbg><span lang=EN-US>{% endblock %}</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span style='font-family:宋体'>微信登录后绑定当前登录用户</span></h4>

<p class=MsoNormal><span lang=EN-US>request middleware</span><span
style='font-family:宋体'>里面把</span><span lang=EN-US>wechat</span><span
style='font-family:宋体'>信息添加进去，这样在</span><span lang=EN-US>template</span><span
style='font-family:宋体'>里面能判断微信用户和普通用户是否已绑定</span></p>

<p class=MsoNormal><span style='font-family:宋体'>这儿额外在</span><span lang=EN-US>request</span><span
style='font-family:宋体'>里面加了一个变量</span><span lang=EN-US>wechat</span><span
style='font-family:宋体'>，否则就要给</span><span lang=EN-US>registration</span><span
style='font-family:宋体'>添加额外的</span><span lang=EN-US>context (</span><span
style='font-family:宋体'>第三方库</span><span lang=EN-US>)</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> django<b><span style='color:navy'>.</span></b>contrib<b><span
style='color:navy'>.</span></b>auth <b><span style='color:blue'>import</span></b>
get_user_model</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> personalcenter<b><span style='color:navy'>.</span></b>models <b><span
style='color:blue'>import</span></b> WechatUserProfile</span></p>

<p class=codewithbg><span lang=EN-US>UserModel <b><span style='color:navy'>=</span></b>
get_user_model<b><span style='color:navy'>()</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>openidmiddleware<span style='color:navy'>():</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>def</span></b> <span style='color:fuchsia'>process_request</span><b><span
style='color:navy'>(</span></b>self<b><span style='color:navy'>,</span></b>
request<b><span style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>if</span></b> request<b><span style='color:navy'>.</span></b>user<b><span
style='color:navy'>.</span></b>is_anonymous<b><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wechat_id
<b><span style='color:navy'>=</span></b> request<b><span style='color:navy'>.</span></b>session<b><span
style='color:navy'>.</span></b>get<b><span style='color:navy'>(</span></b><span
style='color:gray'>&quot;wechat_id&quot;</span><b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>if</span></b> wechat_id<b><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>try</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; request<b><span
style='color:navy'>.</span></b>wechat <b><span style='color:navy'>=</span></b>
WechatUserProfile<b><span style='color:navy'>.</span></b>objects<b><span
style='color:navy'>.</span></b>get<b><span style='color:navy'>(</span></b>pk<b><span
style='color:navy'>=</span></b>wechat_id<b><span style='color:navy'>)</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>except</span><span style='color:navy'>:</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><span
style='color:blue'>pass</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>如果当前</span><span lang=EN-US>WechatUser</span><span
style='font-family:宋体'>指定并没有绑定</span><span lang=EN-US>User</span><span
style='font-family:宋体'>，则提示绑定</span></p>

<p class=MsoNormal><a name="OLE_LINK225"></a><a name="OLE_LINK224"><span
lang=EN-US>templates.registration.login.html</span></a></p>

<p class=codewithbg><span lang=EN-US>{% if request.user.is_anonymous and <span
style='background:yellow'>request.wechat</span> %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; You need to login to
continue</span></p>

<p class=codewithbg><span lang=EN-US>{% endif %}</span></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;form</span><span
lang=EN-US style='color:black'> </span><span lang=EN-US>method<span
style='color:black'>=</span><b><span style='color:#8000FF'>&quot;post&quot;</span></b><span
style='color:black'> </span>action<span style='color:black'>=</span><b><span
style='color:#8000FF'>&quot;&quot;</span></b><span style='color:blue'>&gt;</span></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
{% csrf_token %}</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
{{ form|crispy }}</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span></b><span
lang=EN-US style='color:blue'>&lt;input</span><span lang=EN-US
style='color:black'> </span><span lang=EN-US>class<span style='color:black'> = </span><b><span
style='color:#8000FF'>&quot;btn btn-block btn-primary&quot;</span></b><span
style='color:black'> </span>type<span style='color:black'>=</span><b><span
style='color:#8000FF'>&quot;submit&quot;</span></b><span style='color:black'> </span>value<span
style='color:black'>=</span><b><span style='color:#8000FF'>&quot;{% trans 'Log
in' %}&quot;</span></b><span style='color:black'> </span><span
style='color:blue'>/&gt;</span></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
{% if request.user.is_anonymous and request.wechat %}</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></b><span lang=EN-US style='color:blue'>&lt;input</span><span
lang=EN-US style='color:black'> </span><span lang=EN-US>type<span
style='color:black'>=</span><b><span style='color:#8000FF'>&quot;hidden&quot;</span></b><span
style='color:black'> </span>name<span style='color:black'>=</span><b><span
style='color:#8000FF'>&quot;next&quot;</span></b><span style='color:black'> </span>value<span
style='color:black'>=</span><b><span style='color:#8000FF'>&quot;{% url
'link_to_wechat' %}&quot;</span></b><span style='color:black'> </span><span
style='color:blue'>/&gt; </span><span style='color:#00B050'>&lt;!-- workaround
here, maybe we need to change it in login function later--&gt;</span></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
{% else %}</span></b></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></b><span lang=EN-US style='color:blue'>&lt;input</span><span
lang=EN-US style='color:black'> </span><span lang=EN-US>type<span
style='color:black'>=</span><b><span style='color:#8000FF'>&quot;hidden&quot;</span></b><span
style='color:black'> </span>name<span style='color:black'>=</span><b><span
style='color:#8000FF'>&quot;next&quot;</span></b><span style='color:black'> </span>value<span
style='color:black'>=</span><b><span style='color:#8000FF'>&quot;{{ next
}}&quot;</span></b><span style='color:black'> </span><span style='color:blue'>/&gt;</span><b><span
style='color:black'> </span></b></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
{% endif %}</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:blue'>&lt;/form&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>解绑</span><span
lang=EN-US>WechatUser</span><span style='font-family:宋体'>和</span><span
lang=EN-US>User</span></h3>

<p class=MsoNormal><span lang=EN-US>personalcenter.urls</span></p>

<p class=codewithbg><span lang=EN-US>urlpatterns <b><span style='color:navy'>=</span></b>
<b><span style='color:navy'>[</span></b></span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; url<b><span
style='color:navy'>(</span></b><span style='color:gray'>r'^unlinkfromwechat$'</span><b><span
style='color:navy'>,</span></b> account_unlink_from_wechat<b><span
style='color:navy'>,</span></b> name<b><span style='color:navy'>=</span></b><span
style='color:gray'>'<a name="OLE_LINK7"></a><a name="OLE_LINK6">unlink_from_wechat</a>'</span><b><span
style='color:navy'>),</span></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US style='color:black'> </span><span lang=EN-US>account_unlink_from_wechat<b><span
style='color:navy'>(</span></b><span style='color:black'>request</span><b><span
style='color:navy'>):</span></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
wechat_id </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> request</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>session</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>&quot;wechat_id&quot;</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;
wechat </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US style='color:black'>
wechat_id</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>try</span><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
wechat </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:black'> WechatUserProfile</span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US style='color:black'>objects</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US style='color:black'>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:black'>pk</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US style='color:black'>wechat_id</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
wechat</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>user </span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US style='color:black'> </span><b><span
lang=EN-US style='color:blue'>None</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
wechat</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US style='color:black'>save</span><b><span lang=EN-US style='color:
navy'>()</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>except</span><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>pass</span></b></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:black'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US
style='color:black'> redirect</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:black'>reverse</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>&quot;home&quot;</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US style='color:black'>
kwargs</span><b><span lang=EN-US style='color:navy'>={}))</span></b><span
lang=EN-US style='color:black'> </span><span lang=EN-US style='color:green'>#
to change to ajax</span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>django</span><span
style='font-family:宋体'>实现</span></h3>

<h4><span lang=EN-US style='background:white'>authenticate</span></h4>

<p class=MsoNormal><span style='font-family:宋体'>下面分析</span><span lang=EN-US>django</span><span
style='font-family:宋体'>是如何实现</span><span lang=EN-US>authentication</span><span
style='font-family:宋体'>的</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:fuchsia;background:white'>authenticate</span><span style='font-family:
宋体'>会直接调用这个函数</span></p>

<p class=MsoNormal><span lang=EN-US>django.contrib.auth.__init__</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>authenticate</span><b><span
lang=EN-US style='color:navy'>(**</span></b><span lang=EN-US>credentials</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; If the
given credentials are valid, return a User object.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>for</span></b><span lang=EN-US> backend</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> backend_path </span><b><span
lang=EN-US style='color:blue'>in</span></b><span lang=EN-US> _get_backends</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>return_tuples</span><b><span
lang=EN-US style='color:navy'>=</span></b><b><span lang=EN-US style='color:
blue'>True</span></b><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>try</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>inspect</span></span><b><span lang=EN-US
style='color:navy;background:lime'>.</span></b><span lang=EN-US
style='background:lime'>getcallargs</span><b><span lang=EN-US style='color:
navy;background:lime'>(</span></b><span lang=EN-US style='background:lime'>backend</span><b><span
lang=EN-US style='color:navy;background:lime'>.</span></b><span lang=EN-US
style='background:lime'>authenticate</span><b><span lang=EN-US
style='color:navy;background:lime'>,</span></b><span lang=EN-US
style='background:lime'> </span><b><span lang=EN-US style='color:navy;
background:lime'>**</span></b><span lang=EN-US style='background:lime'>credentials</span><b><span
lang=EN-US style='color:navy;background:lime'>) </span></b><span lang=EN-US
style='color:green;background:yellow'># </span><span style='font-family:宋体;
color:green;background:yellow'>遍历</span><span lang=EN-US style='color:green;
background:yellow'>backend</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US> TypeError</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># This backend doesn't accept these
credentials as arguments. Try the next one.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>continue</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>try</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:lime'>user </span></span><b><span lang=EN-US
style='color:navy;background:lime'>=</span></b><span lang=EN-US
style='background:lime'> backend</span><b><span lang=EN-US style='color:navy;
background:lime'>.</span></b><span lang=EN-US style='background:lime'>authenticate</span><b><span
lang=EN-US style='color:navy;background:lime'>(**</span></b><span lang=EN-US
style='background:lime'>credentials</span><b><span lang=EN-US style='color:
navy;background:lime'>)</span></b><span lang=EN-US style='color:green'> <span
style='background:yellow'># </span></span><span style='font-family:宋体;
color:green;background:yellow'>调用</span><span lang=EN-US style='color:green;
background:yellow'>backend</span><span style='font-family:宋体;color:green;
background:yellow'>的</span><span lang=EN-US style='color:green;background:yellow'>authenticate</span><span
style='font-family:宋体;color:green;background:yellow'>函数</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US>
PermissionDenied</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># This backend says to stop in our
tracks - this user should not be allowed in at all.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US> user </span><b><span
lang=EN-US style='color:blue'>is</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>None</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>continue</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><a
name="OLE_LINK3"><span lang=EN-US style='color:green'># Annotate the u</span></a><span
lang=EN-US style='color:green'>ser object with the path of the backend.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>backend </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> backend_path</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US> user</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:green'># The credentials supplied are invalid to all backends,
fire signal</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; user_login_failed</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>send</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>sender</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>__name__</span><b><span
lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
credentials</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>_clean_credentials</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>credentials</span><b><span lang=EN-US style='color:navy'>))</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>demo</span><span style='font-family:宋体'>代码里</span><span
lang=EN-US>backend</span><span style='font-family:宋体'>的</span><span lang=EN-US>authenticate</span><span
style='font-family:宋体'>的参数包含</span><span lang=EN-US>request</span><span
style='font-family:宋体'>，调用</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:white'>authenticate</span><span
style='font-family:宋体'>时，必须</span><span lang=EN-US>request<span
style='color:red'>=request</span>, </span><span style='font-family:宋体'>否则</span><span
lang=EN-US>django.contrib.auth.__init__</span><span style='font-family:宋体'>的</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:fuchsia;
background:white'>authenticate</span><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:navy;background:white'>(**</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black;
background:white'>credentials</span><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:navy;background:white'>)</span></b><span
style='font-family:宋体'>函数在</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:yellow'>getcallargs</span><span
style='font-family:宋体'>这一步会出错，因为</span><span lang=EN-US>request</span><span
style='font-family:宋体'>这个参数不能传进</span><b><span lang=EN-US style='font-size:
10.0pt;font-family:"Courier New";color:navy;background:white'>**</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black;
background:white'>credentials</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/topics/auth/customizing/#writing-an-authentication-backend">https://docs.djangoproject.com/en/dev/topics/auth/customizing/#writing-an-authentication-backend</a></span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://docs.python.org/2/tutorial/controlflow.html#keyword-arguments">Keyword
Arguments</a></span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:21.0pt;text-indent:-21.0pt'><span
class=MsoHyperlink><span lang=EN-US style='font-family:Wingdings;text-decoration:
none'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><span
lang=EN-US><a href="http://blog.csdn.net/anhuidelinger/article/details/10011013">python
<span lang=EN-US style='font-family:宋体'><span lang=EN-US>中参数</span></span>*args,
**kwargs</a></span></p>

<p class=MsoNormal><i><span lang=EN-US>&nbsp;</span></i></p>

<p class=MsoNormal><span style='font-family:宋体'>网上例子的练习，实际并没有用</span></p>

<p class=MsoNormal><i><span lang=EN-US>Auth.py (personalcenter\backends)</span></i></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
SettingsBackend</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>object</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>authenticate</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>self</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:red'>request</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US> username</span><b><span
lang=EN-US style='color:navy'>=</span></b><b><span lang=EN-US style='color:
blue'>None</span></b><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> password</span><b><span lang=EN-US style='color:navy'>=</span></b><b><span
lang=EN-US style='color:blue'>None</span></b><b><span lang=EN-US
style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
login_valid </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>settings</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>ADMIN_LOGIN </span><b><span lang=EN-US style='color:navy'>==</span></b><span
lang=EN-US> username</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
pwd_valid </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> check_password</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>password</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> settings</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>ADMIN_PASSWORD</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US> login_valid </span><b><span
lang=EN-US style='color:blue'>and</span></b><span lang=EN-US> pwd_valid</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>try</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> User</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>objects</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>username</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>username</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>except</span></b><span
lang=EN-US> User</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>DoesNotExist</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Create a new user. There's no
need to set a password</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># because only the password from
settings.py is checked.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> User</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>username</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>username</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>is_staff
</span><b><span lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>True</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>is_superuser
</span><b><span lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>True</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>save</span><b><span
lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> user</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>def</span></b><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>get_user</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>self</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> user_id</span><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>try</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> User</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>objects</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>pk</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>user_id</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US> User</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>DoesNotExist</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/topics/auth/default/#how-to-log-a-user-in">https://docs.djangoproject.com/en/dev/topics/auth/default/#how-to-log-a-user-in</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> django</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>contrib</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>auth </span><b><span lang=EN-US style='color:blue'>import</span></b><span
lang=EN-US> authenticate</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> login</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>my_view</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; username </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>POST</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US style='color:gray'>'username'</span><b><span
lang=EN-US style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; password </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>POST</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US style='color:gray'>'password'</span><b><span
lang=EN-US style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; user </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> authenticate</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>reques</span><span
lang=EN-US style='color:red'>t= request</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US> username</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>username</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> password</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>password</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> user </span><b><span
lang=EN-US style='color:blue'>is</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>not</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>None</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; login</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># Redirect to a success page.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:navy'>...</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>else</span></b><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># Return an 'invalid login' error message.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:navy'>...</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>django.contrib.auth.backends.py</span></i></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
ModelBackend</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>object</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
Authenticates against settings.AUTH_USER_MODEL.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>authenticate</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>self</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> username</span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US style='color:blue'>None</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> password</span><span lang=EN-US style='color:navy'>=</span><span
lang=EN-US style='color:blue'>None</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> </span><span lang=EN-US style='color:navy'>**</span><span
lang=EN-US>kwargs</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
UserModel </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
get_user_model</span><span lang=EN-US style='color:navy'>()</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>if</span><span lang=EN-US> username </span><span
lang=EN-US style='color:blue'>is</span><span lang=EN-US> </span><span
lang=EN-US style='color:blue'>None</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
username </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
kwargs</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>get</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>UserModel</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>USERNAME_FIELD</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>try</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
UserModel</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>_default_manager</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>get_by_natural_key</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>username</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>if</span><span lang=EN-US> user</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>check_password</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>password</span><span
lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>return</span><span lang=EN-US> user</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>except</span><span lang=EN-US> UserModel</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>DoesNotExist</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Run the default password hasher
once to reduce the timing</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># difference between an existing
and a non-existing user (#20760).</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
UserModel</span><span lang=EN-US style='color:navy'>().</span><span lang=EN-US>set_password</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>password</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span lang=EN-US>login</span></h4>

<p class=MsoNormal><i><span lang=EN-US>__init__.py (site-packages\django\contrib\auth)</span></i></p>

<p class=code><span lang=EN-US>SESSION_KEY </span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US> '_auth_user_id'</span></p>

<p class=code><span lang=EN-US>BACKEND_SESSION_KEY </span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US> '_auth_user_backend'</span></p>

<p class=code><span lang=EN-US>HASH_SESSION_KEY </span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US> '_auth_user_hash'</span></p>

<p class=code><span lang=EN-US>REDIRECT_FIELD_NAME </span><b><span lang=EN-US
style='color:navy'>=</span></b><span lang=EN-US> 'next'</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>login</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; Persist
a user id and a backend in the request. This way a user doesn't</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; have to
reauthenticate on every request. Note that data set during</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; the
anonymous session is retained when the user logs in.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; session_auth_hash </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> ''</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> user </span><b><span
lang=EN-US style='color:blue'>is</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>None</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>user</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> hasattr</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>user</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US>
'get_session_auth_hash'</span><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
session_auth_hash </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_session_auth_hash</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> SESSION_KEY </span><b><span
lang=EN-US style='color:blue'>in</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>session</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
_get_user_session_key</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:navy'>!=</span></b><span
lang=EN-US> user</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>pk </span><b><span lang=EN-US style='color:blue'>or</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
session_auth_hash </span><b><span lang=EN-US style='color:blue'>and</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>HASH_SESSION_KEY</span><b><span lang=EN-US style='color:navy'>)</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:navy'>!=</span></b><span
lang=EN-US> session_auth_hash</span><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># To avoid reusing another user's
session, create a new, empty</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># session if the existing session
corresponds to a different</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># authenticated user.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>flush</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>else</span></b><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>cycle_key</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US style='color:green'>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:green'># </span><span
style='font-family:宋体;color:green'>正常用户登录时，会保存这个用户</span><span lang=EN-US
style='color:green'>session</span><span style='font-family:宋体;color:green'>，这样在</span><span
lang=EN-US style='color:green'>response</span><span style='font-family:宋体;
color:green'>的消息里的</span><span lang=EN-US style='color:green'>request</span><span
style='font-family:宋体;color:green'>里面会带出去</span><span lang=EN-US
style='color:green'>user</span><span style='font-family:宋体;color:green'>信息</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='background:yellow'>request</span></span><b><span
lang=EN-US style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='background:yellow'>session</span><b><span lang=EN-US style='color:navy;
background:yellow'>[</span></b><span lang=EN-US style='background:yellow'>SESSION_KEY</span><b><span
lang=EN-US style='color:navy;background:yellow'>]</span></b><span lang=EN-US
style='background:yellow'> </span><b><span lang=EN-US style='color:navy;
background:yellow'>=</span></b><span lang=EN-US style='background:yellow'> user</span><b><span
lang=EN-US style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='background:yellow'>_meta</span><b><span lang=EN-US style='color:navy;
background:yellow'>.</span></b><span lang=EN-US style='background:yellow'>pk</span><b><span
lang=EN-US style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='background:yellow'>value_to_string</span><b><span lang=EN-US
style='color:navy;background:yellow'>(</span></b><span lang=EN-US
style='background:yellow'>user</span><b><span lang=EN-US style='color:navy;
background:yellow'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>session</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US>BACKEND_SESSION_KEY</span><b><span
lang=EN-US style='color:navy'>]</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>backend</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>session</span><b><span
lang=EN-US style='color:navy'>[</span></b><span lang=EN-US>HASH_SESSION_KEY</span><b><span
lang=EN-US style='color:navy'>]</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> session_auth_hash</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> hasattr</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>'user'</span><b><span lang=EN-US
style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='background:yellow'>request</span></span><b><span lang=EN-US
style='color:navy;background:yellow'>.</span></b><span lang=EN-US
style='background:yellow'>user </span><b><span lang=EN-US style='color:navy;
background:yellow'>=</span></b><span lang=EN-US style='background:yellow'> user</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; rotate_token</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; user_logged_in</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>send</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>sender</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>user</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__class__</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>user</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='background:#DAEEF3;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>{{user}}</span></p>

<p class=MsoNormal style='background:#DAEEF3;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>{{request.user}}</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>这两个</span><span lang=EN-US>user</span><span
style='font-family:宋体'>分别是由下面的</span><span lang=EN-US>middleware</span><span
style='font-family:宋体'>传进来的</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
'django.template.context_processors.request',</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
'django.contrib.auth.context_processors.auth',</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span lang=EN-US>get_user</span></h4>

<p class=MsoNormal><i><span lang=EN-US>django/contrib/auth/__init__</span></i></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>get_user</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; Returns
the user model instance associated with the given request session.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; If no
user is retrieved an instance of `AnonymousUser` is returned.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>from</span></b><span lang=EN-US> </span><b><span lang=EN-US
style='color:navy'>.</span></b><span lang=EN-US>models </span><b><span
lang=EN-US style='color:blue'>import</span></b><span lang=EN-US> AnonymousUser</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; user </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>try</span></b><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user_id </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> _get_user_session_key</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
backend_path </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>[</span></b><span
lang=EN-US>BACKEND_SESSION_KEY</span><b><span lang=EN-US style='color:navy'>]</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>except</span></b><span lang=EN-US> KeyError</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>pass</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>else</span></b><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>if</span></b><span lang=EN-US> backend_path </span><b><span
lang=EN-US style='color:blue'>in</span></b><span lang=EN-US> settings</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>AUTHENTICATION_BACKENDS</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
backend </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> load_backend</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>backend_path</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> backend</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_user</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>user_id</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Verify the session</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>in</span></b><span lang=EN-US>
settings</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>MIDDLEWARE_CLASSES </span><b><span lang=EN-US style='color:blue'>and</span></b><span
lang=EN-US> hasattr</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>user</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>'get_session_auth_hash'</span><b><span
lang=EN-US style='color:navy'>)):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
session_hash </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>HASH_SESSION_KEY</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
session_hash_verified </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> session_hash </span><b><span lang=EN-US style='color:blue'>and</span></b><span
lang=EN-US> constant_time_compare</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
session_hash</span><b><span lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>get_session_auth_hash</span><b><span
lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>not</span></b><span lang=EN-US>
session_hash_verified</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>session</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>flush</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>return</span></b><span lang=EN-US> user </span><b><span
lang=EN-US style='color:blue'>or</span></b><span lang=EN-US> AnonymousUser</span><b><span
lang=EN-US style='color:navy'>()</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>django/contrib/auth/backends.py</span></i></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
ModelBackend</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>object</span><span lang=EN-US style='color:navy'>):</span><span
lang=EN-US>&nbsp;&nbsp;&nbsp; </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>get_user</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>self</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> user_id</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
UserModel </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US>
get_user_model</span><span lang=EN-US style='color:navy'>()</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>try</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>return</span><span lang=EN-US>
UserModel</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>_default_manager</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>get</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>pk</span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US>user_id</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>except</span><span lang=EN-US> UserModel</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>DoesNotExist</span><span
lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>return</span><span lang=EN-US> </span><span
lang=EN-US style='color:blue'>None</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>django/contrib/auth/forms.py</span></i></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
AuthenticationForm</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>forms</span><span lang=EN-US style='color:navy'>.</span><span
lang=EN-US>Form</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>get_user</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>self</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>return</span><span lang=EN-US> self</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>user_cache</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>django/contrib/auth/middleware.py</span></i></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>get_user</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> </span><b><span lang=EN-US
style='color:blue'>not</span></b><span lang=EN-US> hasattr</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>'_cached_user'</span><b><span lang=EN-US
style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_cached_user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> auth</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_user</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>return</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>_cached_user</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='background:lime'>_cached_user</span><span
lang=EN-US style='color:red'> when will it be used?</span></p>

<h4><span lang=EN-US>auth</span></h4>

<p class=MsoNormal><i><span lang=EN-US>django.contrib.auth.context_processors.auth</span></i></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>def</span></b><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>auth</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:#FF8000'>&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; Returns
context variables required by apps that use Django's authentication</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; system.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp; If
there is no 'user' attribute in the request, uses AnonymousUser (from</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
django.contrib.auth).</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> hasattr</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>'user'</span><b><span lang=EN-US
style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>user</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>else</span></b><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>from</span></b><span lang=EN-US> django</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>contrib</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>auth</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>models </span><b><span
lang=EN-US style='color:blue'>import</span></b><span lang=EN-US> AnonymousUser</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> AnonymousUser</span><b><span
lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>return</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>{</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:gray'>'user'</span><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> user</span><b><span
lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:gray'>'perms'</span><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> PermWrapper</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>user</span><b><span
lang=EN-US style='color:navy'>),</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:navy'>}</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span lang=EN-US>middleware</span></h4>

<p class=MsoNormal><i><span lang=EN-US>Middleware.py
(site-packages\django\contrib\auth</span></i></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:fuchsia'>get_user</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>if</span></b><span lang=EN-US> </span><b><span lang=EN-US
style='color:blue'>not</span></b><span lang=EN-US> hasattr</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>'_cached_user'</span><b><span lang=EN-US
style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_cached_user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> auth</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_user</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_cached_user</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>class</span></b><span
lang=EN-US> <b>AuthenticationMiddleware</b></span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US>object</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>def</span></b><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>process_request</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US>self</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>assert</span></b><span lang=EN-US> hasattr</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:gray'>'session'</span><b><span lang=EN-US
style='color:navy'>),</span></b><span lang=EN-US> </span><b><span lang=EN-US
style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;The Django authentication
middleware requires session middleware &quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;to be installed. Edit your
MIDDLEWARE_CLASSES setting to insert &quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;'django.contrib.sessions.middleware.SessionMiddleware'
before &quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;'django.contrib.auth.middleware.AuthenticationMiddleware'.&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>user </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> SimpleLazyObject</span><b><span lang=EN-US style='color:navy'>(</span></b><b><span
lang=EN-US style='color:blue'>lambda</span></b><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> <span style='background:aqua'>get_user</span></span><b><span
lang=EN-US style='color:navy;background:aqua'>(</span></b><span lang=EN-US
style='background:aqua'>request</span><b><span lang=EN-US style='color:navy;
background:aqua'>)</span></b><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black;background:white'>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
ThreadingMixIn</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:#FF8000'>&quot;&quot;&quot;Mix-in class to handle each request in
a new thread.&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:green'># Decides how threads will act upon termination of the</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:green'># main process</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; daemon_threads </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> </span><span
lang=EN-US style='color:blue'>False</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>process_request_thread</span><span lang=EN-US
style='color:navy'>(</span><span lang=EN-US>self</span><span lang=EN-US
style='color:navy'>,</span><span lang=EN-US> request</span><span lang=EN-US
style='color:navy'>,</span><span lang=EN-US> client_address</span><span
lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:#FF8000'>&quot;&quot;&quot;Same as in BaseServer but as
a thread.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
In addition, exception handling is done here.</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:#FF8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>try</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US
style='background:yellow'>finish_request</span><span lang=EN-US
style='color:navy'>(</span><span lang=EN-US>request</span><span lang=EN-US
style='color:navy'>,</span><span lang=EN-US> client_address</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>shutdown_request</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>request</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>except</span><span lang=EN-US style='color:navy'>:</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>handle_error</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>request</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> client_address</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self</span><span lang=EN-US style='color:navy'>.</span><span lang=EN-US>shutdown_request</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>request</span><span
lang=EN-US style='color:navy'>)</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>def</span><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>process_request</span><span lang=EN-US style='color:navy'>(</span><span
lang=EN-US>self</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> request</span><span lang=EN-US style='color:navy'>,</span><span
lang=EN-US> client_address</span><span lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:#FF8000'>&quot;&quot;&quot;Start a new thread to
process the request.&quot;&quot;&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> threading</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>Thread</span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>target </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> self</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>process_request_thread</span><span
lang=EN-US style='color:navy'>,</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
args </span><span lang=EN-US style='color:navy'>=</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>request</span><span
lang=EN-US style='color:navy'>,</span><span lang=EN-US> client_address</span><span
lang=EN-US style='color:navy'>))</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>daemon </span><span
lang=EN-US style='color:navy'>=</span><span lang=EN-US> self</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>daemon_threads</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t</span><span
lang=EN-US style='color:navy'>.</span><span lang=EN-US>start</span><span
lang=EN-US style='color:navy'>()</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US style='color:blue'>class</span><span lang=EN-US>
<a name="OLE_LINK5"></a><a name="OLE_LINK4">BaseHandler</a></span><span
lang=EN-US style='color:navy'>(</span><span lang=EN-US>object</span><span
lang=EN-US style='color:navy'>):</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>def</span></b><span lang=EN-US> </span><span lang=EN-US
style='color:fuchsia'>get_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>self</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> <span style='background:aqua'>request</span></span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&quot;Returns an HttpResponse object for the given HttpRequest&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># Setup default url resolver for this thread,
this code is outside</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># the try/except so we don't get a spurious
&quot;unbound local</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># variable&quot; exception in the event an exception
is raised before</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:green'># resolver is set</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
urlconf </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> settings</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>ROOT_URLCONF</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
urlresolvers</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>set_urlconf</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>urlconf</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
resolver </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> urlresolvers</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>RegexURLResolver</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>r'^/'</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> urlconf</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>try</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Apply request middleware</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>for</span></b><span lang=EN-US>
middleware_method </span><b><span lang=EN-US style='color:blue'>in</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_request_middleware</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> middleware_method</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='background:aqua'>request</span><b><span lang=EN-US
style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>break</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response </span><b><span lang=EN-US style='color:blue'>is</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
hasattr</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>'urlconf'</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Reset url resolver with a custom
urlconf.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
urlconf </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>urlconf</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
urlresolvers</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>set_urlconf</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>urlconf</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
resolver </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> urlresolvers</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>RegexURLResolver</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:gray'>r'^/'</span><b><span lang=EN-US style='color:
navy'>,</span></b><span lang=EN-US> urlconf</span><b><span lang=EN-US
style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
resolver_match </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> resolver</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>resolve</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>path_info</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
callback</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> callback_args</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> callback_kwargs </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> resolver_match</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>resolver_match </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> resolver_match</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Apply view middleware</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span
lang=EN-US style='color:blue'>for</span></b><span lang=EN-US> middleware_method
</span><b><span lang=EN-US style='color:blue'>in</span></b><span lang=EN-US>
self</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>_view_middleware</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> <span style='background:aqua'>middleware_method</span></span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> callback</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> callback_args</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> callback_kwargs</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>break</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response </span><b><span lang=EN-US style='color:blue'>is</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
wrapped_callback </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>make_view_atomic</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>callback</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>try</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response = <span style='background:aqua'>wrapped_callback</span>(request,
*callback_args, **callback_kwargs) <span style='background:aqua'># url</span></span><span
style='font-family:宋体;background:aqua'>对应链接</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>except</span></b><span
lang=EN-US> Exception </span><b><span lang=EN-US style='color:blue'>as</span></b><span
lang=EN-US> e</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># If the view raised an exception,
run it through exception</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># middleware, and if the exception
middleware returns a</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># response, use that. Otherwise,
reraise the exception.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>for</span></b><span lang=EN-US>
middleware_method </span><b><span lang=EN-US style='color:blue'>in</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_exception_middleware</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> middleware_method</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> e</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>break</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response </span><b><span lang=EN-US style='color:blue'>is</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>raise</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Complain if the view returned
None (a common error).</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response </span><b><span lang=EN-US style='color:blue'>is</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
isinstance</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>callback</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> types</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>FunctionType</span><b><span lang=EN-US style='color:navy'>):</span></b><span
lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US style='color:green'># FBV</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
view_name </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> callback</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>__name__</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>else</span></b><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;</span><span lang=EN-US style='color:green'># CBV</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
view_name </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> callback</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>__class__</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>__name__ </span><b><span lang=EN-US style='color:navy'>+</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>'.__call__'</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>raise</span></b><span lang=EN-US>
ValueError</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:gray'>&quot;The view %s.%s didn't return an
HttpResponse object. It returned None instead.&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>%</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>callback</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__module__</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> view_name</span><b><span
lang=EN-US style='color:navy'>))</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># If the response supports deferred
rendering, apply template</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># response middleware and then
render the response</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
hasattr</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>response</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:gray'>'render'</span><b><span
lang=EN-US style='color:navy'>)</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:blue'>and</span></b><span lang=EN-US> callable</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>response</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>render</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>for</span></b><span lang=EN-US>
middleware_method </span><b><span lang=EN-US style='color:blue'>in</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_template_response_middleware</span><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> middleware_method</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> response</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Complain if the template response
middleware returned None (a common error).</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response </span><b><span lang=EN-US style='color:blue'>is</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>raise</span></b><span lang=EN-US>
ValueError</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;%s.process_template_response
didn't return an &quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;HttpResponse object. It
returned None instead.&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>%</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>middleware_method</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__self__</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__class__</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__name__</span><b><span
lang=EN-US style='color:navy'>))</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> response</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>render</span><b><span lang=EN-US style='color:navy'>()</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US> http</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>Http404 </span><b><span
lang=EN-US style='color:blue'>as</span></b><span lang=EN-US> e</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
logger</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>warning</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:gray'>'Not Found: %s'</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>path</span><b><span
lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
extra</span><b><span lang=EN-US style='color:navy'>={</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'status_code'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:red'>404</span><b><span lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'request'</span><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> request</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>})</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
settings</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>DEBUG</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> debug</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>technical_404_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> e</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>else</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_exception_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> resolver</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:red'>404</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US>
PermissionDenied</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
logger</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>warning</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'Forbidden (Permission denied): %s'</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> request</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>path</span><b><span
lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
extra</span><b><span lang=EN-US style='color:navy'>={</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'status_code'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:red'>403</span><b><span lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'request'</span><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> request</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span lang=EN-US
style='color:navy'>})</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_exception_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> resolver</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:red'>403</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US>
MultiPartParserError</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
logger</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>warning</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'Bad request (Unable to parse
request body): %s'</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>path</span><b><span lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
extra</span><b><span lang=EN-US style='color:navy'>={</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'status_code'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:red'>400</span><b><span lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'request'</span><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> request</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>})</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_exception_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> resolver</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:red'>400</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US>
SuspiciousOperation </span><b><span lang=EN-US style='color:blue'>as</span></b><span
lang=EN-US> e</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># The request logger receives
events for any problematic request</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># The security logger receives
events for all SuspiciousOperations</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
security_logger </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> logging</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>getLogger</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US style='color:gray'>'django.security.%s'</span><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>%</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
e</span><b><span lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__class__</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__name__</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
security_logger</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>error</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
force_text</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>e</span><b><span lang=EN-US style='color:navy'>),</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
extra</span><b><span lang=EN-US style='color:navy'>={</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'status_code'</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US> </span><span
lang=EN-US style='color:red'>400</span><b><span lang=EN-US style='color:navy'>,</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>'request'</span><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US> request</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>})</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
settings</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>DEBUG</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>return</span></b><span
lang=EN-US> debug</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>technical_500_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:navy'>*</span></b><span
lang=EN-US>sys</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>exc_info</span><b><span lang=EN-US style='color:navy'>(),</span></b><span
lang=EN-US> status_code</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US style='color:red'>400</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>get_exception_response</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> resolver</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> </span><span lang=EN-US style='color:red'>400</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><span lang=EN-US> SystemExit</span><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Allow sys.exit() to actually
exit. See tickets #1023 and #4701</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>raise</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US>&nbsp; </span><span lang=EN-US
style='color:green'># Handle everything else.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Get the exception info now, in
case another exception is thrown later.</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
signals</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>got_request_exception</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>send</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>sender</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>__class__</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>handle_uncaught_exception</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> resolver</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> sys</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>exc_info</span><b><span
lang=EN-US style='color:navy'>())</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>try</span></b><b><span lang=EN-US
style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Apply response middleware,
regardless of the response</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>for</span></b><span lang=EN-US>
middleware_method </span><b><span lang=EN-US style='color:blue'>in</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_response_middleware</span><b><span lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> middleware_method</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> response</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:green'># Complain if the response
middleware returned None (a common error).</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>if</span></b><span lang=EN-US>
response </span><b><span lang=EN-US style='color:blue'>is</span></b><span
lang=EN-US> </span><b><span lang=EN-US style='color:blue'>None</span></b><b><span
lang=EN-US style='color:navy'>:</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:blue'>raise</span></b><span lang=EN-US>
ValueError</span><b><span lang=EN-US style='color:navy'>(</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:gray'>&quot;%s.process_response didn't
return an &quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US
style='color:gray'>&quot;HttpResponse object. It returned None instead.&quot;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:navy'>%</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>middleware_method</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__self__</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__class__</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>__name__</span><b><span
lang=EN-US style='color:navy'>))</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>apply_response_fixes</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> response</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>except</span></b><b><span lang=EN-US
style='color:navy'>:</span></b><span lang=EN-US>&nbsp; </span><span lang=EN-US
style='color:green'># Any exception should be gathered and handled</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
signals</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>got_request_exception</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>send</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>sender</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>__class__</span><b><span lang=EN-US style='color:navy'>,</span></b><span
lang=EN-US> request</span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response </span><b><span lang=EN-US style='color:navy'>=</span></b><span
lang=EN-US> self</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>handle_uncaught_exception</span><b><span lang=EN-US
style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> resolver</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> sys</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>exc_info</span><b><span
lang=EN-US style='color:navy'>())</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
response</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>_closable_objects</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>append</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>request</span><b><span lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:blue'>return</span></b><span lang=EN-US> response</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h4><span lang=EN-US style='background:white'>render</span></h4>

<p class=code><span lang=EN-US>render(request, </span><i><span lang=EN-US
style='color:#00AA00'>&quot;home.html&quot;</span></i><span lang=EN-US>,
context)</span></p>

<p class=MsoNormal><i><span lang=EN-US>&nbsp;</span></i></p>

<p class=MsoNormal><i><span lang=EN-US>Shortcuts.py (site-packages\django)</span></i></p>

<p class=MsoNormal><span lang=EN-US>render -&gt; Engine.render_to_string&nbsp;
-&gt; Template.render -&gt; Context. bind_template</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>超级用户</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>修改</span><span lang=EN-US>command</span><span
style='font-family:宋体'>，我只是调整了</span><span lang=EN-US>create_user</span><span
style='font-family:宋体'>的参数</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>参考文档</span></h3>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/1.5/ref/settings/#auth-profile-module"
target="_blank">https://docs.djangoproject.com/en/1.5/ref/settings/#auth-profile-module</a>
</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/topics/auth/customizing/#substituting-a-custom-user-model">https://docs.djangoproject.com/en/dev/topics/auth/customizing/#substituting-a-custom-user-model</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://blog.csdn.net/watsy/article/details/15506351">Django<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>中扩展</span></span>User<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>模型</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://onlypython.group.iteye.com/group/wiki/1519-expansion-django-user-model-by-non-profile-way"><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>非</span></span>profile<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>方式扩展</span></span>Django
User Model</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/smallcoderhujin/p/3193103.html">django user <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>权限</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.tuicool.com/articles/aMBJNjj">django <span lang=EN-US
style='font-family:宋体'><span lang=EN-US>注册、登录及第三方接口程序</span></span>(2)<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>：扩展</span></span>User<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>表</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/captain-cp/p/3590213.html"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>扩展</span></span>django<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>的</span></span>User<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>的部分方法</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.yihaomen.com/article/python/334.htm"><span style='background:
lime'>django admin</span><span lang=EN-US style='font-family:宋体;background:
lime'><span lang=EN-US>框架使用系列之三</span></span><span style='background:lime'>:</span><span
lang=EN-US style='font-family:宋体;background:lime'><span lang=EN-US>扩展</span></span><span
style='background:lime'>user model</span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a href="http://www.python88.com/topic/395/">Django<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>扩展</span></span>user<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>表并使用</span></span>email<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>登陆</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://segmentfault.com/q/1010000000610904">Django <span lang=EN-US
style='font-family:宋体'><span lang=EN-US>扩展</span></span> User model <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>的字段有什么好的方法？</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://guangboo.org/2013/03/27/authentication-using-email-in-django">django<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>使用</span></span>email<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>进行身份验证</span></span></a></span></p>

<p class=MsoNormal><a name=top></a><a
href="https://www.oschina.net/question/2341837_235437"><span style='font-family:
宋体'>自定义的用户认证如何登录使用</span><span lang=EN-US>Django</span><span style='font-family:
宋体'>自带的后台管理</span><span lang=EN-US>?</span></a></p>

<p class=MsoNormal><span class=MsoHyperlink><span lang=EN-US><span
 style='text-decoration:none'>&nbsp;</span></span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/topics/auth/default/#how-to-log-a-user-in"><span
class=std><span lang=EN style='font-size:10.5pt;font-family:Roboto;color:#6A0E0E;
text-decoration:none'>How to log a user in</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://docs.djangoproject.com/en/dev/topics/db/models/#proxy-models">https://docs.djangoproject.com/en/dev/topics/db/models/#proxy-models</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><a name="_评论"></a><span style='font-family:宋体'>评论</span></h2>

<p class=MsoNormal><span lang=EN-US>django.contrib.comments</span><span
style='font-family:宋体'>在</span><span lang=EN-US>django1.8</span><span
style='font-family:宋体'>已删除</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://stackoverflow.com/questions/32986302/importerror-no-module-named-comments-django">ImportError:
No module named comments django</a></span></p>

<p class=MsoNormal><span lang=EN-US>Django comments are deprecated in latest
version. You can either install older django version (such as 1.5). Or the
better solution is to install comments from external repository like so:</span></p>

<p class=code><span lang=EN-US>pip install django-contrib-comments</span></p>

<p class=MsoNormal><span lang=EN-US>and then change all imports like this:</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> django</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>contrib</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>comments</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>models </span><b><span lang=EN-US style='color:blue'>import</span></b><span
lang=EN-US> Comment </span><span lang=EN-US style='color:green'># old</span></p>

<p class=code><b><span lang=EN-US style='color:blue'>from</span></b><span
lang=EN-US> django_comments</span><b><span lang=EN-US style='color:navy'>.</span></b><span
lang=EN-US>models </span><b><span lang=EN-US style='color:blue'>import</span></b><span
lang=EN-US> Comment </span><span lang=EN-US style='color:green'># new</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Django1.9</span><span style='font-family:
宋体'>版本使用</span><span lang=EN-US>django_comments</span><span style='font-family:
宋体'>而非</span><span lang=EN-US>“django.contrib.comments”</span><span
style='font-family:宋体'>，直接</span><span lang=EN-US>pip install
django-contrib-comments</span><span style='font-family:宋体'>即可。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>可选的库包括</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US>mptt</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>&#159;<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span lang=EN-US>threadedcomments</span></p>

<p class=MsoNormal><span style='font-family:宋体'>最后选用</span><span lang=EN-US>mptt</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>生成的数据库效果图</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=778 height=470
id="Picture 2" src="Zakkabag.files/image015.png"></span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=778 height=433
id="Picture 3" src="Zakkabag.files/image016.png"></span></p>

<p class=MsoNormal><b><span lang=EN-US>object_pk</span></b></p>

<p class=MsoNormal><span lang=EN-US>Mptt</span><span style='font-family:宋体'>第一级的</span><span
lang=EN-US>object_pk</span><span style='font-family:宋体'>是</span><span
lang=EN-US>crowdfunding</span><span style='font-family:宋体'>，但是子评论的</span><span
lang=EN-US>object_pk</span><span style='font-family:宋体'>是父评论</span></p>

<p class=MsoNormal><span style='font-family:宋体;color:red'>注</span><span
lang=EN-US style='color:red'>: 9</span><span style='font-family:宋体'>是手动改的</span><span
lang=EN-US>level</span><span style='font-family:宋体'>变成</span><span lang=EN-US>1</span><span
style='font-family:宋体'>，变成</span><span lang=EN-US>8</span><span
style='font-family:宋体'>的子，用于测试目的。所以</span><span lang=EN-US>object_id=2</span><span
style='font-family:宋体'>，因为创建是</span><span lang=EN-US>level</span><span
style='font-family:宋体'>为</span><span lang=EN-US>0</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>评论显示的树形结构，每一个</span><span
lang=EN-US>comments</span><span style='font-family:宋体'>都是一个</span><span
lang=EN-US>Node</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>8</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>9</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>12</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>13</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>20</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>11</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>14</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>10</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>15</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>16</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>17</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>19</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
  border-top:none;background:lime;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>18</span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>html</span><span style='font-family:宋体'>结构如下</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=430 height=275
id="Picture 4" src="Zakkabag.files/image017.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=188 valign=top style='width:140.75pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>pypi</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>github</span></p>
  </td>
  <td width=118 valign=top style='width:88.55pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Document</span></p>
  </td>
  <td width=404 valign=top style='width:302.8pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=188 valign=top style='width:140.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>django-mptt</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="https://github.com/django-mptt/django-mptt/">django-mptt</a></span></p>
  </td>
  <td width=118 valign=top style='width:88.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="http://django-mptt.readthedocs.io/en/latest/tutorial.html#getting-started">readthedocs</a></span></p>
  </td>
  <td width=404 valign=top style='width:302.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="http://qinxuye.me/article/introduction-and-usage-of-django-mptt/"><span
  style='background:lime'>Django mptt</span><span lang=EN-US style='font-family:
  宋体;background:lime'><span lang=EN-US>介绍以及使用</span></span></a></span></p>
  <p class=MsoNormal><u><span lang=EN-US>mfitzp.io</span></u></p>
  <p class=MsoListParagraphCxSpFirst style='margin-left:18.0pt;text-indent:
  -18.0pt'><span lang=EN-US style='background:lime'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span lang=EN-US><a
  href="http://mfitzp.io/article/django-ajax-threaded-comments-using-only-jquery/"
  title="Django AJAX threaded-comments using only&nbsp;jQuery"><span
  style='background:lime'>Django&nbsp;AJAX&nbsp;threaded-comments using
  only&nbsp;jQuery</span></a></span></p>
  <p class=MsoListParagraphCxSpMiddle style='margin-left:18.0pt;text-indent:
  -18.0pt'><span class=MsoHyperlink><span lang=EN-US style='background:lime;
  text-decoration:none'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span></span><span lang=EN-US style='background:lime'><a
  href="http://mfitzp.io/article/django-threaded-comments/"
  title="Django Threaded&nbsp;Comments">Django Threaded&nbsp;Comments with mptt</a></span></p>
  <p class=MsoListParagraphCxSpLast style='margin-left:18.0pt;text-indent:-18.0pt'><span
  lang=EN-US style='background:lime'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span lang=EN-US><a
  href="http://mfitzp.io/article/syntax-highlighting-with-django-and-markdown/"><span
  style='background:lime'>Syntax highlighting with Django and&nbsp;Markdown</span></a></span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=188 valign=top style='width:140.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>django-threadedcomments</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="https://pypi.python.org/pypi/django-threadedcomments"><span
  style='background:lime'>django-threadedcomments</span></a></span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="https://github.com/HonzaKral/django-threadedcomments">django-threadedcomments</a></span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=118 valign=top style='width:88.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=404 valign=top style='width:302.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="http://eflorenzano.com/blog/categories/django-threadedcomments/">Eric
  Florenzano’s Blog - Category: django-threadedcomments</a></span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=188 valign=top style='width:140.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>django-comments-threaded</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="https://github.com/marazmiki/django-comments-threaded">django-comments-threaded</a></span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=118 valign=top style='width:88.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=404 valign=top style='width:302.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=188 valign=top style='width:140.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>django-contrib-comments / django_comments</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="http://django-comments-xtd.readthedocs.io/en/latest/">readthedocs</a></span></p>
  </td>
  <td width=118 valign=top style='width:88.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=404 valign=top style='width:302.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US><a
  href="http://www.cnblogs.com/weiming-cheng/p/5344309.html" target="_blank">Django&nbsp;<span
  lang=EN-US style='font-family:宋体'><span lang=EN-US>自带</span></span>comment<span
  lang=EN-US style='font-family:宋体'><span lang=EN-US>评论库使用</span></span></a></span></p>
  <p class=MsoNormal><span lang=EN-US><a
  href="https://www.dannysite.com/blog/16/">Django<span lang=EN-US
  style='font-family:宋体'><span lang=EN-US>个人博客开发（五）</span></span></a></span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=188 valign=top style='width:140.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>djangocms-comments</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><a name="OLE_LINK9"></a><a name="OLE_LINK8"></a><a
  href="https://pypi.python.org/pypi/djangocms-comments/0.2.2"><span
  lang=EN-US>djangocms-comments</span></a><a name="OLE_LINK10"></a><a
  name="OLE_LINK11"></a></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=136 valign=top style='width:102.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=118 valign=top style='width:88.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=404 valign=top style='width:302.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>&nbsp;</span></b></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border:solid windowtext 1.0pt;
  border-left:none;background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>Command</span></b></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border:solid windowtext 1.0pt;
  border-left:none;background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>Example</span></b></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border:solid windowtext 1.0pt;
  border-left:none;background:yellow;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US>Comments</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>Fetching comment
  counts:</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-right:24.0pt;background:#F0F0F0'><span
  lang=EN-US>get_comment_count </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_count for [object] as [varname] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_count for [object] as [varname] root_only %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_count for [app].[model] [id] as [varname] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_count for [app].[model] [id] as [varname] root_only
  %}</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>Fetching the
  comments list:</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-right:24.0pt;background:#F0F0F0'><span
  lang=EN-US>get_comment_list </span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_list for [object] as [varname] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_list for [object] as [varname] flat %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_list for [object] as [varname] root_only %}</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Gets the list of comments for the given
  params and populates the template</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp; context with a
  variable containing that value, whose name is defined by the</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp; 'as' clause.</span></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>Rendering the
  comments list:</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-right:24.0pt;background:#F0F0F0'><span
  lang=EN-US>render_comment_list </span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_list for [object] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_list for [object] root_only %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_list for [app].[model] [id] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_list for [app].[model] [id] root_only %}</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Render the comment list (as returned by
  ``{% get_comment_list %}``)</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp; through the
  ``comments/list.html`` template</span></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>Fetching the
  comment form:</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-right:24.0pt;background:#F0F0F0'><span
  lang=EN-US>get_comment_form </span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_form for [object] as [varname] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_form for [object] as [varname] with [parent_id] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_form for [app].[model] [id] as [varname] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% get_comment_form for [app].[model] [id] as [varname] with [parent_id]
  %}</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Get a (new) form object to post a new
  comment.</span></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>Rendering the
  comment form:</span></p>
  <p class=MsoNormal style='background:white'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-right:24.0pt;background:#F0F0F0'><span
  lang=EN-US>render_comment_form </span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_form for [object] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_form for [object] with [parent_id] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_form for [app].[model] [id] %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% render_comment_form for [app].[model] [id] with [parent_id] %}</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Render the comment form (as returned by
  ``{% render_comment_form %}``) through</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp; the ``<b>comments/form.html</b>``
  template.</span></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>Rendering the
  whole tree:</span></p>
  <p class=MsoNormal style='background:white'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-right:24.0pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% for comment in comment_list|fill_tree|annotate_tree %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;&nbsp;&nbsp; {% ifchanged comment.parent_id %}{% else
  %}&lt;/li&gt;{% endifchanged %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;&nbsp;&nbsp; {% if not comment.open and not comment.close
  %}&lt;/li&gt;{% endif %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;&nbsp;&nbsp; {% if comment.open %}&lt;ul&gt;{% endif %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;&nbsp;&nbsp; &lt;li id=&quot;c{{ comment.id }}&quot;&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;&nbsp;&nbsp; {% for close in comment.close
  %}&lt;/li&gt;&lt;/ul&gt;{% endfor %}</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>{% endfor %}</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>The&nbsp;fill_tree&nbsp;filter
  is required for pagination, it ensures that the parents of the first comment
  are included as well.</span></p>
  <p class=MsoNormal style='background:white'><span lang=EN-US>The&nbsp;annotate_tree&nbsp;filter
  adds the&nbsp;open&nbsp;and&nbsp;close&nbsp;properties to the comment.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=197 valign=top style='width:147.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='background:white'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=230 valign=top style='width:172.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=546 valign=top style='width:409.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
  0cm;margin-left:24.0pt;margin-bottom:.0001pt;background:#F0F0F0'><span
  lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=321 valign=top style='width:240.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>Requirement</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>django-contrib-comments / django_comments</span></p>

<p class=MsoNormal><span lang=EN-US>django-mptt </span><span style='font-family:
宋体'>支持</span><span lang=EN-US>threaded</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US>setting</span><span
style='font-family:宋体'>里添加</span><span lang=EN-US>APP</span><span
style='font-family:宋体'>，</span><span lang=EN-US>comments</span><span
style='font-family:宋体'>是自定义的</span><span lang=EN-US>app</span></p>

<p class=codewithbg><span lang=EN-US>INSTALLED_APPS = (</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;
'django_comments',&nbsp;&nbsp; </span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; #
'django.contrib.comments',</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; 'mptt',</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; 'comments',</span></p>

<p class=codewithbg><span lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>同时，在</span><span lang=EN-US>settings.py</span><span
style='font-family:宋体'>添加</span></p>

<p class=codewithbg><span lang=EN-US>COMMENTS_APP <b><span style='color:black'>=</span></b>
<span style='color:#D01040'>'comments'</span></span></p>

<p class=MsoNormal><span style='font-family:宋体'>创建</span><span lang=EN-US>MPTTComments</span><span
style='font-family:宋体'>，同时从</span><span lang=EN-US>MPTTModel</span><span
style='font-family:宋体'>和</span><span lang=EN-US>Comment</span><span
style='font-family:宋体'>继承，并添加新的域</span><span lang=EN-US>parent</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>from</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>django.contrib.comments.models<span
style='color:#333333'> </span><b><span style='color:black'>import</span></b><span
style='color:#333333'> Comment</span></span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>from</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>mptt.models<span
style='color:#333333'> </span><b><span style='color:black'>import</span></b><span
style='color:#333333'> MPTTModel, TreeForeignKey</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>class</span></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:#445588'>MPTTComment</span></b><span
lang=EN-US style='color:#333333'>(MPTTModel, Comment):</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:#D01040'>&quot;&quot;&quot; Threaded comments - Add
support for the parent comment store and MPTT traversal&quot;&quot;&quot;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><i><span
lang=EN-US style='color:#999988'># a link to comment that is being replied, if
one exists</span></i></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;
parent </span><b><span lang=EN-US style='color:black'>=</span></b><span
lang=EN-US style='color:#333333'> TreeForeignKey(</span><span lang=EN-US
style='color:#D01040'>'self'</span><span lang=EN-US style='color:#333333'>,
null</span><b><span lang=EN-US style='color:black'>=</span></b><span
lang=EN-US style='color:#999999'>True</span><span lang=EN-US style='color:#333333'>,
blank</span><b><span lang=EN-US style='color:black'>=</span></b><span
lang=EN-US style='color:#999999'>True</span><span lang=EN-US style='color:#333333'>,
related_name</span><b><span lang=EN-US style='color:black'>=</span></b><span
lang=EN-US style='color:#D01040'>'children'</span><span lang=EN-US
style='color:#333333'>)</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:black'>class</span></b><span lang=EN-US
style='color:#333333'> </span><b><span lang=EN-US style='color:#445588'>MPTTMeta</span></b><span
lang=EN-US style='color:#333333'>:</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><i><span lang=EN-US style='color:#999988'># comments on one level will
be ordered by date of creation</span></i></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
order_insertion_by</span><b><span lang=EN-US style='color:black'>=</span></b><span
lang=EN-US style='color:#333333'>[</span><span lang=EN-US style='color:#D01040'>'submit_date'</span><span
lang=EN-US style='color:#333333'>]</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US style='color:black'>class</span></b><span lang=EN-US
style='color:#333333'> </span><b><span lang=EN-US style='color:#445588'>Meta</span></b><span
lang=EN-US style='color:#333333'>:</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ordering</span><b><span lang=EN-US style='color:black'>=</span></b><span
lang=EN-US style='color:#333333'>[</span><span lang=EN-US style='color:#D01040'>'tree_id'</span><span
lang=EN-US style='color:#333333'>,</span><span lang=EN-US style='color:#D01040'>'lft'</span><span
lang=EN-US style='color:#333333'>]</span></p>

<p class=MsoNormal><span style='font-family:宋体'>同样的，我们也要继承</span><span
lang=EN-US>CommentForm</span><span style='font-family:宋体'>，添加新的域</span><span
lang=EN-US>parent</span></p>

<p class=codewithbg><b><span lang=EN-US>from</span></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US style='color:#555555'>django</span><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US>import</span></b><span
lang=EN-US style='color:#333333'> forms</span></p>

<p class=codewithbg><b><span lang=EN-US>from</span></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US style='color:#555555'>django.contrib.admin</span><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US>import</span></b><span
lang=EN-US style='color:#333333'>
widgets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>

<p class=codewithbg><b><span lang=EN-US>from</span></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US style='color:#555555'>django.contrib.comments.forms</span><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US>import</span></b><span
lang=EN-US style='color:#333333'>
CommentForm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=codewithbg><b><span lang=EN-US>from</span></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US style='color:#555555'>models</span><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US>import</span></b><span
lang=EN-US style='color:#333333'> MPTTComment</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US>class</span></b><span lang=EN-US
style='color:#333333'> </span><b><span lang=EN-US style='color:#445588'>MPTTCommentForm</span></b><span
lang=EN-US style='color:#333333'>(CommentForm):</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;
parent </span><b><span lang=EN-US>=</span></b><span lang=EN-US
style='color:#333333'> forms</span><b><span lang=EN-US>.</span></b><span
lang=EN-US style='color:#333333'>ModelChoiceField(queryset</span><b><span
lang=EN-US>=</span></b><span lang=EN-US style='color:#333333'>MPTTComment</span><b><span
lang=EN-US>.</span></b><span lang=EN-US style='color:#333333'>objects</span><b><span
lang=EN-US>.</span></b><span lang=EN-US style='color:#333333'>all(), required</span><b><span
lang=EN-US>=</span></b><span lang=EN-US style='color:#999999'>False</span><span
lang=EN-US style='color:#333333'>, widget</span><b><span lang=EN-US>=</span></b><span
lang=EN-US style='color:#333333'>forms</span><b><span lang=EN-US>.</span></b><span
lang=EN-US style='color:#333333'>HiddenInput)</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US>def</span></b><span lang=EN-US style='color:#333333'> </span><b><span
lang=EN-US style='color:#990000'>get_comment_model</span></b><span lang=EN-US
style='color:#333333'>(</span><span lang=EN-US style='color:#999999'>self</span><span
lang=EN-US style='color:#333333'>):</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><i><span lang=EN-US style='color:#999988'># Use our custom comment model
instead of the built-in one.</span></i></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US>return</span></b><span lang=EN-US style='color:#333333'>
MPTTComment</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><span
lang=EN-US>def</span></b><span lang=EN-US style='color:#333333'> </span><b><span
lang=EN-US style='color:#990000'>get_comment_create_data</span></b><span
lang=EN-US style='color:#333333'>(</span><span lang=EN-US style='color:#999999'>self</span><span
lang=EN-US style='color:#333333'>):</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><i><span lang=EN-US style='color:#999988'># Use the data of the
superclass, and add in the parent field field</span></i></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data </span><b><span lang=EN-US>=</span></b><span lang=EN-US style='color:#333333'>
</span><span lang=EN-US style='color:#0086B3'>super</span><span lang=EN-US
style='color:#333333'>(MPTTCommentForm, </span><span lang=EN-US
style='color:#999999'>self</span><span lang=EN-US style='color:#333333'>)</span><b><span
lang=EN-US>.</span></b><span lang=EN-US style='color:#333333'>get_comment_create_data()</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data[</span><span lang=EN-US style='color:#D01040'>'parent'</span><span
lang=EN-US style='color:#333333'>] </span><b><span lang=EN-US>=</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US style='color:#999999'>self</span><b><span
lang=EN-US>.</span></b><span lang=EN-US style='color:#333333'>cleaned_data[</span><span
lang=EN-US style='color:#D01040'>'parent'</span><span lang=EN-US
style='color:#333333'>]</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><span lang=EN-US>return</span></b><span lang=EN-US style='color:#333333'>
data</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:13.0pt;font-family:"Times New Roman","serif";
color:#333332;background:white'>Django comments extensions work on a simple
principle: you tell the comments app about what you’ve changed through the use
of some simple hooks. Django then uses these hooks to lookup your altered
models and forms and overrides the default set. So now that we’ve created our
modified forms and models, we need to point Django at&nbsp;them.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>在</span><span lang=EN-US>__init__.py</span><span
style='font-family:宋体'>文件中添加钩子功能，指定</span><span lang=EN-US>model</span><span
style='font-family:宋体'>和</span><span lang=EN-US>form</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>from</span></b><span
lang=EN-US> <span style='color:#555555'>models</span> <b><span
style='color:black'>import</span></b> MPTTComment</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>from</span></b><span
lang=EN-US> <span style='color:#555555'>forms</span> <b><span style='color:
black'>import</span></b> MPTTCommentForm</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>def</span></b><span
lang=EN-US> <b><span style='color:#990000'>get_model</span></b>():</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:black'>return</span></b> MPTTComment</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><span lang=EN-US style='color:black'>def</span></b><span
lang=EN-US> <b><span style='color:#990000'>get_form</span></b>():</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; <b><span
style='color:black'>return</span></b> MPTTCommentForm</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>接下来创建一个处理评论的模板，这个模板最好是一个独立的文件</span><span
lang=EN-US>comments_tree.html</span><span style='font-family:宋体'>，可以在其他文件中进行调用</span></p>

<p class=codewithbg><span lang=EN-US style='background:#F2F2F2'>{% with
&lt;yourmodel&gt; as object %}{% include &quot;comments_tree.html&quot; %}{%
endwith %}</span></p>

<p class=MsoNormal><span style='font-family:宋体'>这样模板里面可以固定要</span><span
lang=EN-US>object</span><span style='font-family:宋体'>作为对象名</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>load</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>load</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>mptt_tags<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>get_comment_list</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>for<span
style='color:#333333'> </span>object<span style='color:#333333'> </span><b><span
style='color:black'>as</span></b><span style='color:#333333'> </span>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>if</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>recursetree</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:navy'>&lt;a</span><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>name=<span style='color:#D01040'>&quot;c</span><b><i><span
style='color:#999999'>{{</span></i></b><span style='color:#333333'> </span>node.id<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b><span
style='color:#D01040'>&quot;</span><span style='color:navy'>&gt;&lt;/a&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><i><span lang=EN-US style='color:#999999'>{{</span></i></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>node.comment<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><i><span lang=EN-US style='color:#999999'>{{</span></i></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>node.user<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><i><span lang=EN-US style='color:#999999'>{{</span></i></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>node.submit_date<b><span
style='color:black'>|</span><span style='color:#990000'>timesince</span></b><span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b><span
style='color:#333333'> ago</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:navy'>&lt;a</span><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>href=<span style='color:#D01040'>&quot;</span><b><i><span
style='color:#999999'>{{</span></i></b><span style='color:#333333'> </span>object.get_absolute_url<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b><span
style='color:#D01040'>#c</span><b><i><span style='color:#999999'>{{</span></i></b><span
style='color:#333333'> </span>node.id<span style='color:#333333'> </span><b><i><span
style='color:#999999'>}}</span></i></b><span style='color:#D01040'>&quot;</span><span
style='color:navy'>&gt;</span><span style='color:#333333'>#</span><span
style='color:navy'>&lt;/a&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>render_comment_form</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>for<span
style='color:#333333'> </span>object<span style='color:#333333'> </span><b><i><span
style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><i><span
lang=EN-US style='color:#999988'>{# recursion! children of a given comment #}</span></i></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg style='text-indent:24.0pt'><b><i><span lang=EN-US
style='color:#999999'>{%</span></i></b><span lang=EN-US style='color:#333333'> </span><b><span
lang=EN-US style='color:black'>if</span></b><span lang=EN-US style='color:#333333'>
</span><b><span lang=EN-US style='color:black'>not</span></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>node.is_leaf_node<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US style='color:red'>&lt;ul
class=&quot;children&quot;&gt;</span></i></b></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b><i><span lang=EN-US style='color:#999999'>{{</span></i></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>children<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></i></b><span lang=EN-US style='color:red'>&lt;/ul&gt;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{%</span></i></b><span lang=EN-US
style='color:#333333'> </span><b><span lang=EN-US style='color:black'>endif</span></b><span
lang=EN-US style='color:#333333'> </span><b><i><span lang=EN-US
style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>endrecursetree</span></b><span
lang=EN-US style='color:#333333'> </span><b><i><span lang=EN-US
style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>endif</span></b><span
lang=EN-US style='color:#333333'> </span><b><i><span lang=EN-US
style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>render_comment_form</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>for<span
style='color:#333333'> </span>object<span style='color:#333333'> </span><b><i><span
style='color:#999999'>%}</span></i></b></span></p>

<p class=MsoNormal><b><i><span lang=EN-US style='color:red'>&lt;ul
class=&quot;children&quot;&gt;</span></i></b><span style='font-family:宋体'>可以呈现缩进效果</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=519 height=531
id="图片 21" src="Zakkabag.files/image018.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>或者可以使用另外一个命令</span><span
lang=EN-US>full_tree_for_model comments.MPTTComment</span><span
style='font-family:宋体'>，这个可以获取所有的</span><span lang=EN-US>comments</span></p>

<p class=MsoNormal><span style='font-family:宋体'>原来我用上面的方法没搞定，所以用了下面的</span><span
lang=EN-US>workaroud</span><span style='font-family:宋体'>，这儿只是介绍这种方法</span></p>

<p class=MsoNormal><span lang=EN-US style='color:#333333'>node.object_pk ==
object.id|int2str </span><span style='font-family:宋体;color:#333333'>可以过滤出根节点，所有的根节点的</span><span
lang=EN-US style='color:#333333'>object</span><span style='font-family:宋体;
color:#333333'>都是被依附的对象本身，子评论的</span><span lang=EN-US style='color:#333333'>objet_PK</span><span
style='font-family:宋体;color:#333333'>变成父评论</span></p>

<p class=MsoNormal><span style='font-family:宋体;color:#333333'>找到根节点之后，叶节点只要满足</span><span
lang=EN-US style='color:#333333'>node.level&gt;0</span><span style='font-family:
宋体;color:#333333'>就可以了。其他</span><span lang=EN-US style='color:#333333'>object</span><span
style='font-family:宋体;color:#333333'>的</span><span lang=EN-US style='color:
#333333'>node</span><span style='font-family:宋体;color:#333333'>的</span><span
lang=EN-US style='color:#333333'>level</span><span style='font-family:宋体;
color:#333333'>随便也大于</span><span lang=EN-US style='color:#333333'>0</span><span
style='font-family:宋体;color:#333333'>，但是它们的父节点永远都不满足条件，所以它们本身永远不会有机会出现</span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>load</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>load</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>mptt_tags<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333;background:yellow'>{%
full_tree_for_model comments.MPTTComment as comments %}</span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>if</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>recursetree</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333;background:yellow'>{%
if node.level &gt; 0 or node.object_pk == object.id|int2str %}</span></p>

<p class=codewithbg><i><span lang=EN-US style='color:#999988'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Comments…</span></i></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>endif</span></b><span
lang=EN-US style='color:#333333'> </span><b><i><span lang=EN-US
style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>endrecursetree</span></b><span
lang=EN-US style='color:#333333'> </span><b><i><span lang=EN-US
style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>endif</span></b><span
lang=EN-US style='color:#333333'> </span><b><i><span lang=EN-US
style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>render_comment_form</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>for<span
style='color:#333333'> </span>object<span style='color:#333333'> </span><b><i><span
style='color:#999999'>%}</span></i></b></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>最后，当回复</span><span lang=EN-US>comments</span><span
style='font-family:宋体'>时，需要再</span><span lang=EN-US>comments form</span><span
style='font-family:宋体'>里添加</span><span lang=EN-US>parent_id</span><span
style='font-family:宋体'>，添加</span><span lang=EN-US>comments/form.html</span></p>

<p class=codewithbg><b><i><span lang=EN-US style='color:#999999'>{%</span></i></b><span
lang=EN-US style='color:#333333'> </span><b><span lang=EN-US style='color:black'>load</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>comments<span
style='color:#333333'> </span>i18n<span style='color:#333333'> </span><b><i><span
style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>&lt;form</span><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>action=<span
style='color:#D01040'>&quot;</span><b><i><span style='color:#999999'>{%</span></i></b><span
style='color:#333333'> </span><b><span style='color:black'>comment_form_target</span></b><span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b><span
style='color:#D01040'>&quot;</span><span style='color:#333333'> </span>method=<span
style='color:#D01040'>&quot;post&quot;</span><span style='color:navy'>&gt;</span><b><i><span
style='color:#999999'>{%</span></i></b><span style='color:#333333'> </span><b><span
style='color:black'>csrf_token</span></b><span style='color:#333333'> </span><b><i><span
style='color:#999999'>%}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{{</span></i></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>form.object_pk<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{{</span></i></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>form.content_type<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{{</span></i></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>form.timestamp<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{{</span></i></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>form.security_hash<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{%</span></i></b><span lang=EN-US
style='color:#333333'> </span><b><span lang=EN-US style='color:black'>if</span></b><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>node.id<span
style='color:#333333'> </span><b><i><span style='color:#999999'>%}</span></i></b><span
style='color:#333333'>&nbsp;&nbsp;&nbsp; </span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:navy'>&lt;input</span><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>type=<span style='color:#D01040'>&quot;hidden&quot;</span><span
style='color:#333333'> </span>name=<span style='color:#D01040'>&quot;parent&quot;</span><span
style='color:#333333'> </span>id=<span style='color:#D01040'>&quot;parent_id&quot;</span><span
style='color:#333333'> </span>value=<span style='color:#D01040'>&quot;</span><b><i><span
style='color:#999999'>{{</span></i></b><span style='color:#333333'> </span>node.id<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b><span
style='color:#D01040'>&quot;</span><span style='color:#333333'> </span><span
style='color:navy'>/&gt;</span></span></p>

<p class=codewithbg style='text-indent:24.0pt'><b><i><span lang=EN-US
style='color:#999999'>{%</span></i></b><span lang=EN-US style='color:#333333'> </span><b><span
lang=EN-US style='color:black'>endif</span></b><span lang=EN-US
style='color:#333333'> </span><b><i><span lang=EN-US style='color:#999999'>%}</span></i></b></p>

<p class=codewithbg style='text-indent:24.0pt'><span lang=EN-US
style='color:#333333'>&lt;input type='hidden' name='next' value='{% url &quot;<span
style='background:lime'>Crowdfunding_comments</span>&quot; pk=object.id
%}'/&gt;&nbsp;&nbsp; </span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><b><i><span
lang=EN-US style='color:#999999'>{{</span></i></b><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>form.comment<span
style='color:#333333'> </span><b><i><span style='color:#999999'>}}</span></i></b></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:navy'>&lt;input</span><span lang=EN-US
style='color:#333333'> </span><span lang=EN-US>type=<span style='color:#D01040'>&quot;submit&quot;</span><span
style='color:navy'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:navy'>&lt;/form&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>关键点是添加</span><span lang=EN-US>parent_id.
</span><span style='font-family:宋体'>这个文件可以从</span><span lang=EN-US>django
contrib</span><span style='font-family:宋体'>库里拷贝过来再编辑。</span></p>

<p class=MsoNormal><span lang=EN-US style='color:#333333'>Crowdfunding_comments</span><span
style='font-family:宋体;color:#333333'>会返回</span><span lang=EN-US
style='color:#333333'>html</span><span style='font-family:宋体;color:#333333'>，内容在</span><span
lang=EN-US style='color:#333333'>ajax</span><span style='font-family:宋体;
color:#333333'>处理</span><span lang=EN-US style='color:#333333'>, </span><span
style='font-family:宋体;color:#333333'>尝试过用</span><span lang=EN-US
style='color:#333333'>default</span><span style='font-family:宋体;color:#333333'>模板的</span><span
lang=EN-US style='color:#333333'>{{next}}</span><span style='font-family:宋体;
color:#333333'>，不工作</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US style='background:lime'>form</span></b><b><span
style='font-family:宋体;background:lime'>的</span><span lang=EN-US
style='background:lime'>render</span></b><b><span style='font-family:宋体;
background:lime'>可以参考这个原文件</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>添加</span><span
lang=EN-US>Ajax</span><span style='font-family:宋体'>提交功能</span></h3>

<p class=MsoNormal><span style='font-family:宋体'>功能都是由模板或者</span><span
lang=EN-US>templatetag</span><span style='font-family:宋体'>完成，不需要改后台</span></p>

<p class=MsoNormal><span style='font-family:宋体'>首先给</span><span lang=EN-US>form</span><span
style='font-family:宋体'>添加</span><span lang=EN-US>id</span><span
style='font-family:宋体'>，便于</span><span lang=EN-US>Jquery</span><span
style='font-family:宋体'>操作，</span><span lang=EN-US>form</span><span
style='font-family:宋体'>和它的</span><span lang=EN-US>wrapper</span><span
style='font-family:宋体'>都添加了</span><span lang=EN-US>id</span></p>

<p class=MsoNormal><span lang=EN-US>form.html</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&lt;</span><span
lang=EN-US style='color:navy'>div</span><span lang=EN-US style='color:#333333'>
</span><span lang=EN-US style='color:teal'>class</span><b><span lang=EN-US
style='color:black'>=</span></b><span lang=EN-US>&quot;comment-form&quot;<span
style='color:#333333'> </span><span style='color:teal'>id</span><b><span
style='color:black'>=</span></b>&quot;comment-form-{{ node.id }}&quot;<span
style='color:#333333'> </span><span style='color:#A61717;background:#E3D2D2'>{%</span><span
style='color:#333333'> </span><span style='color:teal'>if</span><span
style='color:#333333'> </span><span style='color:teal'>node</span><span
style='color:#A61717;background:#E3D2D2'>.</span><span style='color:teal'>id</span><span
style='color:#333333'> </span><span style='color:#A61717;background:#E3D2D2'>%}</span><span
style='color:teal'>style</span><b><span style='color:black'>=</span></b>&quot;display:none;&quot;<span
style='color:#A61717;background:#E3D2D2'>{%</span><span style='color:#333333'> </span><span
style='color:teal'>endif</span><span style='color:#333333'> </span><span
style='color:#A61717;background:#E3D2D2'>%}</span><span style='color:#333333'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&lt;</span><span
lang=EN-US style='color:navy'>form</span><span lang=EN-US style='color:#333333'>
</span><span lang=EN-US style='color:teal'>action</span><b><span lang=EN-US
style='color:black'>=</span></b><span lang=EN-US>&quot;{% comment_form_target
%}&quot;<span style='color:#333333'> </span><span style='color:teal'>method</span><b><span
style='color:black'>=</span></b>&quot;post&quot;<span style='color:#333333'> </span><span
style='color:teal'>id</span><b><span style='color:black'>=</span></b>&quot;comment-form-{{
node.id }}f&quot;<span style='color:#333333'>&gt;</span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>接下来修改评论输出文件，在</span><b><span
lang=EN-US style='font-size:11.5pt;font-family:"Courier New";color:#333333;
background:#F2F2F2'>{% recursetree comments %}</span></b><span
style='font-family:宋体'>下面添加</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&lt;</span><span
lang=EN-US style='color:navy'>div</span><span lang=EN-US style='color:#333333'>
</span><span lang=EN-US style='color:#A61717;background:#E3D2D2'>{%</span><span
lang=EN-US style='color:#333333'> </span><span lang=EN-US>if<span
style='color:#333333'> </span>request<span style='color:#A61717;background:
#E3D2D2'>.</span>REQUEST<span style='color:#A61717;background:#E3D2D2'>.</span>c<span
style='color:#A61717;background:#E3D2D2'>|</span>add:<span style='color:#A61717;
background:#E3D2D2'>&quot;</span>0<span style='color:#A61717;background:#E3D2D2'>&quot;</span><span
style='color:#333333'> </span><span style='color:#A61717;background:#E3D2D2'>==</span><span
style='color:#333333'> </span>node<span style='color:#A61717;background:#E3D2D2'>.</span>id<span
style='color:#333333'> </span><span style='color:#A61717;background:#E3D2D2'>%}</span>id<b><span
style='color:black'>=</span></b><span style='color:#D01040'>&quot;newly_posted_comment&quot;</span><span
style='color:#A61717;background:#E3D2D2'>{%</span><span style='color:#333333'> </span>endif<span
style='color:#333333'> </span><span style='color:#A61717;background:#E3D2D2'>%}</span><span
style='color:#333333'>&gt;</span></span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>...comment
content...</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US style='color:#333333'>&lt;/</span><span
lang=EN-US style='color:navy'>div</span><span lang=EN-US style='color:#333333'>&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>request.REQUEST.c</span><span
style='font-family:宋体'>会寻找</span><span lang=EN-US>query</span><span
style='font-family:宋体'>字符串里的</span><span lang=EN-US>c</span><span
style='font-family:宋体'>值</span><span lang=EN-US>,&nbsp; add:&quot;0&quot;</span><span
style='font-family:宋体'>会把它转为整形值、</span></p>

<p class=MsoNormal><span style='font-family:宋体'>这个效果是给</span><span lang=EN-US>post</span><span
style='font-family:宋体'>的评论添加</span><span lang=EN-US>id</span><span
style='font-family:宋体'>，便于找到</span><span lang=EN-US>ajax</span><span
style='font-family:宋体'>返回的</span><span lang=EN-US>html</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
color:#333333'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:12.0pt;font-family:宋体;color:#333333'>添加</span><b><span
lang=EN-US style='font-size:11.5pt;font-family:"Courier New";color:#333333;
background:#F2F2F2'>_ajax_comments.html</span></b><span style='font-family:
宋体'>用于处理</span><span lang=EN-US>ajax</span><span style='font-family:宋体'>请求</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
color:#333333'>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>{% load comments %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&lt;script
type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(function( $ ){</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$.fn.bindPostCommentHandler = function() {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// We get passed a list of forms; iterate and get a unique id for each</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// attach a submit trigger to handle saving and returning</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
this.each(function() {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(this).submit(function() {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
commentform = this;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
commentwrap = $(this).parent();</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$.ajax({</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
type: &quot;POST&quot;,</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data: $(commentform).serialize(),</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url: &quot;{% comment_form_target %}&quot;,</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache:
false,</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
dataType: &quot;html&quot;,</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
success: function(html, textStatus) {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// Extract the form from the returned html</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
postedcomment = $(html).find('#newly_posted_comment');</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(commentform).replaceWith(postedcomment.html());</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(commentwrap).hide();</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(commentwrap).slideDown(600);</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(commentwrap).find('.comment-form form').bindPostCommentHandler();</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
},</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
error: function (XMLHttpRequest, textStatus, errorThrown) {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(commentform).replaceWith('Your comment was unable to be posted at this
time.&nbsp; We apologise for the inconvenience.');</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
});</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return false;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
});</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}); //each</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
};</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
})( jQuery );</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(function() {</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$('.comment-form form').bindPostCommentHandler();</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
});</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;</span></p>

<p class=codewithbg><span lang=EN-US>&lt;/script&gt;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
color:#333333'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Success</span><span style='font-family:
宋体'>的处理中，根据</span><span lang=EN-US>#newly_posted_comment</span><span
style='font-family:宋体'>从返回的</span><span lang=EN-US>html</span><span
style='font-family:宋体'>中找到当前的评论，并将它</span><span lang=EN-US>replace</span><span
style='font-family:宋体'>到</span><span lang=EN-US>form</span><span
style='font-family:宋体'>中去。</span></p>

<p class=MsoNormal><span style='font-family:宋体'>这种方法效率比较高，但是问题是座位嵌套显示时会有问题，因为</span><span
lang=EN-US>form</span><span style='font-family:宋体'>的位置并不是新的评论要插入的位置</span></p>

<p class=MsoNormal><span lang=EN-US>Form</span><span style='font-family:宋体'>位置</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=773 height=367
id="图片 17" src="Zakkabag.files/image019.png"></span></p>

<p class=MsoNormal><span style='font-family:宋体'>实际插入位置</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=582 height=419 id="图片 8"
src="Zakkabag.files/image020.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>期望插入位置</span></p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=426 height=380
id="图片 12" src="Zakkabag.files/image021.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>之前我也实现过一个全部代替的方式，如下</span></p>

<p class=MsoNormal><span lang=EN-US>#cmt_show</span><span style='font-family:
宋体'>是整个评论的</span><span lang=EN-US>wrapper</span><span style='font-family:宋体'>，在</span><span
lang=EN-US>comments_tree.html</span><span style='font-family:宋体'>里</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
postedcomment = $(html).find('#cmt_show');</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
posted_comment_html=postedcomment.html();</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
console.log(posted_comment_html);</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
posted_comment_wrap_html=&quot;&lt;div
id='cmt_show'&gt;&quot;+posted_comment_html+&quot;&lt;/div&gt;&quot;;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$('#cmt_show').replaceWith(posted_comment_wrap_html);</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$('.comment-form form').bindPostCommentHandler();</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
color:#333333'>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>添加</span><span
lang=EN-US>level0 form</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>自定义</span><span lang=EN-US>
comments/comments_form.html,</span><span style='font-family:宋体'>也可以直接用</span><span
lang=EN-US>django_comments/templates/comments/form.html</span><span
style='font-family:宋体'>，这也是</span><b><span lang=EN-US style='color:black'>render_comment_form</span></b><span
style='font-family:宋体'>的默认的</span><span lang=EN-US>template</span></p>

<p class=codewithbg><span lang=EN-US>{% load comments i18n %}</span></p>

<p class=codewithbg><span lang=EN-US>&lt;form action=&quot;{%
comment_form_target %}&quot; method=&quot;post&quot;&gt;{% csrf_token %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp; {% if next %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &lt;div&gt;&lt;input
type=&quot;hidden&quot; name=&quot;next&quot; value=&quot;{{ next
}}&quot;/&gt;&lt;/div&gt;{% endif %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp; {% for field in form %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% if field.is_hidden
%}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;div&gt;{{ field }}&lt;/div&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% else %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {% if
field.errors %}{{ field.errors }}{% endif %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% if field.errors %} class=&quot;error&quot;{% endif %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{% ifequal field.name &quot;honeypot&quot; %} style=&quot;display:none;&quot;{%
endifequal %}&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{{ field.label_tag }} {{ field }}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/p&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% endif %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp; {% endfor %}</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp; &lt;p class=&quot;submit&quot;&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &lt;input
type=&quot;submit&quot; name=&quot;post&quot; class=&quot;submit-post&quot;
value=&quot;{% trans &quot;Post&quot; %}&quot;/&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp;&nbsp;&nbsp; &lt;input
type=&quot;submit&quot; name=&quot;preview&quot;
class=&quot;submit-preview&quot; value=&quot;{% trans &quot;Preview&quot;
%}&quot;/&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&nbsp; &lt;/p&gt;</span></p>

<p class=codewithbg><span lang=EN-US>&lt;/form&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>遗留问题</span></h3>

<p class=MsoListParagraphCxSpFirst style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US>Post</span><span style='font-family:宋体'>之后刷新页面会多次自动提交</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span lang=EN-US>Post comments</span><span style='font-family:
宋体'>只有</span><span lang=EN-US>Chrome</span><span style='font-family:宋体'>能工作，其他的都不行</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span style='font-family:宋体'>嵌套的顺序是反的，应该是父在最外面</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span style='font-family:宋体'>只有登录情况下才能</span><span lang=EN-US>post
comments</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/ccorz/p/5985534.html" target="_blank">django<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>中的多级评论</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/restran/archive/2012/04/26/2469839.html"
target="_blank">Django<span lang=EN-US style='font-family:宋体'><span lang=EN-US>中使用</span></span>jQuery<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>做评论的无刷新提交</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/mfc-itblog/p/5188900.html" target="_blank">Django<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>使用</span></span>Ajax<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>实现页面无刷新评论回复功能</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.yihaomen.com/article/python/255.htm"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>分层评论的实现思路</span></span>,thread comments
<span lang=EN-US style='font-family:宋体'><span lang=EN-US>实现思路</span></span>,<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>数据库存树状结构</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>社会化评论</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://bookshadow.com/weblog/2014/06/04/django-blog-zinnia-add-duoshuo/"
target="_blank">django-blog-zinnia<span lang=EN-US style='font-family:宋体'><span
lang=EN-US>集成多说评论框</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://www.baidu.com/link?url=U33F7R5Dlgc7qtGN0njPDD9_gO-Dzn3xf1zgeVeIR4S4wLpr_pt4N03camgNEW4l50SFSUEaHZSTIfxcr6VxD_&amp;wd=&amp;eqid=d9d7b7a80003b0790000000458440bd3"
target="_blank">Disqus_<span lang=EN-US style='font-family:宋体'><span
lang=EN-US>百度百科</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://www.baidu.com/link?url=VPTczqkq7L-HDLvGHU7UfJ4PTkb8CNzKMlJitI7kyskHi9TXfI9npoopHK06W4Cy&amp;wd=&amp;eqid=e510e6f10003aa960000000458440c69"
target="_blank"><span lang=EN-US style='font-family:宋体'><span lang=EN-US>国内社会化评论</span></span>(<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>类</span></span>DISQUS)<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>插件哪个好</span></span>?</a></span></p>

<p class=MsoNormal><span style='font-family:宋体'>畅言</span> <span lang=EN-US><a
href="http://changyan.kuaizhan.com/">http://changyan.kuaizhan.com/</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>sblog</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/cacique/archive/2012/10/03/2710803.html"><span
style='background:lime'>django </span><span lang=EN-US style='font-family:宋体;
background:lime'><span lang=EN-US>简易博客开发</span></span><span style='background:
lime'> 4 comments</span><span lang=EN-US style='font-family:宋体;background:lime'><span
lang=EN-US>库使用及</span></span><span style='background:lime'>ajax</span><span
lang=EN-US style='font-family:宋体;background:lime'><span lang=EN-US>支持</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a href="https://github.com/gusibi/sblog">sblog</a></span><span
style='font-family:宋体'>怎么做</span><span lang=EN-US>comments</span><span
style='font-family:宋体'>的</span><span lang=EN-US>ajax</span><span
style='font-family:宋体'>更新的</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>templates/simpleblog/blog_add_comments.html</span></i></p>

<p class=code><span lang=EN-US style='color:blue'>&lt;div</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>id</span><span
lang=EN-US>=&quot;<span style='background:olive'>comment_form</span>&quot;</span><span
lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>&lt;form</span><span lang=EN-US> </span><span lang=EN-US
style='color:red'>class</span><span lang=EN-US>=&quot;form-horizontal&quot; </span><span
lang=EN-US style='color:red'>action</span><span lang=EN-US>=&quot;{%
comment_form_target %}&quot; </span><span lang=EN-US style='color:red'>method</span><span
lang=EN-US>=&quot;post&quot;</span><span lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;fieldset&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;div</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=&quot;form-actions&quot;</span><span
lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;input</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=&quot;btn
btn-info&quot; </span><span lang=EN-US style='color:red'>type</span><span
lang=EN-US>=&quot;submit&quot; </span><span lang=EN-US style='color:red'>name</span><span
lang=EN-US>=&quot;<span style='background:olive'>submit</span>&quot; </span><span
lang=EN-US style='color:red'>value</span><span lang=EN-US>=&quot;Post&quot;</span><span
lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{# </span><span lang=EN-US style='color:blue'>&lt;input</span><span lang=EN-US>
</span><span lang=EN-US style='color:red'>class</span><span lang=EN-US>=&quot;btn
btn-info&quot; </span><span lang=EN-US style='color:red'>type</span><span
lang=EN-US>=&quot;submit&quot; </span><span lang=EN-US style='color:red'>name</span><span
lang=EN-US>=&quot;preview&quot; </span><span lang=EN-US style='color:red'>value</span><span
lang=EN-US>=&quot;Preview&quot;</span><span lang=EN-US style='color:blue'>&gt;</span><span
lang=EN-US> #}</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;input</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>type</span><span lang=EN-US>='hidden' </span><span
lang=EN-US style='color:red'>name</span><span lang=EN-US>='next' </span><span
lang=EN-US style='color:red'>value</span><span lang=EN-US>='<span
style='background:lime'>/simpleblog/blog/{{ blog.id }}/commentshow</span>/'</span><span
lang=EN-US style='color:blue'>/&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;/fieldset&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US
style='color:blue'>&lt;/form&gt;</span><span lang=EN-US> </span></p>

<p class=code><span lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>simpleblog/urls.py</span></i></p>

<p class=code><span lang=EN-US>url</span><b><span lang=EN-US style='color:navy'>(</span></b><span
lang=EN-US>r'^<span style='background:lime'>blog/(?P&lt;id&gt;\d+)/commentshow</span>/$'</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> '<span
style='background:yellow'>blog_show_comment</span>'</span><b><span lang=EN-US
style='color:navy'>,</span></b><span lang=EN-US> name</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>'showcomment'</span><b><span
lang=EN-US style='color:navy'>),</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>simpleblog/views.py</span></i></p>

<p class=code><b><span lang=EN-US style='color:blue'>def</span></b><span
lang=EN-US> <span style='background:yellow'>blog_show_comment</span></span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>request</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> id</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US style='color:gray'>''</span><b><span
lang=EN-US style='color:navy'>):</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; blog </span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US> Blog</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>objects</span><b><span
lang=EN-US style='color:navy'>.</span></b><span lang=EN-US>get</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US>id</span><b><span
lang=EN-US style='color:navy'>=</span></b><span lang=EN-US>id</span><b><span
lang=EN-US style='color:navy'>)</span></b></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span><b><span lang=EN-US
style='color:blue'>return</span></b><span lang=EN-US> render_to_response</span><b><span
lang=EN-US style='color:navy'>(</span></b><span lang=EN-US style='color:gray'>'<span
style='background:aqua'>blog_comments_show.html</span>'</span><b><span
lang=EN-US style='color:navy'>,</span></b><span lang=EN-US> </span><b><span
lang=EN-US style='color:navy'>{</span></b><span lang=EN-US style='color:gray'>&quot;blog&quot;</span><b><span
lang=EN-US style='color:navy'>:</span></b><span lang=EN-US> blog</span><b><span
lang=EN-US style='color:navy'>})</span></b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>templates/simpleblog/<span
style='background:aqua'>blog_comments_show.html</span></span></i></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>{% load comments %}</span></p>

<p class=code><span lang=EN-US>{% load gravatar %}</span></p>

<p class=code><span lang=EN-US>{% load markup %}</span></p>

<p class=code><span lang=EN-US style='color:blue'>&lt;article</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>id</span><span
lang=EN-US>=</span><span lang=EN-US style='color:#8000FF'>&quot;<span
style='background:fuchsia'>cmt</span>&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% get_comment_count for blog
as comment_count %}&nbsp;&nbsp;&nbsp; </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;h4</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;muted&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span><span lang=EN-US>{{ comment_count }} Comments</span><span
lang=EN-US style='color:blue'>&lt;/h4&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;hr</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;soften&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span><span lang=EN-US>&nbsp; </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% get_comment_list for blog
as blog_com %}</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% for comment in blog_com %}</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;div</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;container-fluid none-padding&quot;</span><span
lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;div</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;row-fluid&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;div</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;span1&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;img</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;gravatar&quot;</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>src</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;{% gravatar_url comment.user_email
%}&quot;</span><span lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;div</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;span10&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;p</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;muted&quot;</span><span lang=EN-US
style='color:blue'>&gt;&lt;small&gt;</span><span lang=EN-US>{{ comment.user }}</span><span
lang=EN-US style='color:blue'>&lt;/small&gt;&lt;small&gt;</span><span
lang=EN-US>{{ comment.submit_date|date:&quot;F,j,Y&quot; }}</span><span
lang=EN-US style='color:blue'>&lt;/small&gt;&lt;/p&gt;</span><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{{ comment.comment|markdown:'safe,codehilite' }} </span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='color:blue'>&lt;/div&gt;</span><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;/div&gt;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:blue'>&lt;hr</span><span lang=EN-US> </span><span
lang=EN-US style='color:red'>class</span><span lang=EN-US>=</span><span
lang=EN-US style='color:#8000FF'>&quot;soften&quot;</span><span lang=EN-US
style='color:blue'>&gt;</span><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; {% endfor %}</span></p>

<p class=code><span lang=EN-US style='color:blue'>&lt;/article&gt;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>templates/simpleblog/blog_show.html</span></i></p>

<p class=code><span lang=EN-US style='color:blue'>&lt;script</span><span
lang=EN-US> </span><span lang=EN-US style='color:red'>type</span><span
lang=EN-US>=&quot;text/javascript&quot; </span><span lang=EN-US
style='color:red'>charset</span><span lang=EN-US>=&quot;utf-8&quot;</span><span
lang=EN-US style='color:blue'>&gt;</span></p>

<p class=code><span lang=EN-US style='color:navy'>function</span><span
lang=EN-US> bindPostCommentHandler() {</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; $(</span><span lang=EN-US
style='color:gray'>'#comment_form form input.submit-preview'</span><span
lang=EN-US>).remove();</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; $(</span><span lang=EN-US
style='color:gray'>'#<span style='background:blue'>comment_form form</span>'</span><span
lang=EN-US>).submit(</span><span lang=EN-US style='color:navy'>function</span><span
lang=EN-US>() {</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$.ajax({</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
type: </span><span lang=EN-US style='color:gray'>&quot;POST&quot;</span><span
lang=EN-US>,</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
data: $(</span><span lang=EN-US style='color:gray'>'#comment_form form'</span><span
lang=EN-US>).serialize(),</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
url: </span><span lang=EN-US style='color:gray'>&quot;{% comment_form_target
%}&quot;</span><span lang=EN-US>,</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cache: </span><span lang=EN-US style='color:navy'>false</span><span lang=EN-US>,</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
dataType: </span><span lang=EN-US style='color:gray'>&quot;html&quot;</span><span
lang=EN-US>,</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
success: </span><span lang=EN-US style='color:navy'>function</span><span
lang=EN-US>(html, textStatus) {</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(</span><span lang=EN-US style='color:gray'>'#<span style='background:fuchsia'>cmt'</span></span><span
lang=EN-US>).<span style='background:yellow'>replaceWith(html)</span>;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(</span><span lang=EN-US style='color:gray'>'#comment_form form'</span><span
lang=EN-US>)[</span><span lang=EN-US style='color:red'>0</span><span
lang=EN-US>].reset();</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
},</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
error: </span><span lang=EN-US style='color:navy'>function</span><span
lang=EN-US> (XMLHttpRequest, textStatus, errorThrown) {</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
$(</span><span lang=EN-US style='color:gray'>'#comment_form form'</span><span
lang=EN-US>).replaceWith(</span><span lang=EN-US style='color:gray'>'Your
comment was unable to be posted at this time.&nbsp; We apologise for the
inconvenience.'</span><span lang=EN-US>);</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='color:navy'>return</span><span lang=EN-US> </span><span
lang=EN-US style='color:navy'>false</span><span lang=EN-US>;</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; });</span></p>

<p class=code><span lang=EN-US>}</span></p>

<p class=code><span lang=EN-US>&nbsp;</span></p>

<p class=code><span lang=EN-US>$(document).ready(</span><span lang=EN-US
style='color:navy'>function</span><span lang=EN-US>() {</span></p>

<p class=code><span lang=EN-US>&nbsp;&nbsp;&nbsp; bindPostCommentHandler();</span></p>

<p class=code><span lang=EN-US>});</span></p>

<p class=code><span lang=EN-US style='color:blue'>&lt;/script&gt;</span><span
lang=EN-US>&nbsp; </span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></b></p>

<p class=MsoNormal style='text-autospace:none'><b><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:blue;background:white'>def</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black;
background:white'> </span><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:fuchsia;background:white'>post_comment</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>(</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:white'>request</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>,</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:white'> next</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>=</span></b><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:blue;background:white'>None</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>,</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:white'> using</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>=</span></b><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:blue;background:white'>None</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:white'>):</span></b></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:宋体;color:black'>我的方法</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>Form</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>初始化为</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>hide</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>，点击回复显示</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-size:10.0pt;font-family:宋体;color:black'>整个</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>comments</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>替换</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-size:10.0pt;font-family:宋体;color:black'>替换后</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'> </span><span
style='font-size:10.0pt;font-family:宋体;color:black'>整体</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>ajax</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>要重新加载</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:宋体;color:black'>网上方法</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>Form</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>动态添加，怎么解决</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>node</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>问题？</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-size:10.0pt;font-family:宋体;color:black'>只替换部分</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>comment</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>，</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>form</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>改成</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>comment</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>，</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>form</span><span
style='font-size:10.0pt;font-family:宋体;color:black'>的位置可能要改</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-size:10.0pt;font-family:宋体;color:black'>只需要加载新增加部分的</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>ajax</span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>Issue</span></h3>

<p class=MsoNormal><span lang=EN-US>Reverse for 'comments-post-comment' with
arguments '()' and keyword arguments '{}' not found. 1 pattern(s) tried:
['crowdfundings/comments$post/$']</span></p>

<p class=MsoNormal style='text-autospace:none'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black;background:aqua'>url</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:aqua'>(</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:gray;background:aqua'>r'^comments$'</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:aqua'>,</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:black;background:aqua'> include</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:aqua'>(</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:gray;background:aqua'>'django_comments.urls'</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:navy;
background:aqua'>)),</span></b></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:black;background:lime'>url</span><b><span lang=EN-US style='font-size:
10.0pt;font-family:"Courier New";color:navy;background:lime'>(</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:gray;
background:lime'>r'^comments/'</span><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:navy;background:lime'>,</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black;
background:lime'> include</span><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";color:navy;background:lime'>(</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:gray;
background:lime'>'django_comments.urls'</span><b><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:navy;background:lime'>)),</span></b></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></b></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>CSS</span></h3>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.w3school.com.cn/html5/html5_article.asp">HTML 5
&lt;article&gt; <span lang=EN-US style='font-family:宋体'><span lang=EN-US>标签</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.runoob.com/bootstrap/bootstrap-wells.html">Bootstrap&nbsp;Well</a></span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>Div</span></h3>

<p class=MsoNormal><span lang=EN-US>div</span><span style='font-family:宋体'>并列及全屏</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/hnyei/archive/2011/09/19/2181442.html"><span
style='font-size:10.5pt;font-family:"Verdana","sans-serif";color:#075DB3;
text-decoration:none'>CSS</span><span lang=EN-US style='font-size:10.5pt;
font-family:宋体;color:#075DB3;text-decoration:none'><span lang=EN-US>技巧！像</span></span><span
style='font-size:10.5pt;font-family:"Verdana","sans-serif";color:#075DB3;
text-decoration:none'>table</span><span lang=EN-US style='font-size:10.5pt;
font-family:宋体;color:#075DB3;text-decoration:none'><span lang=EN-US>一样布局</span></span><span
style='font-size:10.5pt;font-family:"Verdana","sans-serif";color:#075DB3;
text-decoration:none'>div</span></a></span></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>JQuery</span></h3>

<p class=MsoNormal><span lang=EN-US><a
href="http://blog.csdn.net/ljyabc1028/article/details/7341665">jquery after
append appendTo<span lang=EN-US style='font-family:宋体'><span lang=EN-US>三个函数的区别</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/onlys/articles/jQuery.html">jQuery<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>选择器总结</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.w3school.com.cn/jquery/jquery_ref_traversing.asp">jQuery <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>参考手册</span></span> - <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>遍历</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://blog.163.com/zhaoyanping_1125/blog/static/2013291532011112961637321/">jquery<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>选择器</span></span><span
lang=EN-US><span lang=EN-US> </span></span><span lang=EN-US style='font-family:
宋体'><span lang=EN-US>之</span></span><span lang=EN-US><span lang=EN-US> </span></span><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>获取父级元素、同级元素、子元素</span></span></a></span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></b></p>

<h3 style='text-indent:44.15pt'><span lang=EN-US>templatetag</span></h3>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/MnCu8261/p/5934203.html">django<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>中自定义标签和过滤器</span></span></a></span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></b></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";color:navy'>&nbsp;</span></b></p>

<h2 style='text-indent:26.1pt'><span lang=EN-US>JQuery</span></h2>

<p class=MsoNormal><a name="_Toc476467728"><span lang=EN-US>033 Shopping cart
icon</span></a></p>

<p class=MsoNormal><a name="_Toc476467768"><span lang=EN-US>088 Cart Count in
Navbar</span></a></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><a name="_Social_Share"></a><span lang=EN-US>Social
Share</span></h2>

<h3 style='text-indent:44.15pt'><span style='font-family:宋体'>微信分享</span></h3>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/txw1958/p/WeixinJSBridge-api.html"><span
lang=EN-US style='font-family:宋体;background:lime'><span lang=EN-US>微信</span></span><span
style='background:lime'>WeixinJSBridge API</span></a><span class=MsoHyperlink>-</span></span><span
class=MsoHyperlink><span style='font-family:宋体'>方倍工作室</span></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/txw1958/p/MicroMessenger-browser.html"><span
lang=EN-US style='font-family:宋体;background:lime'><span lang=EN-US>微信公众平台开发</span></span><span
style='background:lime'>(90) </span><span lang=EN-US style='font-family:宋体;
background:lime'><span lang=EN-US>分享到朋友圈和发送给好友</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/txw1958/p/weixin-js-sharetimeline.html"><span
lang=EN-US style='font-family:宋体;background:lime'><span lang=EN-US>微信公众平台开发</span></span><span
style='background:lime'>(107) </span><span lang=EN-US style='font-family:宋体;
background:lime'><span lang=EN-US>分享到朋友圈和发送给好友</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/wasayezi/p/5275691.html">Python<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>微信</span></span>-- <span lang=EN-US
style='font-family:宋体'><span lang=EN-US>分享接口（分享到朋友圈、朋友、空间）</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.aichengxu.com/view/5250400"><span lang=EN-US style='font-family:
宋体'><span lang=EN-US>微信</span></span>JS-SDK <span lang=EN-US style='font-family:
宋体'><span lang=EN-US>分享到朋友圈</span></span><span lang=EN-US><span lang=EN-US> </span></span><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>分享给朋友</span></span><span
lang=EN-US><span lang=EN-US> </span></span><span lang=EN-US style='font-family:
宋体'><span lang=EN-US>分享到</span></span>QQ <span lang=EN-US style='font-family:
宋体'><span lang=EN-US>拍照或从手机相册中选图</span></span><span lang=EN-US><span
lang=EN-US> </span></span><span lang=EN-US style='font-family:宋体'><span
lang=EN-US>识别音频并返回识别结果</span></span><span lang=EN-US><span lang=EN-US> </span></span><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>使用微信内置地图查看位置</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.aichengxu.com/view/4578913"><span lang=EN-US style='font-family:
宋体'><span lang=EN-US>微信朋友圈分享页面（</span></span>JS-SDK 1.0<span lang=EN-US
style='font-family:宋体'><span lang=EN-US>）</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://my.oschina.net/u/2308739/blog/371414"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>微信</span></span>js sdk invalid
signature<span lang=EN-US style='font-family:宋体'><span lang=EN-US>签名错误</span></span><span
lang=EN-US><span lang=EN-US> </span></span><span lang=EN-US style='font-family:
宋体'><span lang=EN-US>问题解决</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://jsbin.com/kalenahana/edit?html,js,output">http://jsbin.com/kalenahana/edit?html,js,output</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/txw1958/p/weixin-js-sdk-demo.html"><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>微信</span></span>JS SDK Demo</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.2cto.com/weixin/201511/451592.html"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>微信</span></span>WeixinJSBridge API<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>（屏蔽右上角按钮等）</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a href="http://mmlike.sinaapp.com/">http://mmlike.sinaapp.com/</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://segmentfault.com/a/1190000004038089"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>微信公众号与</span></span>HTML 5<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>混合模式揭秘</span></span>4――jssdk<span
lang=EN-US style='font-family:宋体'><span lang=EN-US>调用微信扫一扫</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/txw1958/p/weixin-menu-new-type.html"><span
lang=EN-US style='font-family:宋体'><span lang=EN-US>微信公众平台开发</span></span>(104) <span
lang=EN-US style='font-family:宋体'><span lang=EN-US>自定义菜单扫一扫、发图片、发地理位置</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-size:10.5pt;font-family:"微软雅黑","sans-serif";
color:black;background:white'>微信<span lang=EN-US>WeixinJSBridge&nbsp;API</span>。在<span
lang=EN-US>&nbsp;</span>微信分享页面时，用到的调用<span lang=EN-US>&nbsp;Native&nbsp;</span>功能的<span
lang=EN-US>&nbsp;API</span>。</span></p>

<p class=MsoNormal><span style='font-family:宋体'>微信</span><span lang=EN-US>6.0.2</span><span
style='font-family:宋体'>取消了分享接口</span><span lang=EN-US>WeixinJSBridge</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://demo.open.weixin.qq.com/jssdk"><span style='font-size:10.5pt;
font-family:"Helvetica Neue";background:white'>http://demo.open.weixin.qq.com/jssdk</span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='color:green'>#</span><span
lang=EN-US style='font-family:Wingdings;color:green'>&#140;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#141;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#142;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#143;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#144;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#145;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#146;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#147;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#148;</span><span lang=EN-US
style='font-family:Wingdings;color:green'>&#149;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>验证码</span> <span
lang=EN-US>Captcha</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>工具</span></h2>

<p class=MsoNormal><span lang=EN-US><a
href="https://www.zhihu.com/question/20009756/answer/14705540">https://www.zhihu.com/question/20009756/answer/14705540</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>切图部分用</span><span lang=EN-US>fireworks</span></p>

<p class=MsoNormal><span style='font-family:宋体'>如果写单写</span><span lang=EN-US>js</span><span
style='font-family:宋体'>，用</span><span lang=EN-US>webstorm</span><span
style='font-family:宋体'>比较好一点。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>vim + firebug + firebug autocomplete +
fiddler + </span><span style='font-family:宋体'>虚拟机（或者</span><span lang=EN-US>IEtester</span><span
style='font-family:宋体'>）</span><span lang=EN-US>vim: </span><span
style='font-family:宋体'>编辑器，快速、轻量级、无穷的定制性，有了</span><span lang=EN-US>vim</span><span
style='font-family:宋体'>，你会很喜欢</span><span lang=EN-US>coding</span><span
style='font-family:宋体'>的感觉，知道什么是“十指如飞”；</span><span lang=EN-US>firebug+firebug
autocomplete</span><span style='font-family:宋体'>：这是</span><span lang=EN-US>firefox</span><span
style='font-family:宋体'>上调试网页的必备工具，当然在不同浏览器上有不同的相似工具，例如</span><span lang=EN-US>safari</span><span
style='font-family:宋体'>和</span><span lang=EN-US>chrome</span><span
style='font-family:宋体'>下的开发者工具，</span><span lang=EN-US>opera</span><span
style='font-family:宋体'>下的</span><span lang=EN-US>dragonfly</span><span
style='font-family:宋体'>；另外，如果熟悉</span><span lang=EN-US>vim</span><span
style='font-family:宋体'>的话，推荐在</span><span lang=EN-US>firefox</span><span
style='font-family:宋体'>下实用</span><span lang=EN-US> pentadactyl </span><span
style='font-family:宋体'>插件；</span><span lang=EN-US>fiddler</span><span
style='font-family:宋体'>：用于页面调试，可以用本地的</span><span lang=EN-US>js</span><span
style='font-family:宋体'>文件替换某个服务器上的</span><span lang=EN-US>js</span><span
style='font-family:宋体'>文件。虚拟机</span><span lang=EN-US>+IETester</span><span
style='font-family:宋体'>：用于调试</span><span lang=EN-US>ie6~~</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>html+css </span><span style='font-family:
宋体'>还是用</span><span lang=EN-US>DW , notepad++ </span></p>

<p class=MsoNormal><span lang=EN-US>JS</span><span style='font-family:宋体'>用</span><span
lang=EN-US>eclipse</span></p>

<p class=MsoNormal><span style='font-family:宋体'>调试</span><span lang=EN-US>
Chrome </span><span style='font-family:宋体'>开发人员工具</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>短信</span></h2>

<p class=MsoNormal><span lang=EN-US><a
href="https://www.zhihu.com/question/25009882"><span lang=EN-US
style='font-family:宋体'><span lang=EN-US>短信验证码平台哪家速度快又稳定，推荐下？</span></span></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>django-sendsms==0.2.3</span></p>

<p class=MsoNormal><span lang=EN-US><a href="http://www.yunpian.com/">http://www.yunpian.com/</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>兼容</span><span
lang=EN-US>py3</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>from __future__ import unicode_literals</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='text-indent:26.1pt'><span style='font-family:宋体'>临时</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='background:#EFF0F1;vertical-align:baseline'><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#242729;
border:none windowtext 1.0pt;padding:0cm;background:#EFF0F1'>class
User(AbstractUser):</span></p>

<p class=MsoNormal style='background:#EFF0F1;vertical-align:baseline'><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#242729;
border:none windowtext 1.0pt;padding:0cm;background:#EFF0F1'>&nbsp;&nbsp;&nbsp;
class Meta(AbstractUser.Meta):</span></p>

<p class=MsoNormal style='background:#EFF0F1;vertical-align:baseline'><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#242729;
border:none windowtext 1.0pt;padding:0cm;background:#EFF0F1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
swappable = 'AUTH_USER_MODEL'</span></p>

<p class=MsoNormal><strong><span lang=EN-US style='font-size:11.5pt;font-family:
"Arial","sans-serif";color:#242729;border:none windowtext 1.0pt;padding:0cm;
background:white'>swappable</span></strong><span class=apple-converted-space><span
lang=EN-US style='font-size:11.5pt;font-family:"Arial","sans-serif";color:#242729;
background:white'>&nbsp;</span></span><span lang=EN-US style='font-size:11.5pt;
font-family:"Arial","sans-serif";color:#242729;background:white'>is an
&quot;intentionally undocumented&quot; feature which is currently under
development / in-test. It's used to handle &quot;I have a base abstract model
which has some foreign-key relationships.&quot; Slightly more detail is
available from<span class=apple-converted-space>&nbsp;</span></span><span
lang=EN-US><a href="https://code.djangoproject.com/ticket/19103"><span
style='font-size:11.5pt;font-family:"Arial","sans-serif";color:#005999;
border:none windowtext 1.0pt;padding:0cm;background:white'>Django's ticketing
system</span></a></span><span class=apple-converted-space><span lang=EN-US
style='font-size:11.5pt;font-family:"Arial","sans-serif";color:#242729;
background:white'>&nbsp;</span></span><span lang=EN-US style='font-size:11.5pt;
font-family:"Arial","sans-serif";color:#242729;background:white'>and<span
class=apple-converted-space>&nbsp;</span></span><span lang=EN-US><a
href="https://github.com/wq/django-swappable-models"><span style='font-size:
11.5pt;font-family:"Arial","sans-serif";color:#005999;border:none windowtext 1.0pt;
padding:0cm;background:white'>github</span></a></span><span lang=EN-US
style='font-size:11.5pt;font-family:"Arial","sans-serif";color:#242729;
background:white'>. Because it's a &quot;stealth alpha&quot; feature, it's not
guaranteed to work (for anything other than User), and understanding the
detailed operation will likely require diving into source code. It works with<span
class=apple-converted-space>&nbsp;</span><strong><span style='font-family:"Arial","sans-serif";
border:none windowtext 1.0pt;padding:0cm'>AUTH_USER_MODEL</span></strong><span
class=apple-converted-space>&nbsp;</span>because the User model and<span
class=apple-converted-space>&nbsp;</span><strong><span style='font-family:"Arial","sans-serif";
border:none windowtext 1.0pt;padding:0cm'>swappable</span></strong><span
class=apple-converted-space>&nbsp;</span>flag were developed together,
specifically for each other.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:black'>user = UserModel._default_manager.get_by_natural_key(username)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp; def
get_by_natural_key(self, username):</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;return
self.get(**{self.model.USERNAME_FIELD: username})</span></p>

<p class=MsoNormal><span lang=EN-US>**</span><span style='font-family:宋体'>解决了</span><span
lang=EN-US>get</span><span style='font-family:宋体'>后面名字不确定的问题，也是之前困扰</span><span
lang=EN-US>voith</span><span style='font-family:宋体'>的一个问题</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:black'>UserModel._default_manager</span><span lang=EN-US> &nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>MyUserManager:
personalcenter.MyUser.objects</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:black'>UserModel._base_manager</span><span lang=EN-US> &nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Manager:
personalcenter.MyUser._base_manager</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:宋体'>执行</span><span lang=EN-US>get</span><span
style='font-family:宋体'>时会做</span><span lang=EN-US>validation</span><span
style='font-family:宋体'>，即使值一致但是</span><span lang=EN-US>validation</span><span
style='font-family:宋体'>不过也会返回失败</span></p>

<p class=MsoNormal><span style='font-family:宋体'>比如电话号码</span><span lang=EN-US>+86135000000000</span><span
style='font-family:宋体'>，之前</span><span lang=EN-US>validation</span><span
style='font-family:宋体'>时没有</span><span lang=EN-US>+86</span><span
style='font-family:宋体'>，添加的值也不会带</span><span lang=EN-US>+86.</span></p>

<p class=MsoNormal><span lang=EN-US>Validation</span><span style='font-family:
宋体'>规则变化之后，即使搜索</span><span lang=EN-US>135000000000</span><span
style='font-family:宋体'>（值在数据库存在）也会返回</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

</body>

</html>
